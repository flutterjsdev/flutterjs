{
  "version": 3,
  "sources": ["../src/ssr_analyzer.js"],
  "sourcesContent": ["// Copyright 2025 The FlutterJS Authors. All rights reserved.\r\n// Use of this source code is governed by a BSD-style license that can be\r\n// found in the LICENSE file.\r\n\r\n/**\r\n * FlutterJS SSR Analyzer - Phase 3 (FIXED)\r\n * Analyzes Server-Side Rendering (SSR) compatibility\r\n * Detects SSR-safe and unsafe patterns\r\n * Generates migration path for SSR compliance\r\n */\r\n\r\nimport {\r\n  HydrationRequirement,\r\n  LazyLoadOpportunity,\r\n} from './context_analyzer_data.js';\r\nimport { getLogger } from './flutterjs_logger.js';\r\n\r\nclass SSRAnalyzer {\r\n  constructor(contextAnalysisResults, stateAnalysisResults = null, options = {}) {\r\n    // Input from Phase 2 & 3\r\n    this.contextResults = contextAnalysisResults;\r\n    this.stateResults = stateAnalysisResults;\r\n\r\n    this.options = {\r\n      strict: false,\r\n      targetPlatform: 'node',\r\n      ...options,\r\n    };\r\n\r\n    // Initialize logger\r\n     this.logger = getLogger().createComponentLogger('SSRAnalyzer');\r\n\r\n    // Results storage\r\n    this.ssrSafePatterns = [];\r\n    this.ssrUnsafePatterns = [];\r\n    this.hydrationRequirements = [];\r\n    this.lazyLoadOpportunities = [];\r\n    this.ssrMigrationPath = [];\r\n    this.validationIssues = [];\r\n\r\n    // Metrics\r\n    this.ssrCompatibilityScore = 0;\r\n    this.hydrationCount = 0;\r\n    this.errors = [];\r\n  }\r\n\r\n  /**\r\n   * Main entry point - analyze SSR compatibility\r\n   */\r\n  analyze() {\r\n    this.logger.startSession('SSRAnalysis');\r\n    this.logger.info('Starting SSR compatibility analysis');\r\n\r\n    try {\r\n      // Phase 1: Detect SSR-safe patterns\r\n      this.detectSsrSafePatterns();\r\n      this.logger.count('SSR-safe patterns found', this.ssrSafePatterns.length);\r\n\r\n      // Phase 2: Detect SSR-unsafe patterns\r\n      this.detectSsrUnsafePatterns();\r\n      this.logger.count('SSR-unsafe patterns found', this.ssrUnsafePatterns.length);\r\n\r\n      // Phase 3: Identify hydration needs\r\n      this.identifyHydrationNeeds();\r\n      this.logger.count('Hydration dependencies', this.hydrationRequirements.length);\r\n\r\n      // Phase 4: Detect lazy load opportunities\r\n      this.detectLazyLoadOpportunities();\r\n      this.logger.count('Lazy load opportunities', this.lazyLoadOpportunities.length);\r\n\r\n      // Phase 5: Generate migration path\r\n      this.generateMigrationPath();\r\n      this.logger.count('Migration steps', this.ssrMigrationPath.length);\r\n\r\n      // Phase 6: Validate and score\r\n      this.validateSsrRequirements();\r\n      this.calculateCompatibilityScore();\r\n      this.logger.count('SSR Compatibility Score', this.ssrCompatibilityScore);\r\n\r\n      this.logger.success('SSR analysis complete');\r\n      this.logger.endSession('SSRAnalysis');\r\n\r\n      return this.getResults();\r\n    } catch (error) {\r\n      this.logger.failure('SSR analysis failed', error.message);\r\n      this.errors.push(error);\r\n      this.logger.endSession('SSRAnalysis');\r\n      return this.getResults();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Phase 1: Detect SSR-safe patterns\r\n   */\r\n  detectSsrSafePatterns() {\r\n    const patterns = [];\r\n\r\n    // Pattern 1: InheritedWidget static accessors\r\n    patterns.push({\r\n      pattern: 'InheritedWidget static accessors',\r\n      example: 'ThemeProvider.of(context)',\r\n      safeFor: 'SSR',\r\n      why: 'Pure value access, no subscription required',\r\n      confidence: 1.0,\r\n      category: 'context-access',\r\n      frequency: 0,\r\n    });\r\n\r\n    // Pattern 2: context.read<T>() in build()\r\n    patterns.push({\r\n      pattern: 'context.read<T>() in build()',\r\n      example: 'context.read<CounterNotifier>()',\r\n      safeFor: 'SSR',\r\n      why: 'Single read at render time, no re-subscription needed',\r\n      confidence: 0.95,\r\n      category: 'provider-access',\r\n      frequency: 0,\r\n    });\r\n\r\n    // Pattern 3: Static property access\r\n    patterns.push({\r\n      pattern: 'Theme data access',\r\n      example: 'theme.primaryColor',\r\n      safeFor: 'SSR',\r\n      why: 'Read-only during rendering',\r\n      confidence: 1.0,\r\n      category: 'value-access',\r\n      frequency: 0,\r\n    });\r\n\r\n    // Pattern 4: MediaQuery for initial layout\r\n    patterns.push({\r\n      pattern: 'MediaQuery.of() for responsive layout',\r\n      example: 'MediaQuery.of(context).size.width',\r\n      safeFor: 'SSR',\r\n      why: 'Server can set default viewport; client hydrates with actual size',\r\n      confidence: 0.85,\r\n      category: 'responsive-design',\r\n      frequency: 0,\r\n    });\r\n\r\n    // Pattern 5: One-time async operations\r\n    patterns.push({\r\n      pattern: 'Async data in FutureBuilder (with cached data)',\r\n      example: 'FutureBuilder with pre-fetched data',\r\n      safeFor: 'SSR',\r\n      why: 'Server can execute async, pass pre-rendered HTML to client',\r\n      confidence: 0.80,\r\n      category: 'async-operation',\r\n      frequency: 0,\r\n    });\r\n\r\n    // Scan context results for actual safe patterns\r\n    if (this.contextResults && this.contextResults.contextAccessPoints) {\r\n      this.contextResults.contextAccessPoints.forEach((usage) => {\r\n        if (usage.ssrSafe) {\r\n          const pattern = patterns.find((p) => p.example.includes(usage.pattern.split('(')[0]));\r\n          if (pattern) {\r\n            pattern.frequency++;\r\n          }\r\n\r\n          this.ssrSafePatterns.push({\r\n            pattern: usage.pattern,\r\n            type: usage.type,\r\n            location: usage.location,\r\n            example: usage.pattern,\r\n            why: usage.reason,\r\n            confidence: 0.95,\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    // Add framework patterns\r\n    this.ssrSafePatterns.push(...patterns);\r\n  }\r\n\r\n  /**\r\n   * Phase 2: Detect SSR-unsafe patterns\r\n   */\r\n  detectSsrUnsafePatterns() {\r\n    const basePatterns = [\r\n      {\r\n        pattern: 'context.watch<T>() subscriptions',\r\n        example: 'context.watch<CounterNotifier>()',\r\n        unsafeFor: 'SSR',\r\n        why: 'Requires reactive subscription & listeners on client, not available during server render',\r\n        confidence: 1.0,\r\n        category: 'provider-subscription',\r\n        severity: 'error',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'State mutations in event handlers',\r\n        example: 'counter.increment() in onPressed',\r\n        unsafeFor: 'SSR',\r\n        why: 'Event handlers don\\'t exist on server, mutations have no effect',\r\n        confidence: 1.0,\r\n        category: 'state-mutation',\r\n        severity: 'error',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'ChangeNotifier.notifyListeners() calls',\r\n        example: 'notifyListeners() in method',\r\n        unsafeFor: 'SSR',\r\n        why: 'Listeners don\\'t exist during initial SSR render',\r\n        confidence: 0.95,\r\n        category: 'notification',\r\n        severity: 'error',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'Browser APIs',\r\n        example: 'window.localStorage, document.getElementById()',\r\n        unsafeFor: 'SSR',\r\n        why: 'window and document objects don\\'t exist on Node.js server',\r\n        confidence: 1.0,\r\n        category: 'browser-api',\r\n        severity: 'critical',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'Timers and intervals',\r\n        example: 'setTimeout, setInterval, setImmediate',\r\n        unsafeFor: 'SSR',\r\n        why: 'Can cause unexpected behavior and performance issues during server render',\r\n        confidence: 0.90,\r\n        category: 'async-operation',\r\n        severity: 'warning',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'Random values without seeding',\r\n        example: 'Math.random()',\r\n        unsafeFor: 'SSR',\r\n        why: 'Different values on server vs client cause hydration mismatch',\r\n        confidence: 0.99,\r\n        category: 'determinism',\r\n        severity: 'error',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'Navigator and route access',\r\n        example: 'Navigator.of(context).push()',\r\n        unsafeFor: 'SSR',\r\n        why: 'Navigation happens on client, not on server',\r\n        confidence: 1.0,\r\n        category: 'navigation',\r\n        severity: 'warning',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'GestureDetector and event handlers',\r\n        example: 'GestureDetector, onTap, onLongPress',\r\n        unsafeFor: 'SSR',\r\n        why: 'User interactions don\\'t exist on server',\r\n        confidence: 1.0,\r\n        category: 'user-interaction',\r\n        severity: 'warning',\r\n        frequency: 0,\r\n      },\r\n      {\r\n        pattern: 'setState in initState or build',\r\n        example: 'this.setState(() => {...}) in build()',\r\n        unsafeFor: 'SSR',\r\n        why: 'Triggers re-render during render cycle, can cause infinite loops',\r\n        confidence: 0.95,\r\n        category: 'state-management',\r\n        severity: 'critical',\r\n        frequency: 0,\r\n      },\r\n    ];\r\n\r\n    // Scan context results for actual unsafe patterns\r\n    if (this.contextResults && this.contextResults.contextAccessPoints) {\r\n      this.contextResults.contextAccessPoints.forEach((usage) => {\r\n        if (!usage.ssrSafe) {\r\n          const pattern = basePatterns.find((p) => p.example.includes(usage.pattern.split('(')[0]));\r\n          if (pattern) {\r\n            pattern.frequency++;\r\n          }\r\n\r\n          this.ssrUnsafePatterns.push({\r\n            pattern: usage.pattern,\r\n            type: usage.type,\r\n            location: usage.location,\r\n            example: usage.pattern,\r\n            why: usage.reason,\r\n            confidence: 0.95,\r\n            severity: 'error',\r\n            suggestion: usage.getMigrationAdvice?.() || 'Refactor to SSR-safe pattern',\r\n          });\r\n        }\r\n      });\r\n    }\r\n\r\n    // Add base patterns with frequencies\r\n    this.ssrUnsafePatterns.push(...basePatterns);\r\n  }\r\n\r\n  /**\r\n   * Phase 3: Identify hydration needs\r\n   */\r\n  identifyHydrationNeeds() {\r\n    const hydrationNeeds = [];\r\n\r\n    // Need 1: ChangeNotifier instances\r\n    if (this.contextResults && this.contextResults.changeNotifiers) {\r\n      this.contextResults.changeNotifiers.forEach((notifier) => {\r\n        if (notifier.consumers && notifier.consumers.length > 0) {\r\n          const requirement = new HydrationRequirement(\r\n            notifier.name,\r\n            `State needs to be re-created and listeners re-attached post-hydration for ${notifier.consumers.length} consumer(s)`,\r\n            0\r\n          );\r\n\r\n          notifier.consumers.forEach((consumer) => {\r\n            requirement.requiredState.push(`${consumer}.state`);\r\n          });\r\n\r\n          hydrationNeeds.push(requirement);\r\n          this.hydrationCount++;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Need 2: Provider subscriptions\r\n    if (this.contextResults && this.contextResults.providers) {\r\n      this.contextResults.providers.forEach((provider) => {\r\n        if (provider.accessPatterns && provider.accessPatterns.includes('watch')) {\r\n          const requirement = new HydrationRequirement(\r\n            `Provider<${provider.valueType}>`,\r\n            `context.watch() subscriptions need to be re-established on client for reactive updates`,\r\n            1\r\n          );\r\n\r\n          requirement.requiresProvider(provider.providerType);\r\n          hydrationNeeds.push(requirement);\r\n          this.hydrationCount++;\r\n        }\r\n      });\r\n    }\r\n\r\n    // Need 3: Event handlers\r\n    if (this.stateResults && this.stateResults.eventHandlers) {\r\n      this.stateResults.eventHandlers.forEach((handler) => {\r\n        if (!hydrationNeeds.some((h) => h.dependency === handler.handler)) {\r\n          const requirement = new HydrationRequirement(\r\n            handler.handler,\r\n            `Event handler \"${handler.handler}\" must be attached to DOM after hydration`,\r\n            2\r\n          );\r\n          hydrationNeeds.push(requirement);\r\n          this.hydrationCount++;\r\n        }\r\n      });\r\n    }\r\n\r\n    hydrationNeeds.sort((a, b) => a.order - b.order);\r\n    this.hydrationRequirements = hydrationNeeds;\r\n  }\r\n\r\n  /**\r\n   * Phase 4: Detect lazy load opportunities\r\n   */\r\n  detectLazyLoadOpportunities() {\r\n    const opportunities = [];\r\n\r\n    // Opportunity 1: Pages not rendered initially\r\n    if (this.contextResults && this.contextResults.inheritedWidgets) {\r\n      this.contextResults.inheritedWidgets.forEach((widget) => {\r\n        if (widget.usageCount === 0 || (widget.usageCount && widget.usageCount <= 1)) {\r\n          const opp = new LazyLoadOpportunity(\r\n            widget.name,\r\n            `${widget.name} is not needed until user navigates to it`,\r\n            '15KB',\r\n            'widget'\r\n          );\r\n          opp.setRecommendation('Use LazyRoute or dynamic import: import(widgetPath)');\r\n          opp.calculatePriority(15);\r\n          opportunities.push(opp);\r\n        }\r\n      });\r\n    }\r\n\r\n    // Opportunity 2: Heavy ChangeNotifiers\r\n    if (this.contextResults && this.contextResults.changeNotifiers) {\r\n      this.contextResults.changeNotifiers.forEach((notifier) => {\r\n        if (notifier.methods && notifier.methods.length > 10) {\r\n          const opp = new LazyLoadOpportunity(\r\n            notifier.name,\r\n            `${notifier.name} is complex and only needed if feature is used`,\r\n            '8KB',\r\n            'notifier'\r\n          );\r\n          opp.setRecommendation('Lazy create in Provider: create: (context) => Provider.lazy(() => import(...))');\r\n          opp.calculatePriority(8);\r\n          opportunities.push(opp);\r\n        }\r\n      });\r\n    }\r\n\r\n    this.lazyLoadOpportunities = opportunities;\r\n  }\r\n\r\n  /**\r\n   * Phase 5: Generate migration path\r\n   */\r\n  generateMigrationPath() {\r\n    const steps = [];\r\n\r\n    // Step 1: Replace context.watch()\r\n    const watchUnsafe = this.ssrUnsafePatterns.filter((p) => p.pattern?.includes('watch'));\r\n    if (watchUnsafe.length > 0) {\r\n      steps.push({\r\n        step: 1,\r\n        action: 'Replace context.watch() with context.read() for SSR',\r\n        locations: watchUnsafe.map((p) => p.location),\r\n        description: `Found ${watchUnsafe.length} context.watch() calls that need refactoring`,\r\n        example: `\r\n// Before (not SSR safe):\r\nfinal counter = context.watch<CounterNotifier>();\r\n\r\n// After (SSR safe):\r\nfinal counter = context.read<CounterNotifier>();\r\n// Subscribe to changes in didChangeDependencies() instead (client-only)`,\r\n        effort: 'medium',\r\n        priority: 'high',\r\n        files: watchUnsafe.length,\r\n      });\r\n    }\r\n\r\n    // Step 2: Move state mutations\r\n    const mutationUnsafe = this.ssrUnsafePatterns.filter((p) => p.pattern?.includes('mutation'));\r\n    if (mutationUnsafe.length > 0) {\r\n      steps.push({\r\n        step: 2,\r\n        action: 'Move notifyListeners() calls to client-only code',\r\n        locations: mutationUnsafe.map((p) => p.location),\r\n        description: `Found ${mutationUnsafe.length} state mutations that don't work in SSR`,\r\n        example: `\r\n// Before (not SSR safe):\r\ncounter.increment();\r\n\r\n// After (SSR safe):\r\nif (kIsWeb) {  // Only on client\r\n  counter.increment();\r\n}`,\r\n        effort: 'low',\r\n        priority: 'high',\r\n        files: mutationUnsafe.length,\r\n      });\r\n    }\r\n\r\n    // Step 3: Implement hydration layer\r\n    if (this.hydrationRequirements.length > 0) {\r\n      steps.push({\r\n        step: 3,\r\n        action: 'Create hydration layer to re-subscribe listeners post-render',\r\n        description: `App requires hydration for ${this.hydrationRequirements.length} dependencies`,\r\n        example: `\r\n// In main.js or app.dart after runApp():\r\nif (kIsWeb) {\r\n  // Re-create listeners, reattach subscriptions\r\n  hydrate(flutterApp);\r\n}`,\r\n        effort: 'high',\r\n        priority: 'critical',\r\n        dependencies: this.hydrationRequirements.length,\r\n      });\r\n    }\r\n\r\n    // Step 4: Add browser API checks\r\n    const browserApiUnsafe = this.ssrUnsafePatterns.filter((p) => p.category === 'browser-api');\r\n    if (browserApiUnsafe.length > 0) {\r\n      steps.push({\r\n        step: 4,\r\n        action: 'Wrap browser-specific APIs in kIsWeb checks',\r\n        description: `Found ${browserApiUnsafe.length} browser API calls`,\r\n        example: `\r\n// Before:\r\nfinal stored = window.localStorage.getItem('key');\r\n\r\n// After:\r\nfinal stored = kIsWeb ? window.localStorage.getItem('key') : null;`,\r\n        effort: 'low',\r\n        priority: 'medium',\r\n        files: browserApiUnsafe.length,\r\n      });\r\n    }\r\n\r\n    // Step 5: Implement lazy loading\r\n    if (this.lazyLoadOpportunities.length > 0) {\r\n      steps.push({\r\n        step: 5,\r\n        action: 'Implement code splitting for lazy-loaded widgets',\r\n        description: `${this.lazyLoadOpportunities.length} opportunities identified`,\r\n        example: `\r\n// Use dynamic routes\r\nfinal route = await LazyRoute.create(\r\n  () => import('pages/DetailPage.dart')\r\n);`,\r\n        effort: 'medium',\r\n        priority: 'low',\r\n        opportunities: this.lazyLoadOpportunities.length,\r\n      });\r\n    }\r\n\r\n    // Step 6: Test SSR rendering\r\n    steps.push({\r\n      step: steps.length + 1,\r\n      action: 'Set up SSR testing pipeline',\r\n      description: 'Render app on server, verify HTML structure',\r\n      example: `\r\n// Test SSR output matches CSR:\r\nconst serverHtml = await renderAppOnServer();\r\nconst clientHtml = await renderAppOnClient();\r\nassert(serverHtml === clientHtml, 'SSR/CSR mismatch');`,\r\n      effort: 'medium',\r\n      priority: 'critical',\r\n    });\r\n\r\n    this.ssrMigrationPath = steps;\r\n  }\r\n\r\n  /**\r\n   * Phase 6: Validate SSR requirements\r\n   */\r\n  validateSsrRequirements() {\r\n    // Check 1: Browser APIs\r\n    this.ssrUnsafePatterns.forEach((pattern) => {\r\n      if (pattern.category === 'browser-api') {\r\n        this.validationIssues.push({\r\n          type: 'browser-api-usage',\r\n          severity: 'critical',\r\n          pattern: pattern.pattern,\r\n          location: pattern.location,\r\n          message: `Browser API \"${pattern.pattern}\" is not available on server`,\r\n          suggestion: 'Wrap in kIsWeb check or use platform-agnostic alternative',\r\n        });\r\n      }\r\n    });\r\n\r\n    // Check 2: Non-deterministic operations\r\n    this.ssrUnsafePatterns.forEach((pattern) => {\r\n      if (pattern.category === 'determinism') {\r\n        this.validationIssues.push({\r\n          type: 'non-deterministic',\r\n          severity: 'error',\r\n          pattern: pattern.pattern,\r\n          location: pattern.location,\r\n          message: `Non-deterministic operation \"${pattern.pattern}\" causes hydration mismatch`,\r\n          suggestion: 'Use seeded random or remove randomness from render path',\r\n        });\r\n      }\r\n    });\r\n\r\n    // Check 3: Event handlers in build\r\n    const eventHandlersInBuild = this.ssrUnsafePatterns.filter(\r\n      (p) => p.category === 'user-interaction'\r\n    );\r\n    if (eventHandlersInBuild.length > 0) {\r\n      this.validationIssues.push({\r\n        type: 'event-handlers-in-build',\r\n        severity: 'warning',\r\n        count: eventHandlersInBuild.length,\r\n        message: `${eventHandlersInBuild.length} event handlers defined in build() - they'll be recreated on every render`,\r\n        suggestion: 'Move event handler definitions to initState or class level',\r\n      });\r\n    }\r\n\r\n    // Check 4: Hydration completeness\r\n    if (this.hydrationRequirements.length > 0 && this.ssrMigrationPath.length === 0) {\r\n      this.validationIssues.push({\r\n        type: 'incomplete-hydration',\r\n        severity: 'error',\r\n        message: `App has ${this.hydrationRequirements.length} hydration needs but no hydration layer implemented`,\r\n        suggestion: 'Add hydration step to migration path',\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Calculate SSR compatibility score (0-100)\r\n   * FIXED: criticalIssues is now defined properly\r\n   */\r\n  calculateCompatibilityScore() {\r\n    let score = 100;\r\n\r\n    // Deduct for unsafe patterns\r\n    const unsafeCount = this.ssrUnsafePatterns.length;\r\n    score -= Math.min(unsafeCount * 5, 40);\r\n\r\n    // Deduct for critical issues\r\n    const criticalIssues = this.validationIssues.filter((i) => i.severity === 'critical');\r\n    score -= criticalIssues.length * 15;\r\n\r\n    // Deduct for browser APIs\r\n    const browserApiIssues = this.validationIssues.filter((i) => i.type === 'browser-api-usage');\r\n    score -= browserApiIssues.length * 10;\r\n\r\n    // Add bonus for SSR-safe patterns\r\n    const safeCount = this.ssrSafePatterns.length;\r\n    if (safeCount > 0) {\r\n      score += Math.min(safeCount * 2, 15);\r\n    }\r\n\r\n    // Add bonus for successful hydration setup\r\n    if (this.ssrMigrationPath.length > 3) {\r\n      score += 10;\r\n    }\r\n\r\n    // Ensure score is in valid range\r\n    this.ssrCompatibilityScore = Math.max(0, Math.min(100, score));\r\n  }\r\n\r\n  /**\r\n   * Determine overall SSR compatibility\r\n   */\r\n  getOverallCompatibility() {\r\n    if (this.ssrCompatibilityScore >= 85) {\r\n      return 'full';\r\n    } else if (this.ssrCompatibilityScore >= 60) {\r\n      return 'partial';\r\n    } else if (this.ssrCompatibilityScore >= 30) {\r\n      return 'limited';\r\n    } else {\r\n      return 'none';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get estimated migration effort\r\n   */\r\n  getEstimatedEffort() {\r\n    const totalEffort = this.ssrMigrationPath.reduce((sum, step) => {\r\n      const effortMap = { low: 1, medium: 2, high: 3 };\r\n      return sum + (effortMap[step.effort] || 0);\r\n    }, 0);\r\n\r\n    if (totalEffort <= 3) {\r\n      return 'minimal';\r\n    } else if (totalEffort <= 6) {\r\n      return 'moderate';\r\n    } else if (totalEffort <= 9) {\r\n      return 'significant';\r\n    } else {\r\n      return 'major-rewrite';\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get results - FIXED: criticalIssues defined locally\r\n   */\r\n  getResults() {\r\n    // FIXED: Define criticalIssues locally\r\n    const criticalIssues = this.validationIssues.filter((i) => i.severity === 'critical');\r\n\r\n    return {\r\n      overallCompatibility: this.getOverallCompatibility(),\r\n      ssrCompatibilityScore: this.ssrCompatibilityScore,\r\n      ssrReadinessScore: this.ssrCompatibilityScore,\r\n\r\n      // Patterns\r\n      ssrSafePatterns: this.ssrSafePatterns,\r\n      ssrUnsafePatterns: this.ssrUnsafePatterns,\r\n\r\n      // Hydration & Optimization\r\n      hydrationRequirements: this.hydrationRequirements,\r\n      hydrationCount: this.hydrationCount,\r\n      lazyLoadOpportunities: this.lazyLoadOpportunities,\r\n\r\n      // Migration Path\r\n      ssrMigrationPath: this.ssrMigrationPath,\r\n      estimatedEffort: this.getEstimatedEffort(),\r\n\r\n      // Validation & Issues\r\n      validationIssues: this.validationIssues,\r\n      criticalIssues: criticalIssues,\r\n      warningIssues: this.validationIssues.filter((i) => i.severity === 'warning'),\r\n\r\n      // Summary\r\n      summary: {\r\n        compatibility: this.getOverallCompatibility(),\r\n        score: this.ssrCompatibilityScore,\r\n        safePatterns: this.ssrSafePatterns.length,\r\n        unsafePatterns: this.ssrUnsafePatterns.length,\r\n        hydrationNeeded: this.hydrationCount,\r\n        migrationSteps: this.ssrMigrationPath.length,\r\n        criticalIssues: criticalIssues.length,\r\n        effort: this.getEstimatedEffort(),\r\n      },\r\n\r\n      errors: this.errors,\r\n    };\r\n  }\r\n}\r\n\r\nexport { SSRAnalyzer };"],
  "mappings": "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",
  "names": ["HydrationRequirement", "LazyLoadOpportunity", "getLogger", "SSRAnalyzer", "contextAnalysisResults", "stateAnalysisResults", "options", "error", "patterns", "usage", "pattern", "p", "basePatterns", "hydrationNeeds", "notifier", "requirement", "consumer", "provider", "handler", "h", "a", "b", "opportunities", "widget", "opp", "steps", "watchUnsafe", "mutationUnsafe", "browserApiUnsafe", "eventHandlersInBuild", "score", "unsafeCount", "criticalIssues", "i", "browserApiIssues", "safeCount", "totalEffort", "sum", "step"]
}
