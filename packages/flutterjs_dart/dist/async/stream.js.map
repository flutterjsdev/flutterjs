{
  "version": 3,
  "sources": ["../../src/async/stream.js"],
  "sourcesContent": ["// Copyright 2025 The FlutterJS Authors. All rights reserved.\r\n// Use of this source code is governed by a BSD-style license that can be\r\n// found in the LICENSE file.\r\n\r\nexport class StreamSubscription {\r\n    constructor(callbacks) {\r\n        this.callbacks = callbacks;\r\n        this.isPaused = false;\r\n        this.isCanceled = false;\r\n    }\r\n\r\n    cancel() {\r\n        this.isCanceled = true;\r\n        if (this.callbacks && this.callbacks.onCancel) {\r\n            this.callbacks.onCancel();\r\n        }\r\n    }\r\n\r\n    pause() {\r\n        this.isPaused = true;\r\n    }\r\n\r\n    resume() {\r\n        this.isPaused = false;\r\n    }\r\n}\r\n\r\nexport class Stream {\r\n    constructor(onListen) {\r\n        this._onListen = onListen;\r\n    }\r\n\r\n    listen(onData, { onError, onDone, cancelOnError } = {}) {\r\n        const subscription = new StreamSubscription({\r\n            onData,\r\n            onError,\r\n            onDone,\r\n            onCancel: () => {\r\n                // Cleanup logic if needed\r\n            }\r\n        });\r\n\r\n        if (this._onListen) {\r\n            const cancelCallback = this._onListen(subscription);\r\n            if (cancelCallback && typeof cancelCallback === 'function') {\r\n                subscription.callbacks.onCancel = cancelCallback;\r\n            }\r\n        }\r\n\r\n        return subscription;\r\n    }\r\n\r\n    // Basic transforms\r\n    map(convert) {\r\n        const controller = new StreamController();\r\n        this.listen(\r\n            data => controller.add(convert(data)),\r\n            {\r\n                onError: err => controller.addError(err),\r\n                onDone: () => controller.close()\r\n            }\r\n        );\r\n        return controller.stream;\r\n    }\r\n\r\n    transform(streamTransformer) {\r\n        return streamTransformer.bind(this);\r\n    }\r\n\r\n    static fromIterable(iterable) {\r\n        const controller = new StreamController();\r\n        // Run asynchronously\r\n        setTimeout(() => {\r\n            for (const item of iterable) {\r\n                if (controller.isClosed) break;\r\n                controller.add(item);\r\n            }\r\n            if (!controller.isClosed) controller.close();\r\n        }, 0);\r\n        return controller.stream;\r\n    }\r\n}\r\n\r\nexport class StreamController {\r\n    constructor() {\r\n        this._listeners = [];\r\n        this.isClosed = false;\r\n    }\r\n\r\n    get stream() {\r\n        if (!this._stream) {\r\n            this._stream = new Stream((subscription) => {\r\n                this._listeners.push(subscription);\r\n                return () => {\r\n                    const idx = this._listeners.indexOf(subscription);\r\n                    if (idx >= 0) this._listeners.splice(idx, 1);\r\n                };\r\n            });\r\n        }\r\n        return this._stream;\r\n    }\r\n\r\n    get hasListener() {\r\n        return this._listeners.length > 0;\r\n    }\r\n\r\n    add(event) {\r\n        if (this.isClosed) return;\r\n        // Copy to avoid modification while emitting\r\n        [...this._listeners].forEach(sub => {\r\n            if (!sub.isCanceled && !sub.isPaused && sub.callbacks.onData) {\r\n                sub.callbacks.onData(event);\r\n            }\r\n        });\r\n    }\r\n\r\n    addError(error) {\r\n        if (this.isClosed) return;\r\n        [...this._listeners].forEach(sub => {\r\n            if (!sub.isCanceled && !sub.isPaused && sub.callbacks.onError) {\r\n                sub.callbacks.onError(error);\r\n            }\r\n        });\r\n    }\r\n\r\n    close() {\r\n        if (this.isClosed) return;\r\n        this.isClosed = true;\r\n        this._listeners.forEach(sub => {\r\n            if (!sub.isCanceled && !sub.isPaused && sub.callbacks.onDone) {\r\n                sub.callbacks.onDone();\r\n            }\r\n        });\r\n        this._listeners = [];\r\n    }\r\n}\r\n\r\nexport class StreamTransformer {\r\n    constructor(transformer) {\r\n        this._transformer = transformer;\r\n    }\r\n\r\n    static fromHandlers({ handleData, handleError, handleDone }) {\r\n        return new StreamTransformer((stream, cancelOnError) => {\r\n            const controller = new StreamController();\r\n            stream.listen(\r\n                data => {\r\n                    if (handleData) {\r\n                        handleData(data, controller);\r\n                    } else {\r\n                        controller.add(data);\r\n                    }\r\n                },\r\n                {\r\n                    onError: error => {\r\n                        if (handleError) {\r\n                            handleError(error, controller);\r\n                        } else {\r\n                            controller.addError(error);\r\n                        }\r\n                    },\r\n                    onDone: () => {\r\n                        if (handleDone) {\r\n                            handleDone(controller);\r\n                        } else {\r\n                            controller.close();\r\n                        }\r\n                    },\r\n                    cancelOnError\r\n                }\r\n            );\r\n            return controller.stream;\r\n        });\r\n    }\r\n\r\n    bind(stream) {\r\n        return this._transformer(stream);\r\n    }\r\n}\r\n"],
  "mappings": "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",
  "names": ["StreamSubscription", "callbacks", "Stream", "onListen", "onData", "onError", "onDone", "cancelOnError", "subscription", "cancelCallback", "convert", "controller", "StreamController", "data", "err", "streamTransformer", "iterable", "item", "idx", "event", "sub", "error", "StreamTransformer", "transformer", "handleData", "handleError", "handleDone", "stream"]
}
