class h{constructor(s){this.callbacks=s,this.isPaused=!1,this.isCanceled=!1}cancel(){this.isCanceled=!0,this.callbacks&&this.callbacks.onCancel&&this.callbacks.onCancel()}pause(){this.isPaused=!0}resume(){this.isPaused=!1}}class d{constructor(s){this._onListen=s}listen(s,{onError:e,onDone:r,cancelOnError:o}={}){const i=new h({onData:s,onError:e,onDone:r,onCancel:()=>{}});if(this._onListen){const t=this._onListen(i);t&&typeof t=="function"&&(i.callbacks.onCancel=t)}return i}map(s){const e=new l;return this.listen(r=>e.add(s(r)),{onError:r=>e.addError(r),onDone:()=>e.close()}),e.stream}transform(s){return s.bind(this)}static fromIterable(s){const e=new l;return setTimeout(()=>{for(const r of s){if(e.isClosed)break;e.add(r)}e.isClosed||e.close()},0),e.stream}}class l{constructor(){this._listeners=[],this.isClosed=!1}get stream(){return this._stream||(this._stream=new d(s=>(this._listeners.push(s),()=>{const e=this._listeners.indexOf(s);e>=0&&this._listeners.splice(e,1)}))),this._stream}get hasListener(){return this._listeners.length>0}add(s){this.isClosed||[...this._listeners].forEach(e=>{!e.isCanceled&&!e.isPaused&&e.callbacks.onData&&e.callbacks.onData(s)})}addError(s){this.isClosed||[...this._listeners].forEach(e=>{!e.isCanceled&&!e.isPaused&&e.callbacks.onError&&e.callbacks.onError(s)})}close(){this.isClosed||(this.isClosed=!0,this._listeners.forEach(s=>{!s.isCanceled&&!s.isPaused&&s.callbacks.onDone&&s.callbacks.onDone()}),this._listeners=[])}}class c{constructor(s){this._transformer=s}static fromHandlers({handleData:s,handleError:e,handleDone:r}){return new c((o,i)=>{const t=new l;return o.listen(n=>{s?s(n,t):t.add(n)},{onError:n=>{e?e(n,t):t.addError(n)},onDone:()=>{r?r(t):t.close()},cancelOnError:i}),t.stream})}bind(s){return this._transformer(s)}}export{d as Stream,l as StreamController,h as StreamSubscription,c as StreamTransformer};
//# sourceMappingURL=stream.js.map
