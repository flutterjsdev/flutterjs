{
  "version": 3,
  "sources": ["../runtime.js"],
  "sourcesContent": ["// Copyright 2025 The FlutterJS Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n//\n// @flutterjs/server \u2014 Node.js runtime for Dart-compiled HTTP servers.\n//\n// This file is the permanent hand-written runtime entry point.\n// Lives outside src/ so the Dart barrel generator can never overwrite it.\n// Build pipeline: runtime.js \u2192 dist/index.js  (via esbuild in build.js)\n\nimport { createServer } from 'node:http';\nimport { URL } from 'node:url';\n\n// \u2500\u2500\u2500 Annotation stubs (runtime no-ops \u2014 used statically by the compiler) \u2500\u2500\u2500\u2500\u2500\u2500\nexport const Server     = (opts = {}) => opts;\nexport const Get        = (path) => path;\nexport const Post       = (path) => path;\nexport const Put        = (path) => path;\nexport const Patch      = (path) => path;\nexport const Delete     = (path) => path;\nexport const Route      = (path, opts = {}) => ({ path, ...opts });\nexport const Body       = () => null;\nexport const Param      = (name) => name;\nexport const Query      = (name, opts = {}) => ({ name, ...opts });\nexport const Header     = (name) => name;\nexport const Req        = () => null;\nexport const Middleware = (handlers) => handlers;\nexport const Guard      = (guards) => guards;\n\n// \u2500\u2500\u2500 Request \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport class Request {\n  constructor({ method, url, path, params = {}, query = {}, headers = {}, body = null, rawBody = '' }) {\n    this.method   = method;\n    this.url      = url;\n    this.path     = path;\n    this.params   = params;\n    this.query    = query;\n    this.headers  = headers;\n    this.body     = body;\n    this.rawBody  = rawBody;\n  }\n\n  header(name)         { return this.headers[name.toLowerCase()]; }\n  get contentType()    { return this.header('content-type'); }\n  get isJson()         { return this.contentType?.includes('application/json') ?? false; }\n  get authorization()  { return this.header('authorization'); }\n  get bearerToken()    {\n    const auth = this.authorization;\n    return auth?.startsWith('Bearer ') ? auth.slice(7) : null;\n  }\n\n  // P1: typed helpers so compiled @Query/@Header annotations can target a stable API\n  // instead of raw map access that crashes when the key is missing.\n\n  /// Returns a single query param by name, or [defaultValue] if absent.\n  queryParam(name, defaultValue = null) {\n    const v = this.query[name];\n    if (v === undefined || v === null) return defaultValue;\n    return Array.isArray(v) ? v[0] : v;\n  }\n\n  /// Returns all values for a repeated query param (e.g. ?tag=a&tag=b \u2192 ['a','b']).\n  queryParamAll(name) {\n    const v = this.query[name];\n    if (v === undefined || v === null) return [];\n    return Array.isArray(v) ? v : [v];\n  }\n\n  // P1: safe body coercion \u2014 @Body() Map<String, dynamic> compiles to req.bodyAsMap().\n  // Returns body as a plain object, never null/undefined. Avoids 'as Map' cast crash.\n  bodyAsMap() {\n    if (this.body === null || this.body === undefined) return {};\n    if (typeof this.body === 'object' && !Array.isArray(this.body)) return this.body;\n    return {};\n  }\n\n  /// Returns body as an array. Used for @Body() List<...>.\n  bodyAsList() {\n    if (Array.isArray(this.body)) return this.body;\n    return [];\n  }\n}\n\n// \u2500\u2500\u2500 Response \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport class Response {\n  constructor(statusCode, { body = null, headers = {} } = {}) {\n    this.statusCode = statusCode;\n    this.body       = body;\n    this.headers    = headers;\n  }\n\n  static ok(body, headers = {})           { return new Response(200, { body, headers }); }\n  static created(body, headers = {})      { return new Response(201, { body, headers }); }\n  static noContent()                      { return new Response(204); }\n  static badRequest(body)                 { return new Response(400, { body: body ?? { error: 'Bad Request' } }); }\n  static unauthorized(body)               { return new Response(401, { body: body ?? { error: 'Unauthorized' } }); }\n  static forbidden(body)                  { return new Response(403, { body: body ?? { error: 'Forbidden' } }); }\n  static notFound(body)                   { return new Response(404, { body: body ?? { error: 'Not Found' } }); }\n  static conflict(body)                   { return new Response(409, { body: body ?? { error: 'Conflict' } }); }\n  static unprocessable(body)              { return new Response(422, { body: body ?? { error: 'Unprocessable Entity' } }); }\n  static internalError(body)              { return new Response(500, { body: body ?? { error: 'Internal Server Error' } }); }\n  static json(statusCode, data)           { return new Response(statusCode, { body: data, headers: { 'content-type': 'application/json' } }); }\n  static redirect(url, statusCode = 302)  { return new Response(statusCode, { headers: { location: url } }); }\n\n  /// Stream raw bytes/strings \u2014 chunked transfer, no content-length.\n  /// `iterable` must be an AsyncIterable (async generator or ReadableStream).\n  static stream(iterable, { contentType = 'application/octet-stream', status = 200, headers = {} } = {}) {\n    const r = new Response(status, { headers: { 'content-type': contentType, ...headers } });\n    r._stream = iterable;\n    return r;\n  }\n\n  /// Server-Sent Events stream \u2014 sets correct headers, wraps each string as an SSE event.\n  /// `iterable` yields string data payloads (e.g. JSON strings).\n  /// Usage: Response.sse(async function*() { yield JSON.stringify({msg:'hi'}); })\n  static sse(iterable, { headers = {} } = {}) {\n    async function* formatSse(source) {\n      for await (const data of source) {\n        yield `data: ${data}\\n\\n`;\n      }\n    }\n    const r = new Response(200, {\n      headers: {\n        'content-type': 'text/event-stream; charset=utf-8',\n        'cache-control': 'no-cache',\n        'x-accel-buffering': 'no', // disable nginx proxy buffering\n        ...headers,\n      },\n    });\n    r._stream = formatSse(iterable);\n    return r;\n  }\n\n  withHeaders(additional) {\n    return new Response(this.statusCode, { body: this.body, headers: { ...this.headers, ...additional } });\n  }\n}\n\n// \u2500\u2500\u2500 Context \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport class Context {\n  constructor(request) {\n    this.request = request;\n    this.data    = {};\n  }\n  set(key, value) { this.data[key] = value; }\n  get(key)        { return this.data[key]; }\n}\n\n// \u2500\u2500\u2500 Router \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Pre-compiles route patterns to RegExp at startup \u2014 zero parsing at request time.\n\nexport class Router {\n  constructor() {\n    this._routes       = [];\n    this._middleware   = [];\n    this._notFound     = null;\n    this._errorHandler = null;\n  }\n\n  add(method, path, handler) {\n    const { regex, paramNames } = compilePath(path);\n    this._routes.push({ method: method.toUpperCase(), regex, paramNames, handler });\n    return this;\n  }\n\n  use(fn)              { this._middleware.push(fn); return this; }\n  setNotFound(fn)      { this._notFound = fn; return this; }\n  setErrorHandler(fn)  { this._errorHandler = fn; return this; }\n\n  async handle(req) {\n    // Route matching \u2014 extracted so middleware can call it via next()\n    const executeRoute = async () => {\n      for (const route of this._routes) {\n        if (route.method !== req.method) continue;\n        const match = req.path.match(route.regex);\n        if (!match) continue;\n\n        const params = {};\n        for (let i = 0; i < route.paramNames.length; i++) {\n          params[route.paramNames[i]] = decodeURIComponent(match[i + 1] ?? '');\n        }\n        req.params = params;\n\n        // P0: wrap handler so async throws are caught by the error handler,\n        // not leaked as unhandled rejections that bypass sendResponse entirely.\n        try {\n          return await route.handler(req);\n        } catch (err) {\n          if (this._errorHandler) return this._errorHandler(err, req);\n          throw err; // re-throw \u2014 outer FlutterjsServer.listen() catch handles it\n        }\n      }\n\n      if (this._notFound) return this._notFound(req);\n      return Response.notFound({ error: 'Not Found', path: req.path });\n    };\n\n    // Run middleware chain; terminal next() executes the route\n    const runMiddleware = async (index) => {\n      if (index >= this._middleware.length) return executeRoute();\n      return this._middleware[index](req, () => runMiddleware(index + 1));\n    };\n\n    return runMiddleware(0);\n  }\n}\n\n// \u2500\u2500\u2500 Path compiler \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction compilePath(path) {\n  const paramNames = [];\n  const pattern = path\n    .replace(/[.*+?^${}()|[\\]\\\\]/g, (c) => c === ':' ? c : `\\\\${c}`)\n    .replace(/:([a-zA-Z_][a-zA-Z0-9_]*)/g, (_, name) => {\n      paramNames.push(name);\n      return '([^/]+)';\n    });\n  return { regex: new RegExp(`^${pattern}(?:\\\\?.*)?$`), paramNames };\n}\n\n// \u2500\u2500\u2500 Body parser \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function parseBody(nodeReq) {\n  const ct = (nodeReq.headers['content-type'] ?? '').toLowerCase();\n\n  // P0: multipart/form-data bodies cannot be parsed without a boundary parser.\n  // Return null body + set a flag so handlers can detect and reject cleanly.\n  if (ct.includes('multipart/form-data')) {\n    // Drain the socket so the connection isn't left hanging.\n    nodeReq.resume();\n    await new Promise((r) => nodeReq.on('end', r).on('error', r));\n    return { body: null, rawBody: '', multipart: true };\n  }\n\n  return new Promise((resolve) => {\n    const chunks = [];\n    nodeReq.on('data', (chunk) => chunks.push(chunk));\n    nodeReq.on('end', () => {\n      const rawBody = Buffer.concat(chunks).toString('utf8');\n      let body = rawBody;\n      if (ct.includes('application/json') && rawBody) {\n        try { body = JSON.parse(rawBody); } catch { body = rawBody; }\n      } else if (ct.includes('application/x-www-form-urlencoded') && rawBody) {\n        // P0: preserve repeated keys as arrays \u2014 ?a=1&a=2 \u2192 { a: ['1','2'] }\n        const params = new URLSearchParams(rawBody);\n        body = {};\n        for (const key of params.keys()) {\n          const vals = params.getAll(key);\n          body[key] = vals.length === 1 ? vals[0] : vals;\n        }\n      }\n      resolve({ body, rawBody, multipart: false });\n    });\n    nodeReq.on('error', () => resolve({ body: null, rawBody: '', multipart: false }));\n  });\n}\n\n// \u2500\u2500\u2500 Response writer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction sendResponse(nodeRes, response) {\n  // Streaming responses bypass sendResponse \u2014 handled inline in listen().\n  // This guard prevents accidentally buffering a streaming response.\n  if (response._stream) return;\n\n  const headers = { ...response.headers };\n  let body = response.body;\n\n  if (body !== null && body !== undefined) {\n    if (typeof body === 'object' && !Buffer.isBuffer(body)) {\n      // JSON \u2014 stringify first, then measure byte length of the resulting string\n      body = JSON.stringify(body);\n      if (!headers['content-type']) headers['content-type'] = 'application/json; charset=utf-8';\n    }\n    // Fix: always convert string \u2192 Buffer before measuring so byteLength is exact\n    // (multi-byte UTF-8 chars: \"h\u00E9llo\".length === 5 but byteLength === 6)\n    if (typeof body === 'string') {\n      if (!headers['content-type']) headers['content-type'] = 'text/plain; charset=utf-8';\n      body = Buffer.from(body, 'utf8');\n    }\n    // body is now Buffer or pre-existing Buffer \u2014 byteLength is exact\n    headers['content-length'] = Buffer.byteLength(body).toString();\n  }\n\n  nodeRes.writeHead(response.statusCode, headers);\n  if (response.statusCode === 204 || body === null || body === undefined) {\n    nodeRes.end();\n  } else {\n    nodeRes.end(body);\n  }\n}\n\n// \u2500\u2500\u2500 Streaming response writer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n// Called when response._stream is set. Pipes AsyncIterable chunks to the socket.\n\nasync function sendStreamingResponse(nodeRes, response) {\n  const headers = { ...response.headers };\n  // No content-length for streaming \u2014 transfer-encoding: chunked is implicit in Node HTTP\n  nodeRes.writeHead(response.statusCode, headers);\n  try {\n    for await (const chunk of response._stream) {\n      // Each chunk can be a string or Buffer\n      nodeRes.write(typeof chunk === 'string' ? Buffer.from(chunk, 'utf8') : chunk);\n    }\n  } finally {\n    nodeRes.end();\n  }\n}\n\n// \u2500\u2500\u2500 FlutterjsServer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport class FlutterjsServer {\n  constructor({\n    port    = 3000,\n    host    = '0.0.0.0',\n    prefix  = '',\n    timeout = 30_000,       // P2: per-request timeout in ms (0 = disabled)\n  } = {}) {\n    this.port    = port;\n    this.host    = host;\n    this.prefix  = prefix;\n    this.timeout = timeout;\n    this.router  = new Router();\n    this._server = null;\n\n    // P2-1: graceful-shutdown state\n    this._inFlight      = 0;      // count of requests currently being handled\n    this._shuttingDown  = false;  // set to true when shutdown is initiated\n    this._drainResolve  = null;   // resolve() called when _inFlight hits 0 during shutdown\n  }\n\n  mount(controllerFn) {\n    // P1: wrap router so routes are auto-prefixed \u2014 user writes '/users', gets '<prefix>/users'\n    const prefixedRouter = {\n      add: (method, path, handler) => {\n        const fullPath = this.prefix ? `${this.prefix}${path}` : path;\n        this.router.add(method, fullPath, handler);\n        return prefixedRouter;\n      },\n      use:             (fn)  => { this.router.use(fn); return prefixedRouter; },\n      setNotFound:     (fn)  => { this.router.setNotFound(fn); return prefixedRouter; },\n      setErrorHandler: (fn)  => { this.router.setErrorHandler(fn); return prefixedRouter; },\n    };\n    controllerFn(prefixedRouter, this.prefix);\n    return this;\n  }\n\n  use(fn) { this.router.use(fn); return this; }\n\n  listen(callback) {\n    this._server = createServer(async (nodeReq, nodeRes) => {\n      // P2-1: reject new requests while shutting down\n      if (this._shuttingDown) {\n        nodeRes.writeHead(503, { 'content-type': 'application/json', 'connection': 'close' });\n        nodeRes.end(JSON.stringify({ error: 'Server is shutting down' }));\n        return;\n      }\n\n      this._inFlight++;\n\n      try {\n        const parsedUrl = new URL(nodeReq.url, `http://${nodeReq.headers.host ?? 'localhost'}`);\n        const { body, rawBody, multipart } = await parseBody(nodeReq);\n\n        // P0: multipart bodies are drained but not parsed \u2014 return 415 immediately.\n        if (multipart) {\n          sendResponse(nodeRes, Response.json(415, { error: 'multipart/form-data is not supported. Send JSON instead.' }));\n          return;\n        }\n\n        const headers = {};\n        for (const [k, v] of Object.entries(nodeReq.headers)) {\n          headers[k] = Array.isArray(v) ? v.join(', ') : v;\n        }\n\n        // P0: preserve repeated query keys as arrays \u2014 ?a=1&a=2 \u2192 { a: ['1','2'] }\n        const query = {};\n        for (const key of parsedUrl.searchParams.keys()) {\n          const vals = parsedUrl.searchParams.getAll(key);\n          query[key] = vals.length === 1 ? vals[0] : vals;\n        }\n\n        const req = new Request({\n          method: nodeReq.method.toUpperCase(),\n          url:    nodeReq.url,\n          path:   parsedUrl.pathname,\n          params: {},\n          query,\n          headers,\n          body,\n          rawBody,\n        });\n\n        // P2-2: per-request timeout \u2014 race handler against a timer\n        let response;\n        if (this.timeout > 0) {\n          let timeoutId;\n          const timeoutPromise = new Promise((_, reject) => {\n            timeoutId = setTimeout(\n              () => reject(Object.assign(new Error(`Request timed out after ${this.timeout}ms`), { code: 'REQUEST_TIMEOUT' })),\n              this.timeout,\n            );\n          });\n          try {\n            response = await Promise.race([this.router.handle(req), timeoutPromise]);\n          } finally {\n            clearTimeout(timeoutId);\n          }\n        } else {\n          response = await this.router.handle(req);\n        }\n\n        // Route streaming vs buffered responses\n        if (response._stream) {\n          await sendStreamingResponse(nodeRes, response);\n        } else {\n          sendResponse(nodeRes, response);\n        }\n\n      } catch (err) {\n        const is503 = err.code === 'REQUEST_TIMEOUT';\n        const errResponse = is503\n          ? Response.json(503, { error: err.message })\n          : this.router._errorHandler\n            ? await this.router._errorHandler(err)\n            : Response.internalError({ error: err.message ?? 'Internal Server Error' });\n        try { sendResponse(nodeRes, errResponse); } catch { nodeRes.end(); }\n      } finally {\n        // P2-1: decrement in-flight; if draining and now at 0, unblock shutdown\n        this._inFlight--;\n        if (this._shuttingDown && this._inFlight === 0 && this._drainResolve) {\n          this._drainResolve();\n        }\n      }\n    });\n\n    // P1: friendly port-conflict error instead of raw EADDRINUSE crash\n    this._server.on('error', (err) => {\n      if (err.code === 'EADDRINUSE') {\n        console.error(`\\n\u274C Port ${this.port} is already in use.\\n   Stop the process using that port and try again.\\n`);\n        process.exit(1);\n      } else {\n        throw err;\n      }\n    });\n\n    this._server.listen(this.port, this.host, () => {\n      const cb = callback ?? (() => {\n        const host = this.host === '0.0.0.0' ? 'localhost' : this.host;\n        console.log(`\\n\uD83D\uDE80 @flutterjs/server running on http://${host}:${this.port}\\n`);\n      });\n      cb();\n\n      // P2-1: register graceful-shutdown handlers after server is up\n      this._registerShutdownHandlers();\n    });\n\n    return this;\n  }\n\n  // P2-1: graceful shutdown \u2014 stop accepting, drain in-flight, exit\n  _registerShutdownHandlers() {\n    const shutdown = async (signal) => {\n      // Only handle once\n      if (this._shuttingDown) return;\n      this._shuttingDown = true;\n\n      console.log(`\\n\u23F3 ${signal} received \u2014 shutting down gracefully\u2026`);\n\n      // Stop accepting new connections\n      this._server.close();\n\n      if (this._inFlight > 0) {\n        console.log(`   Waiting for ${this._inFlight} in-flight request(s) to complete\u2026`);\n\n        // Wait for drain, or force-exit after 10 seconds\n        const drainPromise = new Promise((resolve) => { this._drainResolve = resolve; });\n        const forceExit    = new Promise((resolve) => setTimeout(resolve, 10_000));\n\n        await Promise.race([drainPromise, forceExit]);\n\n        if (this._inFlight > 0) {\n          console.log(`   \u26A0\uFE0F  Force-exiting with ${this._inFlight} request(s) still in flight.`);\n        }\n      }\n\n      console.log('   Server stopped. Goodbye!\\n');\n      process.exit(0);\n    };\n\n    process.once('SIGTERM', () => shutdown('SIGTERM'));\n    process.once('SIGINT',  () => shutdown('SIGINT'));\n  }\n\n  close() {\n    return new Promise((resolve, reject) => {\n      this._server\n        ? this._server.close((err) => err ? reject(err) : resolve())\n        : resolve();\n    });\n  }\n}\n\n// \u2500\u2500\u2500 Built-in middleware \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function cors({ origin = '*', methods = 'GET,POST,PUT,PATCH,DELETE,OPTIONS' } = {}) {\n  return async (req, next) => {\n    if (req.method === 'OPTIONS') {\n      return new Response(204, { headers: {\n        'access-control-allow-origin': origin,\n        'access-control-allow-methods': methods,\n        'access-control-allow-headers': 'content-type, authorization',\n        'access-control-max-age': '86400',\n      }});\n    }\n    const response = await next();\n    return response.withHeaders({ 'access-control-allow-origin': origin });\n  };\n}\n\nexport function logger() {\n  return async (req, next) => {\n    const start = Date.now();\n    const response = await next();\n    const ms = Date.now() - start;\n    const s = response?.statusCode ?? '???';\n    const c = s >= 500 ? '\\x1b[31m' : s >= 400 ? '\\x1b[33m' : '\\x1b[32m';\n    console.log(`${c}${req.method}\\x1b[0m ${req.path} \u2192 ${s} (${ms}ms)`);\n    return response;\n  };\n}\n\nexport function bearerAuth(verifyFn) {\n  return async (req, next) => {\n    const token = req.bearerToken;\n    if (!token) return Response.unauthorized({ error: 'Missing token' });\n    const valid = await verifyFn(token);\n    if (!valid) return Response.unauthorized({ error: 'Invalid token' });\n    return next();\n  };\n}\n\n// \u2500\u2500\u2500 Convenience bootstrap \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function createFlutterjsServer(opts, mountFn) {\n  const server = new FlutterjsServer(opts);\n  if (mountFn) server.mount(mountFn);\n  server.listen();\n  return server;\n}\n"],
  "mappings": "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",
  "names": []
}
