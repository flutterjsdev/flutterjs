import{Diagnosticable as s,Element as g,StatelessElement as c,StatefulElement as d}from"@flutterjs/runtime/element";import{VNode as p}from"@flutterjs/vdom/vnode";class S extends s{constructor(){super(),this._element=null,this._widget=null,this._mounted=!1,this._building=!1,this._didInitState=!1,this._didMount=!1,this._isActive=!1,this._buildCount=0}get widget(){return this._widget}get context(){return this._element?.context||null}get mounted(){return this._mounted}initState(){}didUpdateWidget(t){}didChangeDependencies(){}didMount(){}dispose(){}activate(){}deactivate(){}build(t){throw new Error(`${this.constructor.name}.build(context) must be implemented`)}setState(t){if(!this.mounted){console.warn("[State] setState called on unmounted state");return}if(this._building&&console.warn("[State] setState called during build"),typeof t=="function")try{t.call(this)}catch(e){throw console.error("[State] setState update function failed:",e),e}else typeof t=="object"&&t!==null&&Object.assign(this,t);this._element&&typeof this._element.markNeedsBuild=="function"&&this._element.markNeedsBuild()}_init(){if(!this._didInitState){this._didInitState=!0,this._mounted=!0,this._isActive=!0;try{console.log(`[State] Calling initState for ${this.constructor.name}`),this.initState()}catch(t){throw console.error("[State] initState failed:",t),t}}}_didChangeDependencies(){try{this.didChangeDependencies()}catch(t){console.error("[State] didChangeDependencies failed:",t)}}_didMount(){if(!this._didMount){this._didMount=!0;try{console.log(`[State] Calling didMount for ${this.constructor.name}`),this.didMount()}catch(t){console.error("[State] didMount failed:",t)}}}_dispose(){this._mounted=!1,this._isActive=!1;try{console.log(`[State] Calling dispose for ${this.constructor.name}`),this.dispose()}catch(t){console.error("[State] dispose failed:",t)}}_deactivate(){if(this._isActive){this._isActive=!1;try{this.deactivate()}catch(t){console.error("[State] deactivate failed:",t)}}}_reactivate(){if(!this._isActive){this._isActive=!0;try{this.activate()}catch(t){console.error("[State] activate failed:",t)}}}toStringShort(){return`${this.constructor.name}`}}class r extends s{constructor(t=null){if(super(),new.target===r)throw new Error("Widget is abstract and cannot be instantiated");this.key=t}createElement(t,e){throw new Error(`${this.constructor.name}.createElement() must be implemented`)}toStringShort(){return`${this.constructor.name}${this.key?`(key: ${this.key})`:"(unkeyed)"}`}debugFillProperties(t){super.debugFillProperties(t)}}class h extends r{constructor(t=null){super(t)}build(t){throw new Error(`${this.constructor.name}.build(context) must be implemented`)}createElement(t,e){return new c(this,t,e)}}class b extends r{constructor(t=null){super(t)}createState(){throw new Error(`${this.constructor.name}.createState() must be implemented`)}createElement(t,e){return new d(this,t,e)}}class o extends r{constructor({key:t=null,child:e=null}={}){if(super(t),new.target===o)throw new Error("ProxyWidget is abstract");this.child=e}createElement(t,e){return new m(this,t,e)}}class m extends g{constructor(t,e=null,f=null){super(t,e,f)}performRebuild(){if(!this.widget.child)return null;try{const t=this.widget.child.createElement(this,this.runtime);return t&&typeof t.mount=="function"&&t.mount(this),t&&t._vnode?t._vnode:t&&typeof t.performRebuild=="function"?t.performRebuild():null}catch(t){throw console.error("[ProxyElement] performRebuild failed:",t),t}}}class w extends h{constructor({message:t="Error",error:e=null}={}){super(),this.message=t,this.error=e}build(t){return new p({tag:"div",props:{style:{backgroundColor:"#ff1744",color:"white",padding:"16px",borderRadius:"4px",fontFamily:"monospace",fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word"}},children:[this.message]})}}class i{constructor(){if(new.target===i)throw new Error("Key is abstract")}}class l extends i{constructor(t){super(),this.value=t}equals(t){return t instanceof l&&this.value===t.value}toString(){return`ValueKey(${this.value})`}}class a extends i{constructor(t){super(),this.value=t}equals(t){return t instanceof a&&this.value===t.value}toString(){return`ObjectKey(${this.value})`}}class u extends i{constructor(t=null){super(),this.debugLabel=t,this._currentElement=null}get currentContext(){return this._currentElement?.context||null}get currentWidget(){return this._currentElement?.widget||null}get currentState(){return this._currentElement?.state||null}equals(t){return t instanceof u&&this===t}toString(){return`GlobalKey${this.debugLabel?`(${this.debugLabel})`:""}`}}export{s as Diagnosticable,w as ErrorWidget,u as GlobalKey,i as Key,a as ObjectKey,m as ProxyElement,o as ProxyWidget,S as State,d as StatefulElement,b as StatefulWidget,c as StatelessElement,h as StatelessWidget,l as ValueKey,r as Widget};
//# sourceMappingURL=widget_element.js.map
