import{Diagnosticable as o,Element as a}from"@flutterjs/runtime/element";import{VNode as S}from"@flutterjs/vdom/vnode";class h extends o{constructor(){super(),this._element=null,this._widget=null,this._mounted=!1,this._building=!1,this._didInitState=!1,this._didMount=!1,this._isActive=!1,this._buildCount=0}get widget(){return this._widget}get context(){return this._element?.context||null}get mounted(){return this._mounted}initState(){}didUpdateWidget(t){}didChangeDependencies(){}didMount(){}dispose(){}activate(){}deactivate(){}build(t){throw new Error(`${this.constructor.name}.build(context) must be implemented`)}setState(t){if(!this.mounted){console.warn("[State] setState called on unmounted state");return}if(this._building&&console.warn("[State] setState called during build"),typeof t=="function")try{t.call(this)}catch(e){throw console.error("[State] setState update function failed:",e),e}else typeof t=="object"&&t!==null&&Object.assign(this,t);this._element&&typeof this._element.markNeedsBuild=="function"&&this._element.markNeedsBuild()}_init(){if(!this._didInitState){this._didInitState=!0,this._mounted=!0,this._isActive=!0;try{console.log(`[State] Calling initState for ${this.constructor.name}`),this.initState()}catch(t){throw console.error("[State] initState failed:",t),t}}}_didChangeDependencies(){try{this.didChangeDependencies()}catch(t){console.error("[State] didChangeDependencies failed:",t)}}_didMount(){if(!this._didMount){this._didMount=!0;try{console.log(`[State] Calling didMount for ${this.constructor.name}`),this.didMount()}catch(t){console.error("[State] didMount failed:",t)}}}_dispose(){this._mounted=!1,this._isActive=!1;try{console.log(`[State] Calling dispose for ${this.constructor.name}`),this.dispose()}catch(t){console.error("[State] dispose failed:",t)}}_deactivate(){if(this._isActive){this._isActive=!1;try{this.deactivate()}catch(t){console.error("[State] deactivate failed:",t)}}}_reactivate(){if(!this._isActive){this._isActive=!0;try{this.activate()}catch(t){console.error("[State] activate failed:",t)}}}toStringShort(){return`${this.constructor.name}`}}class s extends o{constructor(t=null){if(super(),new.target===s)throw new Error("Widget is abstract and cannot be instantiated");this.key=t}createElement(t,e){throw new Error(`${this.constructor.name}.createElement() must be implemented`)}toStringShort(){return`${this.constructor.name}${this.key?`(key: ${this.key})`:"(unkeyed)"}`}debugFillProperties(t){super.debugFillProperties(t)}}class f extends s{constructor(t=null){super(t)}build(t){throw new Error(`${this.constructor.name}.build(context) must be implemented`)}createElement(t,e){return new m(this,t,e)}}class m extends a{constructor(t,e=null,r=null){if(!t)throw new Error("[StatelessElement] Widget is required");if(!r)throw new Error("[StatelessElement] Runtime is required");super(t,e,r),console.log(`[StatelessElement] Created for ${t.constructor.name}`)}performRebuild(){try{console.log(`[StatelessElement] build() for ${this.widget.constructor.name}`);const t=this.widget.build(this.context);if(!t)throw new Error(`${this.widget.constructor.name}.build() returned null or undefined`);return console.log("[StatelessElement] \xE2\u0153\u2026 build() returned:",{type:typeof t,constructor:t?.constructor?.name,hasTag:t?.tag!==void 0}),t}catch(t){throw console.error("[StatelessElement] build error:",t),t}}}class p extends s{constructor(t=null){super(t)}createState(){throw new Error(`${this.constructor.name}.createState() must be implemented`)}createElement(t,e){return new g(this,t,e)}}class g extends a{constructor(t,e=null,r=null){if(!t)throw new Error("[StatefulElement] Widget is required");if(!r)throw new Error("[StatefulElement] Runtime is required");super(t,e,r),this._state=null,this._stateCreated=!1,this._stateInitialized=!1,console.log(`[StatefulElement] Created for ${t.constructor.name}`)}get state(){return this._stateCreated||this._createState(),this._state}_createState(){if(!this._stateCreated){console.log(`[StatefulElement] Creating state for ${this.widget.constructor.name}`);try{if(this._state=this.widget.createState(),!this._state)throw new Error(`${this.widget.constructor.name}.createState() returned null`);if(!(this._state instanceof h))throw new Error(`${this.widget.constructor.name}.createState() must return a State instance`);if(typeof this._state.build!="function")throw new Error(`State for ${this.widget.constructor.name} must implement build(context)`);this._state._element=this,this._state._widget=this.widget,this._stateCreated=!0,console.log(`[StatefulElement] \xE2\u0153\u2026 State created: ${this._state.constructor.name}`)}catch(t){throw console.error("[StatefulElement] Failed to create state:",t),t}}}_initializeState(){if(!this._stateInitialized){console.log("[StatefulElement] Initializing state");try{this._state._init(),this._state._didChangeDependencies(),this._state._didMount(),this._stateInitialized=!0,console.log("[StatefulElement] \xE2\u0153\u2026 State initialized")}catch(t){throw console.error("[StatefulElement] State initialization failed:",t),t}}}mount(t=null){this._mounted||(console.log("[StatefulElement] mount()"),super.mount(t),this._stateCreated||this._createState(),this._stateInitialized||this._initializeState(),console.log("[StatefulElement] \xE2\u0153\u2026 Mounted"))}updateWidget(t){console.log("[StatefulElement] updateWidget()");const e=this.widget;this.widget=t,this._state._widget=t;try{this._state.didUpdateWidget(e)}catch(r){console.error("[StatefulElement] didUpdateWidget failed:",r)}this.markNeedsBuild()}performRebuild(){console.log(`[StatefulElement] performRebuild() for ${this.widget.constructor.name}`);try{this._stateCreated||this._createState(),this._stateInitialized||this._initializeState(),this._state._building=!0;const t=this._state.build(this.context);if(this._state._building=!1,!t)throw new Error(`State.build() for ${this.widget.constructor.name} returned null`);return console.log("[StatefulElement] \xE2\u0153\u2026 performRebuild() returned:",{type:typeof t,constructor:t?.constructor?.name}),t}catch(t){throw this._state._building=!1,console.error("[StatefulElement] performRebuild() failed:",t),t}}unmount(){if(console.log("[StatefulElement] unmount()"),!!this._mounted)try{this._state&&this._state._dispose(),super.unmount(),console.log("[StatefulElement] \xE2\u0153\u2026 Unmounted")}catch(t){console.error("[StatefulElement] unmount() failed:",t)}}deactivate(){this._state&&this._state._deactivate(),super.deactivate?.()}activate(){this._state&&this._state._reactivate(),super.activate?.()}}class l extends s{constructor({key:t=null,child:e=null}={}){if(super(t),new.target===l)throw new Error("ProxyWidget is abstract");this.child=e}createElement(t,e){return new _(this,t,e)}}class _ extends a{constructor(t,e=null,r=null){super(t,e,r)}performRebuild(){if(!this.widget.child)return null;try{const t=this.widget.child.createElement(this,this.runtime);return t&&typeof t.mount=="function"&&t.mount(this),t&&typeof t.performRebuild=="function"?t.performRebuild():null}catch(t){throw console.error("[ProxyElement] performRebuild failed:",t),t}}}class w extends f{constructor({message:t="Error",error:e=null}={}){super(),this.message=t,this.error=e}build(t){return new S({tag:"div",props:{style:{backgroundColor:"#ff1744",color:"white",padding:"16px",borderRadius:"4px",fontFamily:"monospace",fontSize:"12px",whiteSpace:"pre-wrap",wordBreak:"break-word"}},children:[this.message]})}}class n{constructor(){if(new.target===n)throw new Error("Key is abstract")}}class u extends n{constructor(t){super(),this.value=t}equals(t){return t instanceof u&&this.value===t.value}toString(){return`ValueKey(${this.value})`}}class c extends n{constructor(t){super(),this.value=t}equals(t){return t instanceof c&&this.value===t.value}toString(){return`ObjectKey(${this.value})`}}class d extends n{constructor(t=null){super(),this.debugLabel=t,this._currentElement=null}get currentContext(){return this._currentElement?.context||null}get currentWidget(){return this._currentElement?.widget||null}get currentState(){return this._currentElement?.state||null}equals(t){return t instanceof d&&this===t}toString(){return`GlobalKey${this.debugLabel?`(${this.debugLabel})`:""}`}}export{o as Diagnosticable,w as ErrorWidget,d as GlobalKey,n as Key,c as ObjectKey,_ as ProxyElement,l as ProxyWidget,h as State,g as StatefulElement,p as StatefulWidget,m as StatelessElement,f as StatelessWidget,u as ValueKey,s as Widget};
//# sourceMappingURL=widget_element.js.map
