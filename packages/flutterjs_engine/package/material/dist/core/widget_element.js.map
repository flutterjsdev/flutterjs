{
  "version": 3,
  "sources": ["../../src/core/widget_element.js"],
  "sourcesContent": ["\r\nimport { Diagnosticable, Element } from \"@flutterjs/runtime/element\";\r\nimport { VNode } from \"@flutterjs/vdom/vnode\";\r\n\r\n// ============================================================================\r\n// 4. WIDGET CLASS - With Diagnosticable\r\n// ============================================================================\r\n\r\n/**\r\n * Widget - Abstract base class for all widgets\r\n */\r\n class Widget extends Diagnosticable {\r\n  constructor(key = null) {\r\n    super();\r\n    if (new.target === Widget) {\r\n      throw new Error('Widget is abstract and cannot be instantiated');\r\n    }\r\n    this.key = key;\r\n  }\r\n\r\n  /**\r\n   * Create an Element for this widget\r\n   * Must be implemented in subclasses\r\n   */\r\n  createElement() {\r\n    throw new Error(\r\n      `${this.constructor.name}.createElement() must be implemented`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get short description of widget\r\n   */\r\n  toStringShort() {\r\n    return `${this.constructor.name}${this.key ? `(key: ${this.key})` : '(unkeyed)'}`;\r\n  }\r\n\r\n  /**\r\n   * Add widget-specific debug properties\r\n   * Override in subclasses for custom properties\r\n   */\r\n  debugFillProperties(properties) {\r\n    super.debugFillProperties(properties);\r\n    // Subclasses add their own properties here\r\n  }\r\n}\r\n\r\n\r\n\r\n// ============================================================================\r\n// 6. STATELESS WIDGET & ELEMENT\r\n// ============================================================================\r\n\r\n/**\r\n * StatelessWidget - Immutable widget that depends only on props/configuration\r\n */\r\nclass StatelessWidget extends Widget {\r\n  constructor(key = null) {\r\n    super(key);\r\n  }\r\n\r\n  /**\r\n   * Build the widget UI\r\n   */\r\n  build(context) {\r\n    throw new Error(`${this.constructor.name}.build() must be implemented`);\r\n  }\r\n\r\n  /**\r\n   * Create element for this widget\r\n   */\r\n  createElement() {\r\n    return new StatelessElement(this);\r\n  }\r\n\r\n  reassemble() { }\r\n}\r\n\r\n/**\r\n * StatelessElement - Element for stateless widget\r\n */\r\nclass StatelessElement extends Element {\r\n  constructor(widget) {\r\n    super(widget);\r\n  }\r\n\r\n  /**\r\n   * Mount the element\r\n   */\r\n  mount(parent = null) {\r\n    super.mount(parent);\r\n  }\r\n\r\n  reassemble() {\r\n    this.widget.reassemble?.();\r\n    super.reassemble();\r\n  }\r\n\r\n  /**\r\n   * Perform rebuild\r\n   */\r\n  performRebuild() {\r\n    try {\r\n      return this.widget.build(this.context);\r\n    } catch (error) {\r\n      console.error(`build error: ${error}`);\r\n      return new ErrorWidget({ message: error.toString() });\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// 7. STATEFUL WIDGET & ELEMENT\r\n// ============================================================================\r\n\r\n/**\r\n * StatefulWidget - Widget that holds mutable state\r\n */\r\nclass StatefulWidget extends Widget {\r\n  constructor(key = null) {\r\n    super(key);\r\n  }\r\n\r\n  /**\r\n   * Create the state object\r\n   */\r\n  createState() {\r\n    throw new Error(`${this.constructor.name}.createState() must be implemented`);\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Create element for this widget\r\n   */\r\n  createElement() {\r\n    return new StatefulElement(this);\r\n  }\r\n\r\n\r\n  // New: Called during hot reload\r\n  reassemble() { }\r\n}\r\n\r\n/**\r\n * StatefulElement - Element for stateful widget\r\n */\r\nclass StatefulElement extends Element {\r\n  constructor(widget) {\r\n    super(widget);\r\n    this.state = widget.createState();\r\n    this.state._element = this;\r\n    this.state.widget = widget;\r\n  }\r\n\r\n  /**\r\n   * Mount the element\r\n   */\r\n\r\n  mount(parent = null) {\r\n    super.mount(parent);        // sets _parent, _depth, creates BuildContext, \u2026\r\n    this.state._mount(this);    // <-- ONE LINE DOES IT ALL\r\n  }\r\n  // mount(parent = null) {\r\n  //   super.mount(parent);\r\n  //   this.state._mount(this);\r\n  //   this.state._mounted = true;\r\n\r\n  //   // Initialize state (call only once)\r\n  //   if (!this.state._didInitState) {\r\n  //     this.state._didInitState = true;\r\n  //     try {\r\n  //       this.state.initState();\r\n  //     } catch (error) {\r\n  //       console.error(`initState error in ${this._debugLabel}:`, error);\r\n  //     }\r\n  //   }\r\n\r\n  //   // Notify of dependencies\r\n  //   try {\r\n  //     this.state.didChangeDependencies();\r\n  //   } catch (error) {\r\n  //     console.error(`didChangeDependencies error in ${this._debugLabel}:`, error);\r\n  //   }\r\n  // }\r\n\r\n  /**\r\n   * Unmount the element\r\n   */\r\n  unmount() {\r\n    try {\r\n      this.state.dispose();\r\n    } catch (error) {\r\n      console.error(`dispose error in ${this._debugLabel}:`, error);\r\n    }\r\n\r\n    this.state._unmount();\r\n    super.unmount();\r\n  }\r\n\r\n  activate() {\r\n    this.state._reactivate();          // Use hook\r\n    super.activate?.();                // optional if base has it\r\n  }\r\n\r\n  /**\r\n   * Deactivate the element\r\n   */\r\n  deactivate() {\r\n    try {\r\n      this.state.deactivate();\r\n    } catch (error) {\r\n      console.error(`deactivate error in ${this._debugLabel}:`, error);\r\n    }\r\n    this.state._deactivate();\r\n    super.deactivate();\r\n  }\r\n\r\n  /**\r\n   * Update widget\r\n   */\r\n  updateWidget(newWidget) {\r\n    const oldWidget = this.widget;\r\n    this.widget = newWidget;\r\n    this.state._updateWidget(newWidget);   // Use internal hook\r\n\r\n    try {\r\n      this.state.didUpdateWidget(oldWidget);\r\n    } catch (error) {\r\n      console.error(`didUpdateWidget error in ${this._debugLabel}:`, error);\r\n    }\r\n\r\n    this.markNeedsBuild();\r\n  }\r\n\r\n  /**\r\n   * Perform rebuild\r\n   */\r\n  performRebuild() {\r\n    try {\r\n      return this.state.build(this.context);\r\n    } catch (error) {\r\n      console.error(`build error in ${this._debugLabel}:`, error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  reassemble() {\r\n    try {\r\n      this.state.reassemble();\r\n    } catch (error) {\r\n      console.error(`reassemble error: ${error}`);\r\n    }\r\n    super.reassemble();\r\n  }\r\n\r\n  didChangeDependencies() {\r\n    try {\r\n      this.state.didChangeDependencies();\r\n    } catch (error) {\r\n      console.error(`didChangeDependencies error: ${error}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Debug properties for StatefulElement\r\n   */\r\n  debugFillProperties(properties) {\r\n    super.debugFillProperties(properties);\r\n    properties.push({ name: 'stateType', value: this.state.constructor.name });\r\n    properties.push({ name: 'stateInitialized', value: this.state._didInitState });\r\n  }\r\n}\r\n\r\n\r\n\r\nclass ErrorWidget extends StatelessWidget {\r\n  constructor({ message = 'Error', error = null } = {}) {\r\n    super();\r\n    this.message = message;\r\n    this.error = error;\r\n  }\r\n\r\n  build(context) {\r\n    return new VNode({\r\n      tag: 'div',\r\n      props: {\r\n        style: {\r\n          backgroundColor: '#ff1744',\r\n          color: 'white',\r\n          padding: '16px',\r\n          borderRadius: '4px',\r\n          fontFamily: 'monospace',\r\n          fontSize: '12px',\r\n          whiteSpace: 'pre-wrap',\r\n          wordBreak: 'break-word'\r\n        }\r\n      },\r\n      children: [this.message]\r\n    });\r\n  }\r\n}\r\n\r\n\r\nclass Notification {\r\n  constructor() {\r\n    if (new.target === Notification) {\r\n      throw new Error('Notification is abstract');\r\n    }\r\n  }\r\n\r\n  dispatch(context) {\r\n    context.dispatchNotification(this);\r\n  }\r\n}\r\n\r\nclass NotificationListener extends ProxyWidget {\r\n  constructor({ key = null, child = null, onNotification = null } = {}) {\r\n    super({ key, child });\r\n    this.onNotification = onNotification;\r\n  }\r\n\r\n  createElement() {\r\n    return new NotificationListenerElement(this);\r\n  }\r\n}\r\n\r\n\r\nclass Key {\r\n  constructor() {\r\n    if (new.target === Key) {\r\n      throw new Error('Key is abstract');\r\n    }\r\n  }\r\n}\r\n\r\nclass ValueKey extends Key {\r\n  constructor(value) {\r\n    super();\r\n    this.value = value;\r\n  }\r\n\r\n  equals(other) {\r\n    return other instanceof ValueKey && this.value === other.value;\r\n  }\r\n\r\n  toString() {\r\n    return `ValueKey(${this.value})`;\r\n  }\r\n}\r\n\r\nclass ObjectKey extends Key {\r\n  constructor(value) {\r\n    super();\r\n    this.value = value;\r\n  }\r\n\r\n  equals(other) {\r\n    return other instanceof ObjectKey && this.value === other.value;\r\n  }\r\n\r\n  toString() {\r\n    return `ObjectKey(${this.value})`;\r\n  }\r\n}\r\n\r\nclass GlobalKey extends Key {\r\n  constructor(debugLabel = null) {\r\n    super();\r\n    this.debugLabel = debugLabel;\r\n    this._currentElement = null;\r\n  }\r\n\r\n  get currentContext() {\r\n    return this._currentElement?.context || null;\r\n  }\r\n\r\n  get currentWidget() {\r\n    return this._currentElement?.widget || null;\r\n  }\r\n\r\n  get currentState() {\r\n    return this._currentElement?.state || null;\r\n  }\r\n\r\n  equals(other) {\r\n    return other instanceof GlobalKey && this === other;\r\n  }\r\n\r\n  toString() {\r\n    return `GlobalKey${this.debugLabel ? `(${this.debugLabel})` : ''}`;\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// 2. PROXY WIDGET - Base for wrapping widgets\r\n// ============================================================================\r\n\r\nclass ProxyWidget extends Widget {\r\n  constructor({ key = null, child = null } = {}) {\r\n    super(key);\r\n    if (new.target === ProxyWidget) {\r\n      throw new Error('ProxyWidget is abstract');\r\n    }\r\n    this.child = child;\r\n  }\r\n\r\n  createElement() {\r\n    return new ProxyElement(this);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// 3. INHERITED WIDGET - Ambient state propagation\r\n// ============================================================================\r\n\r\nclass InheritedWidget extends ProxyWidget {\r\n  constructor({ key = null, child = null } = {}) {\r\n    super({ key, child });\r\n  }\r\n\r\n  /**\r\n   * Override to return true when dependent widgets should rebuild\r\n   */\r\n  updateShouldNotify(oldWidget) {\r\n    throw new Error(\r\n      `${this.constructor.name}.updateShouldNotify() must be implemented`\r\n    );\r\n  }\r\n\r\n  createElement() {\r\n    return new InheritedElement(this);\r\n  }\r\n\r\n  static of(context, widgetType) {\r\n    return context.dependOnInheritedWidgetOfExactType(widgetType);\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// EXPORTS\r\n// ============================================================================\r\n\r\nexport {\r\n  GlobalKey,\r\n  ValueKey,\r\n  ObjectKey,\r\n  Key,\r\n  ProxyWidget,\r\n  InheritedWidget,\r\n  Notification,\r\n  NotificationListener,\r\n  ErrorWidget,\r\n  Diagnosticable,\r\n  Widget,\r\n  Element,\r\n  StatelessWidget,\r\n  StatelessElement,\r\n  StatefulWidget,\r\n  StatefulElement\r\n};"],
  "mappings": "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",
  "names": ["Diagnosticable", "Element", "VNode", "Widget", "key", "properties", "StatelessWidget", "context", "StatelessElement", "widget", "parent", "error", "ErrorWidget", "StatefulWidget", "StatefulElement", "newWidget", "oldWidget", "message", "Notification", "NotificationListener", "ProxyWidget", "child", "onNotification", "Key", "ValueKey", "value", "other", "ObjectKey", "GlobalKey", "debugLabel", "InheritedWidget", "widgetType"]
}
