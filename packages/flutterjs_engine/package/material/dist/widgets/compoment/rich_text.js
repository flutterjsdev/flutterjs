import{Widget as A}from"../../core/widget_element.js";import{Element as B}from"@flutterjs/runtime";import{VNode as d}from"@flutterjs/vdom/vnode";import{TextDirection as c}from"../../utils/utils.js";const a={left:"left",right:"right",center:"center",justify:"justify",start:"start",end:"end"},u={clip:"clip",fade:"fade",ellipsis:"ellipsis",visible:"visible"},C={parent:"parent",longestLine:"longestLine"},k={alphabetic:"alphabetic",ideographic:"ideographic"};class f{constructor(t=1){this.textScaleFactor=t}static get noScaling(){return new f(1)}static linear(t=1){return new f(t)}scale(t){return t*this.textScaleFactor}toString(){return`TextScaler(${this.textScaleFactor})`}}class m{constructor(){if(new.target===m)throw new Error("InlineSpan is abstract")}toPlainText(){throw new Error("toPlainText() must be implemented")}buildVNode(){throw new Error("buildVNode() must be implemented")}}class F extends m{constructor({text:t="",style:e=null,children:i=[],recognizer:s=null}={}){super(),this.text=t,this.style=e||{},this.children=i||[],this.recognizer=s}toPlainText(){let t=this.text||"";if(this.children&&this.children.length>0)for(const e of this.children)t+=e.toPlainText?.()||"";return t}buildVNode(t=a.start,e=c.ltr){const i=this._getTextStyle(t,e),s=this.children.map(n=>n instanceof F?n.buildVNode(t,e):n instanceof v?n.buildVNode():new d({tag:"span",children:[String(n)]}));return this.text&&s.unshift(new d({tag:"span",children:[this.text]})),new d({tag:"span",props:{style:i,onClick:this.recognizer?.onTap,onMouseDown:this.recognizer?.onLongPress},children:s.length>0?s:[this.text||""]})}_getTextStyle(t,e){const i={...this.style};return typeof this.style=="string"?{}:i}}class v extends m{constructor({child:t=null,alignment:e="baseline",baseline:i=k.alphabetic,style:s=null}={}){super(),this.child=t,this.alignment=e,this.baseline=i,this.style=s}toPlainText(){return"\uFFFD"}buildVNode(){if(!this.child)return new d({tag:"span",children:["\uFFFD"]});const t=this.child.createElement?.();return t?t.performRebuild?.():new d({tag:"span",props:{style:{display:"inline-flex",alignItems:this.alignment,verticalAlign:this.baseline}},children:[this.child]})}static extractFromInlineSpan(t,e){const i=[];function s(n){if(n instanceof v&&i.push(n.child),n.children)for(const r of n.children)s(r)}return s(t),i}}class T{constructor({color:t=null,fontSize:e=14,fontWeight:i="normal",fontStyle:s="normal",fontFamily:n=null,height:r=null,letterSpacing:o=null,wordSpacing:l=null,textDecoration:h="none",decorationColor:g=null,decorationStyle:x="solid",decorationThickness:p=1,backgroundColor:S=null,foregroundColor:w=null,shadows:y=[],fontFeatures:b=[],fontVariations:R=[]}={}){this.color=t,this.fontSize=e,this.fontWeight=i,this.fontStyle=s,this.fontFamily=n,this.height=r,this.letterSpacing=o,this.wordSpacing=l,this.textDecoration=h,this.decorationColor=g,this.decorationStyle=x,this.decorationThickness=p,this.backgroundColor=S,this.foregroundColor=w,this.shadows=y,this.fontFeatures=b,this.fontVariations=R}toCSSStyle(){const t={fontSize:`${this.fontSize}px`,fontWeight:this.fontWeight,fontStyle:this.fontStyle,textDecoration:this.textDecoration,textDecorationColor:this.decorationColor,textDecorationThickness:`${this.decorationThickness}px`,textDecorationStyle:this.decorationStyle};return this.color&&(t.color=this.color),this.fontFamily&&(t.fontFamily=this.fontFamily),this.height&&(t.lineHeight=this.height),this.letterSpacing&&(t.letterSpacing=`${this.letterSpacing}px`),this.wordSpacing&&(t.wordSpacing=`${this.wordSpacing}px`),this.backgroundColor&&(t.backgroundColor=this.backgroundColor),this.shadows&&this.shadows.length>0&&(t.textShadow=this.shadows.map(e=>`${e.offsetX}px ${e.offsetY}px ${e.blurRadius}px ${e.color}`).join(", ")),t}merge(t){return t?new T({color:t.color??this.color,fontSize:t.fontSize??this.fontSize,fontWeight:t.fontWeight??this.fontWeight,fontStyle:t.fontStyle??this.fontStyle,fontFamily:t.fontFamily??this.fontFamily,height:t.height??this.height,letterSpacing:t.letterSpacing??this.letterSpacing,wordSpacing:t.wordSpacing??this.wordSpacing,textDecoration:t.textDecoration??this.textDecoration,decorationColor:t.decorationColor??this.decorationColor,decorationStyle:t.decorationStyle??this.decorationStyle,decorationThickness:t.decorationThickness??this.decorationThickness,backgroundColor:t.backgroundColor??this.backgroundColor,foregroundColor:t.foregroundColor??this.foregroundColor}):this}}class z{constructor({fontFamily:t=null,fontFamilyFallback:e=[],fontSize:i=null,height:s=null,leading:n=null,fontWeight:r=null,fontStyle:o=null,forceStrutHeight:l=!1}={}){this.fontFamily=t,this.fontFamilyFallback=e,this.fontSize=i,this.height=s,this.leading=n,this.fontWeight=r,this.fontStyle=o,this.forceStrutHeight=l}toCSSStyle(){const t={};return this.fontFamily&&(t.fontFamily=this.fontFamily),this.fontSize&&(t.fontSize=`${this.fontSize}px`),this.height&&(t.lineHeight=this.height),this.fontWeight&&(t.fontWeight=this.fontWeight),this.fontStyle&&(t.fontStyle=this.fontStyle),t}}class D{constructor({text:t=null,textAlign:e=a.start,textDirection:i=c.ltr,softWrap:s=!0,overflow:n=u.clip,textScaler:r=null,maxLines:o=null,locale:l=null,strutStyle:h=null,textWidthBasis:g=C.parent,textHeightBehavior:x=null,selectionColor:p=null,registrar:S=null}={}){this.text=t,this.textAlign=e,this.textDirection=i,this.softWrap=s,this.overflow=n,this.textScaler=r||f.noScaling,this.maxLines=o,this.locale=l,this.strutStyle=h,this.textWidthBasis=g,this.textHeightBehavior=x,this.selectionColor=p,this.registrar=S}debugInfo(){return{type:"RenderParagraph",textAlign:this.textAlign,textDirection:this.textDirection,softWrap:this.softWrap,overflow:this.overflow,maxLines:this.maxLines,textScaleFactor:this.textScaler.textScaleFactor}}}class P extends A{constructor({key:t=null,text:e=null,textAlign:i=a.start,textDirection:s=null,softWrap:n=!0,overflow:r=u.clip,textScaleFactor:o=1,textScaler:l=null,maxLines:h=null,locale:g=null,strutStyle:x=null,textWidthBasis:p=C.parent,textHeightBehavior:S=null,selectionRegistrar:w=null,selectionColor:y=null}={}){if(super(t),!e)throw new Error("RichText requires a text (InlineSpan)");if(h!==null&&h<=0)throw new Error("maxLines must be null or > 0");if(w&&!y)throw new Error("selectionColor is required when selectionRegistrar is provided");let b=l||f.noScaling;o!==1&&l===null&&(b=f.linear(o)),this.text=e,this.textAlign=i,this.textDirection=s,this.softWrap=n,this.overflow=r,this.textScaler=b,this.maxLines=h,this.locale=g,this.strutStyle=x,this.textWidthBasis=p,this.textHeightBehavior=S,this.selectionRegistrar=w,this.selectionColor=y,this._renderObject=null}createRenderObject(t){return new D({text:this.text,textAlign:this.textAlign,textDirection:this.textDirection||t?.textDirection||c.ltr,softWrap:this.softWrap,overflow:this.overflow,textScaler:this.textScaler,maxLines:this.maxLines,locale:this.locale,strutStyle:this.strutStyle,textWidthBasis:this.textWidthBasis,textHeightBehavior:this.textHeightBehavior,selectionColor:this.selectionColor,registrar:this.selectionRegistrar})}updateRenderObject(t,e){e.text=this.text,e.textAlign=this.textAlign,e.textDirection=this.textDirection||t?.textDirection||c.ltr,e.softWrap=this.softWrap,e.overflow=this.overflow,e.textScaler=this.textScaler,e.maxLines=this.maxLines,e.locale=this.locale,e.strutStyle=this.strutStyle,e.textWidthBasis=this.textWidthBasis,e.textHeightBehavior=this.textHeightBehavior,e.selectionColor=this.selectionColor,e.registrar=this.selectionRegistrar}build(t){this._renderObject?this.updateRenderObject(t,this._renderObject):this._renderObject=this.createRenderObject(t);const e=t.element.getElementId(),i=t.element.getWidgetPath(),s=this.textDirection||t?.textDirection||c.ltr,n=this.text.buildVNode(this.textAlign,s),r=this._mapTextAlign(this.textAlign,s);let o={};switch(this.overflow){case u.ellipsis:o={overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"};break;case u.fade:o={overflow:"hidden",mask:"linear-gradient(to right, black 95%, transparent)"};break;case u.clip:o={overflow:"hidden"};break;case u.visible:o={overflow:"visible"};break}const l={textAlign:r,direction:s===c.rtl?"rtl":"ltr",whiteSpace:this.softWrap?"normal":"nowrap",wordWrap:this.softWrap?"break-word":"normal",display:"block",...o};return this.maxLines!==null&&(l.display="-webkit-box",l.WebkitLineClamp=this.maxLines,l.WebkitBoxOrient="vertical",l.overflow="hidden"),this.strutStyle&&Object.assign(l,this.strutStyle.toCSSStyle()),this.selectionColor&&(l.userSelect="text"),new d({tag:"div",props:{style:l,"data-element-id":e,"data-widget-path":i,"data-widget":"RichText","data-text-align":this.textAlign,"data-text-direction":s,"data-overflow":this.overflow,"data-max-lines":this.maxLines,"data-soft-wrap":this.softWrap},children:[n],key:this.key})}_mapTextAlign(t,e){const i=e===c.rtl;switch(typeof t=="string"&&t.startsWith(".")&&(t=t.substring(1)),t){case a.start:return i?"right":"left";case a.end:return i?"left":"right";case a.left:return"left";case a.right:return"right";case a.center:return"center";case a.justify:return"justify";default:return"start"}}debugFillProperties(t){super.debugFillProperties(t),t.push({name:"textAlign",value:this.textAlign}),t.push({name:"textDirection",value:this.textDirection}),t.push({name:"softWrap",value:this.softWrap}),t.push({name:"overflow",value:this.overflow}),t.push({name:"textScaleFactor",value:this.textScaler.textScaleFactor}),t.push({name:"maxLines",value:this.maxLines}),t.push({name:"text",value:this.text.toPlainText?.()||"N/A"})}createElement(t,e){return new L(this,t,e)}}class L extends B{performRebuild(){return this.widget.build(this.context)}}export{m as InlineSpan,D as RenderParagraph,P as RichText,L as RichTextElement,z as StrutStyle,a as TextAlign,k as TextBaseline,u as TextOverflow,f as TextScaler,F as TextSpan,T as TextStyle,C as TextWidthBasis,v as WidgetSpan};
//# sourceMappingURL=rich_text.js.map
