import{Widget as A}from"../../core/widget_element.js";import{Element as v}from"@flutterjs/runtime";import{VNode as p}from"@flutterjs/vdom/vnode";import{Axis as m,TextDirection as w,VerticalDirection as b,Clip as u,MainAxisAlignment as S,CrossAxisAlignment as g,FlexFit as D,WrapAlignment as C,WrapCrossAlignment as I}from"../../utils/utils.js";const x={min:"min",max:"max"};class R{constructor(){this.flex=null,this.fit=D.loose}debugInfo(){return{flex:this.flex,fit:this.fit}}}class _{constructor({direction:e=m.horizontal,mainAxisAlignment:t=S.start,mainAxisSize:i=x.max,crossAxisAlignment:n=g.center,textDirection:r=w.ltr,verticalDirection:a=b.down,textBaseline:c=null,clipBehavior:o=u.none,spacing:s=0}={}){this.direction=e,this.mainAxisAlignment=t,this.mainAxisSize=i,this.crossAxisAlignment=n,this.textDirection=r,this.verticalDirection=a,this.textBaseline=c,this.clipBehavior=o,this.spacing=s,this._children=[]}addChild(e){this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);t>-1&&this._children.splice(t,1)}debugInfo(){return{type:"RenderFlex",direction:this.direction,mainAxisAlignment:this.mainAxisAlignment,mainAxisSize:this.mainAxisSize,crossAxisAlignment:this.crossAxisAlignment,textDirection:this.textDirection,spacing:this.spacing,childCount:this._children.length}}}class B extends A{constructor({key:e=null,direction:t=m.horizontal,mainAxisAlignment:i=S.start,mainAxisSize:n=x.max,crossAxisAlignment:r=g.center,textDirection:a=null,verticalDirection:c=b.down,textBaseline:o=null,clipBehavior:s=u.none,spacing:h=0,children:d=[]}={}){if(super(e),r===g.baseline&&!o)throw new Error("textBaseline is required when crossAxisAlignment is CrossAxisAlignment.baseline");this.direction=t,this.mainAxisAlignment=i,this.mainAxisSize=n,this.crossAxisAlignment=r,this.textDirection=a,this.verticalDirection=c,this.textBaseline=o,this.clipBehavior=s,this.spacing=h,this.children=d||[],this._renderObject=null}_needTextDirection(){return this.direction===m.horizontal?!0:this.crossAxisAlignment===g.start||this.crossAxisAlignment===g.end}getEffectiveTextDirection(e){return this.textDirection?this.textDirection:this._needTextDirection()?e?.textDirection||w.ltr:null}createRenderObject(e){return new _({direction:this.direction,mainAxisAlignment:this.mainAxisAlignment,mainAxisSize:this.mainAxisSize,crossAxisAlignment:this.crossAxisAlignment,textDirection:this.getEffectiveTextDirection(e),verticalDirection:this.verticalDirection,textBaseline:this.textBaseline,clipBehavior:this.clipBehavior,spacing:this.spacing})}updateRenderObject(e,t){t.direction=this.direction,t.mainAxisAlignment=this.mainAxisAlignment,t.mainAxisSize=this.mainAxisSize,t.crossAxisAlignment=this.crossAxisAlignment,t.textDirection=this.getEffectiveTextDirection(e),t.verticalDirection=this.verticalDirection,t.textBaseline=this.textBaseline,t.clipBehavior=this.clipBehavior,t.spacing=this.spacing}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);const t=e.element.getElementId(),i=e.element.getWidgetPath(),n=this._mapMainAxisAlignment(),r=this._mapCrossAxisAlignment();var a=this.direction===m.horizontal?"row":"column";this.verticalDirection===b.up&&this.direction===m.vertical&&(a="column-reverse");const c=this.clipBehavior===u.none?"visible":"hidden",o={display:"flex",flexDirection:a,justifyContent:n,alignItems:r,gap:`${this.spacing}px`,width:this.mainAxisSize===x.max?"100%":"auto",height:this.mainAxisSize===x.max?"100%":"auto",direction:this.textDirection===w.rtl?"rtl":"ltr",overflow:c,flexWrap:"nowrap"},s=this.children.map((h,d)=>{console.log(`[Flex.build] Building child ${d}:`,h?.constructor?.name,"has createElement:",typeof h?.createElement);const y=h.createElement(e.element,e.element.runtime);console.log(`[Flex.build] Child ${d} element:`,y?.constructor?.name),y.mount(e.element);const F=y.performRebuild();console.log(`[Flex.build] Child ${d} VNode:`,F?.constructor?.name,"tag:",F?.tag);let f={};return h instanceof z&&(h.fit===D.tight?f.flex=h.flex||1:(f.flex=0,f.flexShrink=0)),new p({tag:"div",props:{style:{...f,minWidth:0,minHeight:0}},children:[F]})});return new p({tag:"div",props:{style:o,"data-element-id":t,"data-widget-path":i,"data-widget":"Flex","data-direction":this.direction,"data-main-axis":this.mainAxisAlignment,"data-cross-axis":this.crossAxisAlignment,"data-spacing":this.spacing},children:s,key:this.key})}_mapMainAxisAlignment(){let e=this.mainAxisAlignment;return typeof e=="string"&&e.startsWith(".")&&(e=e.substring(1)),{start:"flex-start",end:"flex-end",center:"center",spaceBetween:"space-between",spaceAround:"space-around",spaceEvenly:"space-evenly"}[e]||"flex-start"}_mapCrossAxisAlignment(){let e=this.crossAxisAlignment;return typeof e=="string"&&e.startsWith(".")&&(e=e.substring(1)),{start:"flex-start",end:"flex-end",center:"center",stretch:"stretch",baseline:"baseline"}[e]||"center"}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"direction",value:this.direction}),e.push({name:"mainAxisAlignment",value:this.mainAxisAlignment}),e.push({name:"mainAxisSize",value:this.mainAxisSize}),e.push({name:"crossAxisAlignment",value:this.crossAxisAlignment}),e.push({name:"textDirection",value:this.textDirection}),e.push({name:"spacing",value:this.spacing}),e.push({name:"childCount",value:this.children.length})}createElement(e,t){return new P(this,e,t)}}class P extends v{performRebuild(){return this.widget.build(this.context)}}class N extends B{constructor(e={}){super({...e,direction:m.horizontal})}}class T extends B{constructor(e={}){super({...e,direction:m.vertical})}}class z extends A{constructor({key:e=null,flex:t=1,fit:i=D.loose,child:n=null}={}){if(super(e),t<=0)throw new Error("flex must be > 0");this.flex=t,this.fit=i,this.child=n}applyParentData(e){e.parentData||(e.parentData=new R);const t=e.parentData;let i=!1;t.flex!==this.flex&&(t.flex=this.flex,i=!0),t.fit!==this.fit&&(t.fit=this.fit,i=!0),i&&e.parent&&e.parent.markNeedsLayout?.()}build(e){if(!this.child)return null;const t=this.child.createElement(e.element,e.element.runtime);return t.mount(e.element),t.performRebuild()}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"flex",value:this.flex}),e.push({name:"fit",value:this.fit})}createElement(e,t){return new V(this,e,t)}}class V extends v{performRebuild(){return this.widget.build(this.context)}}class $ extends z{constructor({key:e=null,flex:t=1,child:i=null}={}){super({key:e,flex:t,fit:D.tight,child:i})}}class M extends A{constructor({key:e=null,direction:t=m.horizontal,alignment:i=C.start,spacing:n=0,runAlignment:r=C.start,runSpacing:a=0,crossAxisAlignment:c=I.start,textDirection:o=null,verticalDirection:s=b.down,clipBehavior:h=u.none,children:d=[]}={}){super(e),this.direction=t,this.alignment=i,this.spacing=n,this.runAlignment=r,this.runSpacing=a,this.crossAxisAlignment=c,this.textDirection=o,this.verticalDirection=s,this.clipBehavior=h,this.children=d||[]}_mapAlignment(){let e=this.alignment;return typeof e=="string"&&e.startsWith(".")&&(e=e.substring(1)),{start:"flex-start",end:"flex-end",center:"center",spaceBetween:"space-between",spaceAround:"space-around",spaceEvenly:"space-evenly"}[e]||"flex-start"}_mapRunAlignment(){let e=this.runAlignment;return typeof e=="string"&&e.startsWith(".")&&(e=e.substring(1)),{start:"flex-start",end:"flex-end",center:"center",spaceBetween:"space-between",spaceAround:"space-around",spaceEvenly:"space-evenly"}[e]||"flex-start"}build(e){const t=e.element.getElementId(),i=e.element.getWidgetPath(),n=this.direction===m.horizontal?"row":"column",r=this.clipBehavior===u.none?"visible":"hidden",a={display:"flex",flexDirection:n,flexWrap:"wrap",justifyContent:this._mapAlignment(),alignContent:this._mapRunAlignment(),gap:`${this.spacing}px ${this.runSpacing}px`,direction:this.textDirection===w.rtl?"rtl":"ltr",overflow:r},c=this.children.map(o=>{const s=o.createElement(e.element,e.element.runtime);return s.mount(e.element),s.performRebuild()});return new p({tag:"div",props:{style:a,"data-element-id":t,"data-widget-path":i,"data-widget":"Wrap","data-direction":this.direction,"data-alignment":this.alignment,"data-spacing":this.spacing},children:c,key:this.key})}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"direction",value:this.direction}),e.push({name:"alignment",value:this.alignment}),e.push({name:"spacing",value:this.spacing}),e.push({name:"runAlignment",value:this.runAlignment}),e.push({name:"runSpacing",value:this.runSpacing}),e.push({name:"childCount",value:this.children.length})}createElement(e,t){return new W(this,e,t)}}class W extends v{performRebuild(){return this.widget.build(this.context)}}class E{constructor(){if(new.target===E)throw new Error("FlowDelegate is abstract")}getSize(e){throw new Error("getSize() must be implemented")}paintChildren(e,t){throw new Error("paintChildren() must be implemented")}shouldRepaint(e){return!0}shouldReflow(e){return!0}}class q extends A{constructor({key:e=null,delegate:t=null,clipBehavior:i=u.hardEdge,children:n=[]}={}){if(super(e),!t)throw new Error("Flow requires a delegate");if(!(t instanceof E))throw new Error("delegate must be an instance of FlowDelegate");this.delegate=t,this.clipBehavior=i,this.children=n||[]}build(e){const t=e.element.getElementId(),i=e.element.getWidgetPath(),r={position:"relative",display:"inline-block",overflow:this.clipBehavior===u.none?"visible":"hidden"},a=this.children.map((c,o)=>{const s=c.createElement(e.element,e.element.runtime);s.mount(e.element);const h=s.performRebuild();return new p({tag:"div",props:{style:{position:"absolute",left:0,top:0},"data-flow-index":o},children:[h]})});return new p({tag:"div",props:{style:r,"data-element-id":t,"data-widget-path":i,"data-widget":"Flow","data-clip-behavior":this.clipBehavior,"data-child-count":this.children.length},children:a,key:this.key})}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"delegate",value:this.delegate.constructor.name}),e.push({name:"clipBehavior",value:this.clipBehavior}),e.push({name:"childCount",value:this.children.length})}createElement(e,t){return new k(this,e,t)}}class k extends v{performRebuild(){return this.widget.build(this.context)}}export{T as Column,$ as Expanded,B as Flex,P as FlexElement,R as FlexParentData,z as Flexible,V as FlexibleElement,q as Flow,E as FlowDelegate,k as FlowElement,x as MainAxisSize,_ as RenderFlex,N as Row,M as Wrap,W as WrapElement};
//# sourceMappingURL=multi_child_view.js.map
