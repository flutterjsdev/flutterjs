import{ProxyWidget as f,Widget as c}from"../../core/widget_element.js";import{VNode as g}from"@flutterjs/vdom/vnode";class o{constructor(e=0,t=0){this.width=e,this.height=t}static get zero(){return new o(0,0)}static get infinite(){return new o(1/0,1/0)}get isInfinite(){return this.width===1/0||this.height===1/0}get isFinite(){return isFinite(this.width)&&isFinite(this.height)}toString(){return`Size(${this.width}, ${this.height})`}}class u{constructor(e=0,t=1/0,n=0,l=1/0){this.minWidth=e,this.maxWidth=t,this.minHeight=n,this.maxHeight=l}static tight(e){return new u(e.width,e.width,e.height,e.height)}static loose(e){return new u(0,e.width,0,e.height)}static expand({width:e=1/0,height:t=1/0}={}){return new u(0,e,0,t)}get isTight(){return this.minWidth===this.maxWidth&&this.minHeight===this.maxHeight}constrain(e){return new o(Math.max(this.minWidth,Math.min(this.maxWidth,e.width)),Math.max(this.minHeight,Math.min(this.maxHeight,e.height)))}toString(){return`BoxConstraints(${this.minWidth}..${this.maxWidth}, ${this.minHeight}..${this.maxHeight})`}}class m{constructor(){if(new.target===m)throw new Error("SingleChildLayoutDelegate is abstract")}getConstraintsForChild(e){throw new Error("getConstraintsForChild() must be implemented")}positionChild(e,t){throw new Error("positionChild() must be implemented")}getSize(e){return e.constrain(new o(300,300))}shouldRelayout(e){return!0}}class C extends f{constructor({key:e=null,delegate:t=null,child:n=null}={}){if(super({key:e,child:n}),!t)throw new Error("CustomSingleChildLayout requires a delegate");if(!(t instanceof m))throw new Error(`CustomSingleChildLayout requires a SingleChildLayoutDelegate instance, got: ${typeof t}`);this.delegate=t,this._renderObject=null,this._containerElement=null,this._childElement=null,this._resizeObserver=null}createRenderObject(e){return new _({delegate:this.delegate})}updateRenderObject(e,t){this.delegate.shouldRelayout(t.delegate)&&(t.delegate=this.delegate)}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const i=this.child.createElement();i.mount(e.element),t=i.performRebuild()}const n=e.element.getElementId(),l=e.element.getWidgetPath();return new g({tag:"div",props:{style:{position:"relative",display:"inline-block"},"data-element-id":n,"data-widget-path":l,"data-widget":"CustomSingleChildLayout",ref:i=>this._onContainerMount(i)},children:[new g({tag:"div",props:{style:{position:"absolute"},ref:i=>this._onChildMount(i)},children:t?[t]:[]})],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._performLayout()}),this._resizeObserver.observe(e));const t=()=>this._performLayout();window.addEventListener("resize",t),e._cleanupResize=()=>{window.removeEventListener("resize",t),this._resizeObserver&&this._resizeObserver.disconnect()},this._performLayout()}_onChildMount(e){e&&(this._childElement=e,this._performLayout())}_performLayout(){if(!(!this._containerElement||!this._childElement||!this.delegate))try{const e=this._containerElement.getBoundingClientRect(),t=new o(e.width||300,e.height||300),n=u.expand({width:t.width,height:t.height}),l=this.delegate.getConstraintsForChild(n),i=this._childElement.getBoundingClientRect(),d=new o(i.width||100,i.height||100),s=l.constrain(d),r=this.delegate.positionChild(t,s);this._childElement.style.left=`${r.x}px`,this._childElement.style.top=`${r.y}px`,this._childElement.style.width=`${s.width}px`,this._childElement.style.height=`${s.height}px`;const h=this.delegate.getSize(n);this._containerElement.style.width=`${h.width}px`,this._containerElement.style.height=`${h.height}px`}catch(e){console.error("Error performing custom single child layout:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"delegate",value:this.delegate.constructor.name})}createElement(){return new L(this)}}class _{constructor({delegate:e=null}={}){this.delegate=e}debugInfo(){return{type:"RenderCustomSingleChildLayoutBox",delegateType:this.delegate?.constructor.name}}}class L extends f.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class p{constructor(){if(new.target===p)throw new Error("MultiChildLayoutDelegate is abstract")}performLayout(e,t){throw new Error("performLayout() must be implemented")}getSize(e){return e.constrain(new o(300,300))}shouldRelayout(e){return!0}}class w extends c{constructor({key:e=null,id:t=null,child:n=null}={}){if(super(e||{id:t}),!t)throw new Error("LayoutId requires an id");this.id=t,this.child=n}applyParentData(e){e.parentData||(e.parentData={}),e.parentData.id=this.id}build(e){return this.child}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"id",value:this.id})}createElement(){return new R(this)}}class R extends c.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}}class x extends c{constructor({key:e=null,delegate:t=null,children:n=[]}={}){if(super(e),!t)throw new Error("CustomMultiChildLayout requires a delegate");if(!(t instanceof p))throw new Error(`CustomMultiChildLayout requires a MultiChildLayoutDelegate instance, got: ${typeof t}`);this.delegate=t,this.children=n||[],this._renderObject=null,this._containerElement=null,this._childElements=new Map,this._resizeObserver=null}createRenderObject(e){return new E({delegate:this.delegate})}updateRenderObject(e,t){this.delegate.shouldRelayout(t.delegate)&&(t.delegate=this.delegate)}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);const t=e.element.getElementId(),n=e.element.getWidgetPath(),l=this.children.map((i,d)=>{let s=i;i instanceof w||(s=new w({id:d,child:i}));const r=s.createElement();return r.mount(e.element),r.performRebuild()});return new g({tag:"div",props:{style:{position:"relative",display:"inline-block"},"data-element-id":t,"data-widget-path":n,"data-widget":"CustomMultiChildLayout",ref:i=>this._onContainerMount(i)},children:l.map((i,d)=>new g({tag:"div",props:{style:{position:"absolute"},"data-layout-id":d,ref:s=>this._onChildMount(s,d)},children:[i]})),key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._performLayout()}),this._resizeObserver.observe(e));const t=()=>this._performLayout();window.addEventListener("resize",t),e._cleanupResize=()=>{window.removeEventListener("resize",t),this._resizeObserver&&this._resizeObserver.disconnect()},this._performLayout()}_onChildMount(e,t){e&&(this._childElements.set(t,e),this._performLayout())}_performLayout(){if(!(!this._containerElement||!this.delegate))try{const e=this._containerElement.getBoundingClientRect(),t=new o(e.width||300,e.height||300),n=u.expand({width:t.width,height:t.height}),l=(s,r)=>{const h=this._childElements.get(s);if(!h)return console.warn(`LayoutId ${s} not found`),new o(0,0);const y=h.getBoundingClientRect(),b=new o(y.width||100,y.height||100);return r.constrain(b)},i=this.delegate.performLayout(t,l);if(i&&typeof i=="object")for(const[s,r]of Object.entries(i)){const h=this._childElements.get(parseInt(s));h&&(h.style.left=`${r.x||0}px`,h.style.top=`${r.y||0}px`,r.width&&(h.style.width=`${r.width}px`),r.height&&(h.style.height=`${r.height}px`))}const d=this.delegate.getSize(n);this._containerElement.style.width=`${d.width}px`,this._containerElement.style.height=`${d.height}px`}catch(e){console.error("Error performing custom multi child layout:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"delegate",value:this.delegate.constructor.name}),e.push({name:"childCount",value:this.children.length})}createElement(){return new z(this)}}class E{constructor({delegate:e=null}={}){this.delegate=e}debugInfo(){return{type:"RenderCustomMultiChildLayoutBox",delegateType:this.delegate?.constructor.name}}}class z extends c.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}export{u as BoxConstraints,x as CustomMultiChildLayout,C as CustomSingleChildLayout,w as LayoutId,p as MultiChildLayoutDelegate,E as RenderCustomMultiChildLayoutBox,_ as RenderCustomSingleChildLayoutBox,m as SingleChildLayoutDelegate,o as Size};
//# sourceMappingURL=custom_single_child_layout.js.map
