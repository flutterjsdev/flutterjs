import{ProxyWidget as h}from"../../core/widget_element.js";import{VNode as c}from"@flutterjs/vdom/vnode";class o extends h{constructor({key:e=null,aspectRatio:t=1,child:n=null}={}){if(super({key:e,child:n}),t<=0)throw new Error(`aspectRatio must be > 0, got: ${t}`);this.aspectRatio=t,this._renderObject=null,this._containerElement=null,this._resizeObserver=null}createRenderObject(e){return{aspectRatio:this.aspectRatio}}updateRenderObject(e,t){t.aspectRatio=this.aspectRatio}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const i=this.child.createElement();i.mount(e.element),t=i.performRebuild()}const n=e.element.getElementId(),r=e.element.getWidgetPath(),l={position:"relative",width:"100%",paddingBottom:`${1/this.aspectRatio*100}%`,height:0,overflow:"hidden"};return new c({tag:"div",props:{style:l,"data-element-id":n,"data-widget-path":r,"data-widget":"AspectRatio","data-aspect-ratio":this.aspectRatio,ref:i=>this._onContainerMount(i)},children:[new c({tag:"div",props:{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}},children:t?[t]:[]})],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._updateAspectRatio()}),this._resizeObserver.observe(e));const t=()=>this._updateAspectRatio();window.addEventListener("resize",t),e._cleanupResize=()=>{window.removeEventListener("resize",t),this._resizeObserver&&this._resizeObserver.disconnect()}}_updateAspectRatio(){if(!this._containerElement)return;const e=1/this.aspectRatio*100;this._containerElement.style.paddingBottom=`${e}%`}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"aspectRatio",value:this.aspectRatio})}createElement(){return new u(this)}}class a{constructor({aspectRatio:e=1}={}){this.aspectRatio=e}debugInfo(){return{type:"RenderAspectRatio",aspectRatio:this.aspectRatio}}}class u extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class p extends h{constructor({key:e=null,stepWidth:t=null,stepHeight:n=null,child:r=null}={}){if(super({key:e,child:r}),t!==null&&t<0)throw new Error("stepWidth must be >= 0");if(n!==null&&n<0)throw new Error("stepHeight must be >= 0");this.stepWidth=t===0?null:t,this.stepHeight=n===0?null:n,this._renderObject=null,this._containerElement=null,this._childElement=null,this._resizeObserver=null}createRenderObject(e){return{stepWidth:this.stepWidth,stepHeight:this.stepHeight}}updateRenderObject(e,t){t.stepWidth=this.stepWidth,t.stepHeight=this.stepHeight}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const i=this.child.createElement();i.mount(e.element),t=i.performRebuild()}const n=e.element.getElementId(),r=e.element.getWidgetPath(),l={position:"relative",width:"fit-content",height:"auto"};return new c({tag:"div",props:{style:l,"data-element-id":n,"data-widget-path":r,"data-widget":"IntrinsicWidth","data-step-width":this.stepWidth,"data-step-height":this.stepHeight,ref:i=>this._onContainerMount(i)},children:[new c({tag:"div",props:{style:{position:"relative",width:"100%",height:"100%"},ref:i=>this._onChildMount(i)},children:t?[t]:[]})],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._calculateIntrinsicWidth()}),this._resizeObserver.observe(e));const t=()=>this._calculateIntrinsicWidth();window.addEventListener("resize",t),e._cleanupResize=()=>{window.removeEventListener("resize",t),this._resizeObserver&&this._resizeObserver.disconnect()},setTimeout(()=>this._calculateIntrinsicWidth(),0)}_onChildMount(e){e&&(this._childElement=e,this._calculateIntrinsicWidth())}_calculateIntrinsicWidth(){if(!(!this._containerElement||!this._childElement))try{const e=this._childElement.getBoundingClientRect();let t=e.width;if(this.stepWidth&&this.stepWidth>0&&(t=Math.ceil(t/this.stepWidth)*this.stepWidth),this.stepHeight&&this.stepHeight>0){let n=e.height;n=Math.ceil(n/this.stepHeight)*this.stepHeight,this._childElement.style.height=`${n}px`}this._containerElement.style.width=`${t}px`}catch(e){console.error("Error calculating intrinsic width:",e)}}debugFillProperties(e){super.debugFillProperties(e),this.stepWidth!==null&&e.push({name:"stepWidth",value:this.stepWidth}),this.stepHeight!==null&&e.push({name:"stepHeight",value:this.stepHeight})}createElement(){return new m(this)}}class g{constructor({stepWidth:e=null,stepHeight:t=null}={}){this.stepWidth=e,this.stepHeight=t}debugInfo(){return{type:"RenderIntrinsicWidth",stepWidth:this.stepWidth,stepHeight:this.stepHeight}}}class m extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class _ extends h{constructor({key:e=null,child:t=null}={}){super({key:e,child:t}),this._renderObject=null,this._containerElement=null,this._childElement=null,this._resizeObserver=null}createRenderObject(e){return{}}updateRenderObject(e,t){}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const i=this.child.createElement();i.mount(e.element),t=i.performRebuild()}const n=e.element.getElementId(),r=e.element.getWidgetPath(),l={position:"relative",width:"100%",height:"fit-content"};return new c({tag:"div",props:{style:l,"data-element-id":n,"data-widget-path":r,"data-widget":"IntrinsicHeight",ref:i=>this._onContainerMount(i)},children:[new c({tag:"div",props:{style:{position:"relative",width:"100%",height:"100%"},ref:i=>this._onChildMount(i)},children:t?[t]:[]})],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._calculateIntrinsicHeight()}),this._resizeObserver.observe(e));const t=()=>this._calculateIntrinsicHeight();window.addEventListener("resize",t),e._cleanupResize=()=>{window.removeEventListener("resize",t),this._resizeObserver&&this._resizeObserver.disconnect()},setTimeout(()=>this._calculateIntrinsicHeight(),0)}_onChildMount(e){e&&(this._childElement=e,this._calculateIntrinsicHeight())}_calculateIntrinsicHeight(){if(!(!this._containerElement||!this._childElement))try{const t=this._childElement.getBoundingClientRect().height;this._containerElement.style.height=`${t}px`}catch(e){console.error("Error calculating intrinsic height:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"type",value:"IntrinsicHeight"})}createElement(){return new w(this)}}class b{constructor(){}debugInfo(){return{type:"RenderIntrinsicHeight"}}}class w extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class R extends h{constructor({key:e=null,child:t=null}={}){super({key:e,child:t}),this._renderObject=null}createRenderObject(e){return new d}updateRenderObject(e,t){}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const i=this.child.createElement();i.mount(e.element),t=i.performRebuild()}const n=e.element.getElementId(),r=e.element.getWidgetPath(),l={position:"relative",display:"inline-block"};return new c({tag:"div",props:{style:l,"data-element-id":n,"data-widget-path":r,"data-widget":"IgnoreBaseline","data-ignore-baseline":"true"},children:t?[t]:[],key:this.key})}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"ignoresBaseline",value:!0})}createElement(){return new E(this)}}class d{constructor(){}debugInfo(){return{type:"RenderIgnoreBaseline",ignoresBaseline:!0}}}class E extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}}export{o as AspectRatio,R as IgnoreBaseline,_ as IntrinsicHeight,p as IntrinsicWidth,a as RenderAspectRatio,d as RenderIgnoreBaseline,b as RenderIntrinsicHeight,g as RenderIntrinsicWidth};
//# sourceMappingURL=aspect_ratio.js.map
