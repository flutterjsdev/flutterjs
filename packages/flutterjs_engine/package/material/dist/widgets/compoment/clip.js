import{ProxyWidget as h}from"../../core/widget_element.js";import{VNode as d}from"@flutterjs/vdom/vnode";import{Clip as n}from"../../utils.js";class p{constructor(){if(new.target===p)throw new Error("CustomClipper is abstract")}getClip(e){throw new Error("getClip() must be implemented")}shouldReclip(e){return!0}}class w extends h{constructor({key:e=null,clipper:t=null,clipBehavior:i=n.hardEdge,child:r=null}={}){if(super({key:e,child:r}),t&&!(t instanceof p))throw new Error(`ClipRect requires a CustomClipper instance, got: ${typeof t}`);if(!Object.values(n).includes(i))throw new Error(`Invalid clipBehavior: ${i}`);this.clipper=t,this.clipBehavior=i,this._renderObject=null,this._containerElement=null}createRenderObject(e){return new m({clipper:this.clipper,clipBehavior:this.clipBehavior})}updateRenderObject(e,t){t.clipper=this.clipper,t.clipBehavior=this.clipBehavior}unmountRenderObject(e){e.clipper=null}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const c=this.child.createElement();c.mount(e.element),t=c.performRebuild()}const i=e.element.getElementId(),r=e.element.getWidgetPath(),s=this.clipBehavior===n.none?"visible":"hidden",l=this._getClipFilter(),a={overflow:s,position:"relative",filter:l};return new d({tag:"div",props:{style:a,"data-element-id":i,"data-widget-path":r,"data-widget":"ClipRect","data-clip-behavior":this.clipBehavior,ref:c=>this._onContainerMount(c,e)},children:t?[t]:[],key:this.key})}_getClipFilter(){switch(this.clipBehavior){case n.antiAlias:case n.antiAliasWithSaveLayer:return"anti-alias";case n.hardEdge:case n.none:default:return"none"}}_onContainerMount(e,t){if(!e||!this.clipper)return;this._containerElement=e;try{const r=e.getBoundingClientRect(),s={width:Math.ceil(r.width)||100,height:Math.ceil(r.height)||100},l=this.clipper.getClip(s);l&&(e.style.clipPath=l,e.style.WebkitClipPath=l)}catch(r){console.error("Error applying custom clipper:",r)}const i=()=>{if(!(!this.clipper||!this._containerElement))try{const r=this._containerElement.getBoundingClientRect(),s={width:Math.ceil(r.width)||100,height:Math.ceil(r.height)||100},l=this.clipper.getClip(s);l&&(this._containerElement.style.clipPath=l,this._containerElement.style.WebkitClipPath=l)}catch(r){console.error("Error applying custom clipper on resize:",r)}};window.addEventListener("resize",i),e._cleanupResize=()=>{window.removeEventListener("resize",i)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"hasClipper",value:!!this.clipper}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new f(this)}}class m{constructor({clipper:e=null,clipBehavior:t=n.hardEdge}={}){this.clipper=e,this.clipBehavior=t}debugInfo(){return{type:"RenderClipRect",hasClipper:!!this.clipper,clipBehavior:this.clipBehavior}}}class f extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class C extends h{constructor({key:e=null,borderRadius:t=null,clipper:i=null,clipBehavior:r=n.antiAlias,child:s=null}={}){if(super({key:e,child:s}),i&&!(i instanceof p))throw new Error(`ClipRRect requires a CustomClipper instance, got: ${typeof i}`);if(!Object.values(n).includes(r))throw new Error(`Invalid clipBehavior: ${r}`);this.borderRadius=t||{all:0},this.clipper=i,this.clipBehavior=r,this._renderObject=null,this._containerElement=null}createRenderObject(e){return new g({borderRadius:this.borderRadius,clipper:this.clipper,clipBehavior:this.clipBehavior})}updateRenderObject(e,t){t.borderRadius=this.borderRadius,t.clipBehavior=this.clipBehavior,t.clipper=this.clipper}unmountRenderObject(e){e.clipper=null}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const u=this.child.createElement();u.mount(e.element),t=u.performRebuild()}const i=e.element.getElementId(),r=e.element.getWidgetPath(),s=this._getBorderRadiusCSS(),l=this.clipBehavior===n.none?"visible":"hidden",a=this._getClipFilter(),c={borderRadius:s,overflow:l,position:"relative",filter:a};return new d({tag:"div",props:{style:c,"data-element-id":i,"data-widget-path":r,"data-widget":"ClipRRect","data-border-radius":JSON.stringify(this.borderRadius),"data-clip-behavior":this.clipBehavior,ref:u=>this._onContainerMount(u,e)},children:t?[t]:[],key:this.key})}_getBorderRadiusCSS(){if(typeof this.borderRadius=="number")return`${this.borderRadius}px`;if(this.borderRadius.all!==void 0)return`${this.borderRadius.all}px`;const{topLeft:e=0,topRight:t=0,bottomLeft:i=0,bottomRight:r=0}=this.borderRadius;return`${e}px ${t}px ${r}px ${i}px`}_getClipFilter(){switch(this.clipBehavior){case n.antiAlias:case n.antiAliasWithSaveLayer:return"anti-alias";case n.hardEdge:case n.none:default:return"none"}}_onContainerMount(e,t){if(!e)return;if(this._containerElement=e,this.clipper)try{const r=e.getBoundingClientRect(),s={width:Math.ceil(r.width)||100,height:Math.ceil(r.height)||100},l=this.clipper.getClip(s);l&&(e.style.clipPath=l,e.style.WebkitClipPath=l)}catch(r){console.error("Error applying custom clipper:",r)}const i=()=>{if(this._containerElement&&this.clipper)try{const r=this._containerElement.getBoundingClientRect(),s={width:Math.ceil(r.width)||100,height:Math.ceil(r.height)||100},l=this.clipper.getClip(s);l&&(this._containerElement.style.clipPath=l,this._containerElement.style.WebkitClipPath=l)}catch(r){console.error("Error applying custom clipper on resize:",r)}};window.addEventListener("resize",i),e._cleanupResize=()=>{window.removeEventListener("resize",i)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"borderRadius",value:JSON.stringify(this.borderRadius)}),e.push({name:"hasClipper",value:!!this.clipper}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new _(this)}}class g{constructor({borderRadius:e=null,clipper:t=null,clipBehavior:i=n.antiAlias}={}){this.borderRadius=e||{all:0},this.clipper=t,this.clipBehavior=i}debugInfo(){return{type:"RenderClipRRect",borderRadius:JSON.stringify(this.borderRadius),hasClipper:!!this.clipper,clipBehavior:this.clipBehavior}}}class _ extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class E extends h{constructor({key:e=null,borderRadius:t=null,clipper:i=null,clipBehavior:r=n.antiAlias,child:s=null}={}){if(super({key:e,child:s}),i&&!(i instanceof p))throw new Error(`ClipRSuperellipse requires a CustomClipper instance, got: ${typeof i}`);if(!Object.values(n).includes(r))throw new Error(`Invalid clipBehavior: ${r}`);this.borderRadius=t||{all:0},this.clipper=i,this.clipBehavior=r,this._renderObject=null,this._containerElement=null}createRenderObject(e){return new b({borderRadius:this.borderRadius,clipper:this.clipper,clipBehavior:this.clipBehavior})}updateRenderObject(e,t){t.borderRadius=this.borderRadius,t.clipBehavior=this.clipBehavior,t.clipper=this.clipper}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const c=this.child.createElement();c.mount(e.element),t=c.performRebuild()}const i=e.element.getElementId(),r=e.element.getWidgetPath(),s=this._getBorderRadiusCSS(),l=this.clipBehavior===n.none?"visible":"hidden",a={borderRadius:s,overflow:l,position:"relative"};return new d({tag:"div",props:{style:a,"data-element-id":i,"data-widget-path":r,"data-widget":"ClipRSuperellipse","data-border-radius":JSON.stringify(this.borderRadius),"data-clip-behavior":this.clipBehavior,ref:c=>this._onContainerMount(c)},children:t?[t]:[],key:this.key})}_getBorderRadiusCSS(){if(typeof this.borderRadius=="number")return`${this.borderRadius}px`;if(this.borderRadius.all!==void 0)return`${this.borderRadius.all}px`;const{topLeft:e=0,topRight:t=0,bottomLeft:i=0,bottomRight:r=0}=this.borderRadius;return`${e}px ${t}px ${r}px ${i}px`}_onContainerMount(e){if(!e)return;this._containerElement=e,this.clipper&&this._applyClipper();const t=()=>this._applyClipper();window.addEventListener("resize",t),e._cleanupResize=()=>window.removeEventListener("resize",t)}_applyClipper(){if(!(!this.clipper||!this._containerElement))try{const e=this._containerElement.getBoundingClientRect(),t={width:Math.ceil(e.width)||100,height:Math.ceil(e.height)||100},i=this.clipper.getClip(t);i&&(this._containerElement.style.clipPath=i,this._containerElement.style.WebkitClipPath=i)}catch(e){console.error("Error applying superellipse clipper:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"borderRadius",value:JSON.stringify(this.borderRadius)}),e.push({name:"hasClipper",value:!!this.clipper}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new y(this)}}class b{constructor({borderRadius:e=null,clipper:t=null,clipBehavior:i=n.antiAlias}={}){this.borderRadius=e||{all:0},this.clipper=t,this.clipBehavior=i}debugInfo(){return{type:"RenderClipRSuperellipse",borderRadius:JSON.stringify(this.borderRadius),hasClipper:!!this.clipper,clipBehavior:this.clipBehavior}}}class y extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class B extends h{constructor({key:e=null,clipper:t=null,clipBehavior:i=n.antiAlias,child:r=null}={}){if(super({key:e,child:r}),t&&!(t instanceof p))throw new Error(`ClipOval requires a CustomClipper instance, got: ${typeof t}`);if(!Object.values(n).includes(i))throw new Error(`Invalid clipBehavior: ${i}`);this.clipper=t,this.clipBehavior=i,this._renderObject=null,this._containerElement=null}createRenderObject(e){return new R({clipper:this.clipper,clipBehavior:this.clipBehavior})}updateRenderObject(e,t){t.clipper=this.clipper,t.clipBehavior=this.clipBehavior}unmountRenderObject(e){e.clipper=null}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const a=this.child.createElement();a.mount(e.element),t=a.performRebuild()}const i=e.element.getElementId(),r=e.element.getWidgetPath(),l={borderRadius:"50%",overflow:this.clipBehavior===n.none?"visible":"hidden",position:"relative"};return new d({tag:"div",props:{style:l,"data-element-id":i,"data-widget-path":r,"data-widget":"ClipOval","data-clip-behavior":this.clipBehavior,ref:a=>this._onContainerMount(a)},children:t?[t]:[],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,this.clipper&&this._applyClipper();const t=()=>this._applyClipper();window.addEventListener("resize",t),e._cleanupResize=()=>window.removeEventListener("resize",t)}_applyClipper(){if(!(!this.clipper||!this._containerElement))try{const e=this._containerElement.getBoundingClientRect(),t={width:Math.ceil(e.width)||100,height:Math.ceil(e.height)||100},i=this.clipper.getClip(t);i&&(this._containerElement.style.clipPath=i,this._containerElement.style.WebkitClipPath=i)}catch(e){console.error("Error applying oval clipper:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"hasClipper",value:!!this.clipper}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new O(this)}}class R{constructor({clipper:e=null,clipBehavior:t=n.antiAlias}={}){this.clipper=e,this.clipBehavior=t}debugInfo(){return{type:"RenderClipOval",hasClipper:!!this.clipper,clipBehavior:this.clipBehavior}}}class O extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}class P extends h{constructor({key:e=null,clipper:t=null,clipBehavior:i=n.antiAlias,child:r=null}={}){if(super({key:e,child:r}),t&&!(t instanceof p))throw new Error(`ClipPath requires a CustomClipper instance, got: ${typeof t}`);if(!Object.values(n).includes(i))throw new Error(`Invalid clipBehavior: ${i}`);this.clipper=t,this.clipBehavior=i,this._renderObject=null,this._containerElement=null}createRenderObject(e){return new v({clipper:this.clipper,clipBehavior:this.clipBehavior})}updateRenderObject(e,t){t.clipper=this.clipper,t.clipBehavior=this.clipBehavior}unmountRenderObject(e){e.clipper=null}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const a=this.child.createElement();a.mount(e.element),t=a.performRebuild()}const i=e.element.getElementId(),r=e.element.getWidgetPath(),l={overflow:this.clipBehavior===n.none?"visible":"hidden",position:"relative"};return new d({tag:"div",props:{style:l,"data-element-id":i,"data-widget-path":r,"data-widget":"ClipPath","data-clip-behavior":this.clipBehavior,ref:a=>this._onContainerMount(a)},children:t?[t]:[],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,this.clipper&&this._applyClipper();const t=()=>this._applyClipper();window.addEventListener("resize",t),e._cleanupResize=()=>window.removeEventListener("resize",t)}_applyClipper(){if(!(!this.clipper||!this._containerElement))try{const e=this._containerElement.getBoundingClientRect(),t={width:Math.ceil(e.width)||100,height:Math.ceil(e.height)||100},i=this.clipper.getClip(t);i&&(this._containerElement.style.clipPath=i,this._containerElement.style.WebkitClipPath=i)}catch(e){console.error("Error applying path clipper:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"hasClipper",value:!!this.clipper}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new j(this)}}class v{constructor({clipper:e=null,clipBehavior:t=n.antiAlias}={}){this.clipper=e,this.clipBehavior=t}debugInfo(){return{type:"RenderClipPath",hasClipper:!!this.clipper,clipBehavior:this.clipBehavior}}}class j extends h.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}export{B as ClipOval,P as ClipPath,C as ClipRRect,E as ClipRSuperellipse,w as ClipRect,p as CustomClipper,R as RenderClipOval,v as RenderClipPath,g as RenderClipRRect,b as RenderClipRSuperellipse,m as RenderClipRect};
//# sourceMappingURL=clip.js.map
