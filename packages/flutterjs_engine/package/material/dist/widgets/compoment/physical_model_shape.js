import{ProxyWidget as c}from"../../core/widget_element.js";import{VNode as w}from"@flutterjs/vdom/vnode";import{CustomClipper as g}from"./clip.js";import{Clip as a,BoxShape as d,Color as u}from"../../utils.js";class f extends c{constructor({key:e=null,shape:t=d.rectangle,clipBehavior:i=a.none,borderRadius:o=null,elevation:r=0,color:l=null,shadowColor:n=null,child:s=null}={}){if(super({key:e,child:s}),r<0)throw new Error(`elevation must be >= 0.0, got: ${r}`);if(!Object.values(d).includes(t))throw new Error(`Invalid BoxShape: ${t}`);if(!Object.values(a).includes(i))throw new Error(`Invalid clipBehavior: ${i}`);this.shape=t,this.clipBehavior=i,this.borderRadius=o||{all:0},this.elevation=r,this.color=l||new u("#FFFFFF"),this.shadowColor=n||new u("#FF000000"),this._renderObject=null}createRenderObject(e){return new m({shape:this.shape,clipBehavior:this.clipBehavior,borderRadius:this.borderRadius,elevation:this.elevation,color:this.color,shadowColor:this.shadowColor})}updateRenderObject(e,t){t.shape=this.shape,t.clipBehavior=this.clipBehavior,t.borderRadius=this.borderRadius,t.elevation=this.elevation,t.color=this.color,t.shadowColor=this.shadowColor}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const v=this.child.createElement();v.mount(e.element),t=v.performRebuild()}const i=e.element.getElementId(),o=e.element.getWidgetPath(),r=this._generateBoxShadow(),l=this._getBorderRadiusCSS(),n=this.shape===d.circle?"50%":l,s=this.clipBehavior===a.none?"visible":"hidden",p={backgroundColor:this.color.toCSSString(),boxShadow:r,borderRadius:n,overflow:s,position:"relative"};return new w({tag:"div",props:{style:p,"data-element-id":i,"data-widget-path":o,"data-widget":"PhysicalModel","data-shape":this.shape,"data-elevation":this.elevation,"data-clip-behavior":this.clipBehavior},children:t?[t]:[],key:this.key})}_generateBoxShadow(){if(this.elevation===0)return"none";const e=[],t=.2,i=.14,o=.12,r=Math.round(this.elevation),l=Math.round(this.elevation*.5);e.push(`0 ${l}px ${r}px rgba(0, 0, 0, ${o})`);const n=Math.round(this.elevation*1.5),s=Math.round(this.elevation*.75);e.push(`0 ${s}px ${n}px rgba(0, 0, 0, ${i})`);const p=Math.round(this.elevation*2);return e.push(`0 0 ${p}px rgba(0, 0, 0, ${t})`),e.join(", ")}_getBorderRadiusCSS(){if(typeof this.borderRadius=="number")return`${this.borderRadius}px`;if(this.borderRadius.all!==void 0)return`${this.borderRadius.all}px`;const{topLeft:e=0,topRight:t=0,bottomLeft:i=0,bottomRight:o=0}=this.borderRadius;return`${e}px ${t}px ${o}px ${i}px`}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"shape",value:this.shape}),e.push({name:"elevation",value:this.elevation}),e.push({name:"color",value:this.color.toString()}),e.push({name:"shadowColor",value:this.shadowColor.toString()}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new C(this)}}class m{constructor({shape:e=d.rectangle,clipBehavior:t=a.none,borderRadius:i=null,elevation:o=0,color:r=null,shadowColor:l=null}={}){this.shape=e,this.clipBehavior=t,this.borderRadius=i||{all:0},this.elevation=o,this.color=r,this.shadowColor=l}debugInfo(){return{type:"RenderPhysicalModel",shape:this.shape,elevation:this.elevation,clipBehavior:this.clipBehavior,color:this.color?.toString(),shadowColor:this.shadowColor?.toString()}}}class C extends c.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}}class R extends c{constructor({key:e=null,clipper:t=null,clipBehavior:i=a.none,elevation:o=0,color:r=null,shadowColor:l=null,child:n=null}={}){if(super({key:e,child:n}),!t)throw new Error("PhysicalShape requires a clipper");if(!(t instanceof g))throw new Error(`PhysicalShape requires a CustomClipper instance, got: ${typeof t}`);if(o<0)throw new Error(`elevation must be >= 0.0, got: ${o}`);if(!Object.values(a).includes(i))throw new Error(`Invalid clipBehavior: ${i}`);this.clipper=t,this.clipBehavior=i,this.elevation=o,this.color=r||new u("#FFFFFF"),this.shadowColor=l||new u("#FF000000"),this._renderObject=null,this._containerElement=null}createRenderObject(e){return new b({clipper:this.clipper,clipBehavior:this.clipBehavior,elevation:this.elevation,color:this.color,shadowColor:this.shadowColor})}updateRenderObject(e,t){t.clipper=this.clipper,t.clipBehavior=this.clipBehavior,t.elevation=this.elevation,t.color=this.color,t.shadowColor=this.shadowColor}unmountRenderObject(e){e.clipper=null}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const s=this.child.createElement();s.mount(e.element),t=s.performRebuild()}const i=e.element.getElementId(),o=e.element.getWidgetPath(),r=this._generateBoxShadow(),l=this.clipBehavior===a.none?"visible":"hidden",n={backgroundColor:this.color.toCSSString(),boxShadow:r,overflow:l,position:"relative"};return new w({tag:"div",props:{style:n,"data-element-id":i,"data-widget-path":o,"data-widget":"PhysicalShape","data-elevation":this.elevation,"data-clip-behavior":this.clipBehavior,ref:s=>this._onContainerMount(s)},children:t?[t]:[],key:this.key})}_onContainerMount(e){if(!e||!this.clipper)return;this._containerElement=e,this._applyClipper();const t=()=>this._applyClipper();window.addEventListener("resize",t),e._cleanupResize=()=>window.removeEventListener("resize",t)}_applyClipper(){if(!(!this.clipper||!this._containerElement))try{const e=this._containerElement.getBoundingClientRect(),t={width:Math.ceil(e.width)||100,height:Math.ceil(e.height)||100},i=this.clipper.getClip(t);i&&(this._containerElement.style.clipPath=i,this._containerElement.style.WebkitClipPath=i)}catch(e){console.error("Error applying physical shape clipper:",e)}}_generateBoxShadow(){if(this.elevation===0)return"none";const e=[],t=Math.round(this.elevation),i=Math.round(this.elevation*.5);e.push(`0 ${i}px ${t}px rgba(0, 0, 0, 0.12)`);const o=Math.round(this.elevation*1.5),r=Math.round(this.elevation*.75);e.push(`0 ${r}px ${o}px rgba(0, 0, 0, 0.14)`);const l=Math.round(this.elevation*2);return e.push(`0 0 ${l}px rgba(0, 0, 0, 0.2)`),e.join(", ")}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"hasClipper",value:!!this.clipper}),e.push({name:"elevation",value:this.elevation}),e.push({name:"color",value:this.color.toString()}),e.push({name:"shadowColor",value:this.shadowColor.toString()}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new B(this)}}class b{constructor({clipper:e=null,clipBehavior:t=a.none,elevation:i=0,color:o=null,shadowColor:r=null}={}){this.clipper=e,this.clipBehavior=t,this.elevation=i,this.color=o,this.shadowColor=r}debugInfo(){return{type:"RenderPhysicalShape",hasClipper:!!this.clipper,elevation:this.elevation,clipBehavior:this.clipBehavior,color:this.color?.toString(),shadowColor:this.shadowColor?.toString()}}}class B extends c.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}export{f as PhysicalModel,R as PhysicalShape,m as RenderPhysicalModel,b as RenderPhysicalShape};
//# sourceMappingURL=physical_model_shape.js.map
