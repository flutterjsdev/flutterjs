import{Widget as f,Element as p}from"../../core/widget_element.js";import{VNode as c}from"@flutterjs/vdom/vnode";const s={horizontal:"horizontal",vertical:"vertical"},i={up:"up",right:"right",down:"down",left:"left"};function a(o,e,t){const r=o?.isRTL||!1;return e===s.horizontal?t?r?i.right:i.left:r?i.left:i.right:t?i.up:i.down}class u{constructor({axisDirection:e=i.down}={}){this.axisDirection=e,this._children=[],this._containerElement=null,this._resizeObserver=null}addChild(e){this._children.push(e)}removeChild(e){const t=this._children.indexOf(e);t>-1&&this._children.splice(t,1)}get mainAxis(){return[i.left,i.right].includes(this.axisDirection)?s.horizontal:s.vertical}get isReverse(){return[i.up,i.left].includes(this.axisDirection)}debugInfo(){return{type:"RenderListBody",axisDirection:this.axisDirection,mainAxis:this.mainAxis,isReverse:this.isReverse,childCount:this._children.length}}}class m extends p{constructor(e){super(e),this._renderObject=null}mount(e=null){super.mount(e),this._renderObject=this.widget.createRenderObject(this.context)}updateWidget(e){const t=this.widget;super.updateWidget(e),(t.mainAxis!==e.mainAxis||t.reverse!==e.reverse)&&(this.widget.updateRenderObject(this.context,this._renderObject),this.markNeedsBuild())}performRebuild(){return this.widget.build(this.context)}visitChildren(e){if(this._children)for(const t of this._children)e(t)}}class b extends f{constructor({key:e=null,mainAxis:t=s.vertical,reverse:r=!1,children:n=[]}={}){if(super(e),!Object.values(s).includes(t))throw new Error(`Invalid mainAxis: ${t}`);this.mainAxis=t,this.reverse=r,this.children=n||[],this._renderObject=null,this._containerElement=null,this._childElements=[],this._resizeObserver=null}_getDirection(e){return a(e,this.mainAxis,this.reverse)}createRenderObject(e){return new u({axisDirection:this._getDirection(e)})}updateRenderObject(e,t){t.axisDirection=this._getDirection(e)}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);const t=e.element.getElementId(),r=e.element.getWidgetPath(),n=this.mainAxis===s.horizontal,h=this.reverse,v={display:"flex",flexDirection:n?h?"row-reverse":"row":h?"column-reverse":"column",width:n?"auto":"100%",height:"auto",alignItems:"stretch",justifyContent:"flex-start"},_=this.children.map(l=>{const d=l.createElement();d.mount(e.element);const g=d.performRebuild();return new c({tag:"div",props:{style:{flexShrink:0,width:n?"auto":"100%"}},children:[g]})});return new c({tag:"div",props:{style:v,"data-element-id":t,"data-widget-path":r,"data-widget":"ListBody","data-main-axis":this.mainAxis,"data-reverse":this.reverse,"data-axis-direction":this._getDirection(e),ref:l=>this._onContainerMount(l,e)},children:_,key:this.key})}_onContainerMount(e,t){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._onResize()}),this._resizeObserver.observe(e));const r=()=>this._onResize();window.addEventListener("resize",r),e._cleanupResize=()=>{window.removeEventListener("resize",r),this._resizeObserver&&this._resizeObserver.disconnect()}}_onResize(){if(this._containerElement)try{const e=this._containerElement.getBoundingClientRect()}catch(e){console.error("Error during ListBody resize:",e)}}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"mainAxis",value:this.mainAxis}),e.push({name:"reverse",value:this.reverse}),e.push({name:"childCount",value:this.children.length})}createElement(){return new m(this)}}export{s as Axis,i as AxisDirection,b as ListBody,m as ListBodyElement,u as RenderListBody,a as getAxisDirectionFromAxisReverseAndDirectionality};
//# sourceMappingURL=list_body.js.map
