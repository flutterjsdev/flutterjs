import{ProxyWidget as m}from"../../core/widget_element.js";import{VNode as f}from"@flutterjs/vdom/vnode";import{Alignment as g,Clip as c,BoxFit as r}from"../../utils.js";class v extends m{constructor({key:e=null,fit:t=r.contain,alignment:s=g.center,clipBehavior:a=c.none,child:h=null}={}){if(super({key:e,child:h}),!Object.values(r).includes(t))throw new Error(`Invalid BoxFit: ${t}`);if(!Object.values(c).includes(a))throw new Error(`Invalid clipBehavior: ${a}`);if(!(s instanceof g))throw new Error(`FittedBox requires an Alignment instance, got: ${typeof s}`);this.fit=t,this.alignment=s,this.clipBehavior=a,this._renderObject=null,this._containerElement=null,this._childElement=null,this._resizeObserver=null}createRenderObject(e){return new p({fit:this.fit,alignment:this.alignment,clipBehavior:this.clipBehavior})}updateRenderObject(e,t){t.fit=this.fit,t.alignment=this.alignment,t.clipBehavior=this.clipBehavior}build(e){this._renderObject?this.updateRenderObject(e,this._renderObject):this._renderObject=this.createRenderObject(e);let t=null;if(this.child){const i=this.child.createElement();i.mount(e.element),t=i.performRebuild()}const s=e.element.getElementId(),a=e.element.getWidgetPath(),d={position:"relative",overflow:this.clipBehavior===c.none?"visible":"hidden",display:"flex",alignItems:this._getAlignmentValue("vertical"),justifyContent:this._getAlignmentValue("horizontal"),width:"100%",height:"100%"};return new f({tag:"div",props:{style:d,"data-element-id":s,"data-widget-path":a,"data-widget":"FittedBox","data-fit":this.fit,"data-alignment":this.alignment.toString(),"data-clip-behavior":this.clipBehavior,ref:i=>this._onContainerMount(i)},children:[new f({tag:"div",props:{style:{position:"relative",width:"auto",height:"auto",maxWidth:"100%",maxHeight:"100%"},ref:i=>this._onChildMount(i)},children:t?[t]:[]})],key:this.key})}_onContainerMount(e){if(!e)return;this._containerElement=e,window.ResizeObserver&&(this._resizeObserver=new ResizeObserver(()=>{this._applyFitting()}),this._resizeObserver.observe(e));const t=()=>this._applyFitting();window.addEventListener("resize",t),e._cleanupResize=()=>{window.removeEventListener("resize",t),this._resizeObserver&&this._resizeObserver.disconnect()},this._applyFitting()}_onChildMount(e){e&&(this._childElement=e,this._applyFitting())}_applyFitting(){if(!(!this._containerElement||!this._childElement))try{const e=this._containerElement.getBoundingClientRect(),t=e.width||300,s=e.height||300,a=this._childElement.getBoundingClientRect();let h=a.width||100,d=a.height||100;const i=t/h,o=s/d;let n=1,l="none";switch(this.fit){case r.fill:l=`scaleX(${i}) scaleY(${o})`;break;case r.cover:n=Math.max(i,o),l=`scale(${n})`;break;case r.contain:n=Math.min(i,o),l=`scale(${n})`;break;case r.fitWidth:n=i,l=`scale(${n})`;break;case r.fitHeight:n=o,l=`scale(${n})`;break;case r.none:l="none";break;case r.scaleDown:n=Math.min(i,o,1),l=n<1?`scale(${n})`:"none";break;default:l="none"}this._childElement.style.transform=l,this._childElement.style.transformOrigin=this._getTransformOrigin()}catch(e){console.error("Error applying fitted box scaling:",e)}}_getAlignmentValue(e){return e==="horizontal"?this.alignment.x<0?"flex-start":this.alignment.x>0?"flex-end":"center":e==="vertical"?this.alignment.y<0?"flex-start":this.alignment.y>0?"flex-end":"center":"center"}_getTransformOrigin(){const e=(this.alignment.x+1)/2*100,t=(this.alignment.y+1)/2*100;return`${e}% ${t}%`}debugFillProperties(e){super.debugFillProperties(e),e.push({name:"fit",value:this.fit}),e.push({name:"alignment",value:this.alignment.toString()}),e.push({name:"clipBehavior",value:this.clipBehavior})}createElement(){return new _(this)}}class p{constructor({fit:e=r.contain,alignment:t=g.center,clipBehavior:s=c.none}={}){this.fit=e,this.alignment=t,this.clipBehavior=s}debugInfo(){return{type:"RenderFittedBox",fit:this.fit,alignment:this.alignment.toString(),clipBehavior:this.clipBehavior}}}class _ extends m.constructor.prototype.constructor{performRebuild(){return this.widget.build(this.context)}detach(){this.widget._containerElement&&this.widget._containerElement._cleanupResize&&this.widget._containerElement._cleanupResize(),super.detach()}}export{r as BoxFit,v as FittedBox,p as RenderFittedBox};
//# sourceMappingURL=fitted_box.js.map
