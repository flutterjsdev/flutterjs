import{StatefulWidget as h,State as a}from"../core/widget_element.js";import"@flutterjs/vdom/vnode";class o{constructor({settings:e={},builder:t=null}={}){this.settings=e,this.builder=t}}class d extends h{constructor({key:e=null,initialRoute:t="/",onGenerateRoute:i=null,onUnknownRoute:r=null,routes:u={}}={}){super(e),this.initialRoute=t,this.onGenerateRoute=i,this.onUnknownRoute=r,this.routes=u}createState(){return new n}static of(e){if(e&&typeof e.findAncestorStateOfType=="function"){const i=e.findAncestorStateOfType(n);if(i)return i}let t=e;for(;t;){if(t instanceof n)return t;if(t.state instanceof n)return t.state;t=t.parent}return null}}class n extends a{constructor(){super(),this._history=[]}initState(){if(super.initState(),typeof window<"u"){window.addEventListener("popstate",this._handlePopState.bind(this));const t=window.location.pathname;t&&t!=="/"&&this.widget.initialRoute}const e=this._routeNamed(this.widget.initialRoute,null);e&&this._history.push(e)}dispose(){typeof window<"u"&&window.removeEventListener("popstate",this._handlePopState.bind(this)),super.dispose()}_handlePopState(e){this._history.length>1&&(this._history.pop(),this.setState(()=>{}))}push(e){if(this._history.push(e),typeof window<"u"&&e.settings&&e.settings.name){const t=e.settings.name;window.location.pathname!==t&&window.history.pushState({name:t},"",t)}return this.setState(()=>{}),Promise.resolve()}pushNamed(e,{arguments:t=null}={}){const i=this._routeNamed(e,t);i?this.push(i):console.warn(`Navigator: No route defined for "${e}"`)}pop(e){return this.canPop()?typeof window<"u"?(window.history.back(),!0):(this._history.pop(),this.setState(()=>{}),!0):!1}canPop(){return this._history.length>1}_routeNamed(e,t){const i={name:e,arguments:t};return this.widget.routes&&this.widget.routes[e]?new o({settings:i,builder:this.widget.routes[e]}):this.widget.onGenerateRoute?this.widget.onGenerateRoute(i):this.widget.onUnknownRoute?this.widget.onUnknownRoute(i):null}build(e){if(this._history.length===0)return null;const t=this._history[this._history.length-1];if(t.builder){console.log(`[Navigator] Building route ${this._history.length}:`,t.settings);const i=t.builder(e);return i&&t.settings&&t.settings.name&&(i.key||(i.key=`route_${t.settings.name}_${this._history.length}`)),i}return null}}export{d as Navigator,n as NavigatorState,o as Route};
//# sourceMappingURL=navigator.js.map
