import{StatelessWidget as b}from"../core/widget_element.js";import{Element as x}from"@flutterjs/runtime";import{VNode as C}from"@flutterjs/vdom/vnode";import{TapRecognizer as s,LongPressRecognizer as G,SwipeRecognizer as y,PanRecognizer as I,ScaleRecognizer as q}from"@flutterjs/runtime";class $ extends b{constructor({key:e=null,child:t=null,onTap:n=null,onTapDown:i=null,onTapUp:o=null,onTapCancel:l=null,onDoubleTap:r=null,onLongPress:u=null,onLongPressStart:c=null,onLongPressMoveUpdate:p=null,onLongPressEnd:d=null,onLongPressUp:g=null,onSwipe:S=null,onSwipeLeft:f=null,onSwipeRight:m=null,onSwipeUp:w=null,onSwipeDown:T=null,onPan:D=null,onPanStart:E=null,onPanUpdate:_=null,onPanEnd:P=null,onScale:z=null,onScaleStart:v=null,onScaleUpdate:U=null,onScaleEnd:M=null,behavior:R="opaque",excludeFromSemantics:L=!1}={}){super(e),this.child=t,this.onTap=n,this.onTapDown=i,this.onTapUp=o,this.onTapCancel=l,this.onDoubleTap=r,this.onLongPress=u,this.onLongPressStart=c,this.onLongPressMoveUpdate=p,this.onLongPressEnd=d,this.onLongPressUp=g,this.onSwipe=S,this.onSwipeLeft=f,this.onSwipeRight=m,this.onSwipeUp=w,this.onSwipeDown=T,this.onPan=D,this.onPanStart=E,this.onPanUpdate=_,this.onPanEnd=P,this.onScale=z,this.onScaleStart=v,this.onScaleUpdate=U,this.onScaleEnd=M,this.behavior=R,this.excludeFromSemantics=L,this.recognizers=[],this._elementId=null}build(e){this._elementId=e.element.getElementId();let t=null;if(this.child){const o=this.child.createElement?.(e.element,e.element.runtime)||this.child;o.mount&&o.mount(e.element),t=o.performRebuild?.()||null}const n={position:"relative",userSelect:this.behavior==="opaque"?"none":"auto",WebkitUserSelect:this.behavior==="opaque"?"none":"auto",MozUserSelect:this.behavior==="opaque"?"none":"auto",msUserSelect:this.behavior==="opaque"?"none":"auto",touchAction:"manipulation",cursor:"pointer"},i=this._elementId;return new C({tag:"div",props:{style:n,"data-widget":"GestureDetector","data-element-id":i,onMouseDown:o=>this._handleMouseDown(o,i),onMouseUp:o=>this._handleMouseUp(o,i),onMouseMove:o=>this._handleMouseMove(o,i),onMouseLeave:o=>this._handleMouseLeave(o,i),onTouchStart:o=>this._handleTouchStart(o,i),onTouchEnd:o=>this._handleTouchEnd(o,i),onTouchMove:o=>this._handleTouchMove(o,i),onTouchCancel:o=>this._handleTouchCancel(o,i),onContextMenu:o=>this._handleContextMenu(o,i)},children:t?[t]:[]})}_initializeRecognizers(e){if(console.log(`[GestureDetector] _initializeRecognizers for ${e}. Current count: ${this.recognizers.length}`),!(this.recognizers.length>0)){if(this.onTap||this.onTapDown||this.onTapUp){console.log("[GestureDetector] Creating TapRecognizer",{hasOnTap:!!this.onTap,hasOnTapDown:!!this.onTapDown,hasOnTapUp:!!this.onTapUp});const t=new s(n=>{console.log("[GestureDetector] Tap Recognized!",n),this.onTap&&this.onTap(n),this.onTapUp&&this.onTapUp(n)},{maxDuration:300,maxMovement:10});console.log("[GestureDetector] Added TapRecognizer"),this.recognizers.push(t)}if(this.onDoubleTap){const t=new s(n=>{n.tapCount===2&&this.onDoubleTap(n)},{minTaps:2,maxTaps:2});this.recognizers.push(t)}if(this.onLongPress||this.onLongPressStart||this.onLongPressEnd){const t=new G(n=>{this.onLongPress&&this.onLongPress(n)},{duration:500,maxMovement:10});this.recognizers.push(t)}if(this.onSwipe||this.onSwipeLeft||this.onSwipeRight||this.onSwipeUp||this.onSwipeDown){const t=new y(n=>{this.onSwipe&&this.onSwipe(n),n.direction==="left"&&this.onSwipeLeft?this.onSwipeLeft(n):n.direction==="right"&&this.onSwipeRight?this.onSwipeRight(n):n.direction==="up"&&this.onSwipeUp?this.onSwipeUp(n):n.direction==="down"&&this.onSwipeDown&&this.onSwipeDown(n)},{minDistance:50,maxDuration:300});this.recognizers.push(t)}if(this.onPan||this.onPanStart||this.onPanUpdate||this.onPanEnd){const t=new I(n=>{this.onPan&&this.onPan(n)},{minDistance:10,onStart:n=>{this.onPanStart&&this.onPanStart(n)},onUpdate:n=>{this.onPanUpdate&&this.onPanUpdate(n)},onEnd:n=>{this.onPanEnd&&this.onPanEnd(n)}});this.recognizers.push(t)}if(this.onScale||this.onScaleStart||this.onScaleUpdate||this.onScaleEnd){const t=new q(n=>{this.onScale&&this.onScale(n)},{minScale:.5,maxScale:2,onStart:n=>{this.onScaleStart&&this.onScaleStart(n)},onUpdate:n=>{this.onScaleUpdate&&this.onScaleUpdate(n)},onEnd:n=>{this.onScaleEnd&&this.onScaleEnd(n)}});this.recognizers.push(t)}}}_routeEvent(e,t,n){console.log(`[GestureDetector] _routeEvent: ${e}`,t),this._initializeRecognizers(n),console.log(`[GestureDetector] recognizers count: ${this.recognizers.length}`),console.log(`[GestureDetector] onTap present: ${!!this.onTap}`),this.recognizers.forEach(i=>{i.isDisposed||i.handleEvent(e,t)})}_handleMouseDown(e,t){console.log("[GestureDetector] _handleMouseDown",e),this._routeEvent("mousedown",e,t),this.onTapDown&&this.onTapDown({type:"tapdown",position:{x:e.clientX,y:e.clientY},nativeEvent:e})}_handleMouseUp(e,t){console.log("[GestureDetector] _handleMouseUp",e),this._routeEvent("mouseup",e,t)}_handleMouseMove(e,t){this._routeEvent("mousemove",e,t)}_handleMouseLeave(e,t){this.onTapCancel&&this.onTapCancel({type:"tapcancel",nativeEvent:e})}_handleTouchStart(e,t){if(console.log("[GestureDetector] _handleTouchStart",e),this._routeEvent("touchstart",e,t),this.onTapDown){const n=e.touches[0];this.onTapDown({type:"tapdown",position:{x:n.clientX,y:n.clientY},nativeEvent:e})}}_handleTouchEnd(e,t){console.log("[GestureDetector] _handleTouchEnd",e),this._routeEvent("touchend",e,t)}_handleTouchMove(e,t){this._routeEvent("touchmove",e,t)}_handleTouchCancel(e,t){this._routeEvent("touchcancel",e,t),this.onTapCancel&&this.onTapCancel({type:"tapcancel",nativeEvent:e})}_handleContextMenu(e,t){this.onLongPress&&(e.preventDefault(),this._routeEvent("contextmenu",e,t))}dispose(){this.recognizers.forEach(e=>{e.dispose()}),this.recognizers=[]}createElement(e,t){return new h(this,e,t)}debugFillProperties(e){super.debugFillProperties(e),this.onTap&&e.push({name:"onTap",value:"fn"}),this.onDoubleTap&&e.push({name:"onDoubleTap",value:"fn"}),this.onLongPress&&e.push({name:"onLongPress",value:"fn"}),this.onSwipe&&e.push({name:"onSwipe",value:"fn"}),this.onPan&&e.push({name:"onPan",value:"fn"})}}class h extends x{performRebuild(){return this.widget.build(this.context)}unmount(){this.widget&&this.widget.dispose(),super.unmount()}}export{$ as GestureDetector,h as GestureDetectorElement};
//# sourceMappingURL=gesture_detector.js.map
