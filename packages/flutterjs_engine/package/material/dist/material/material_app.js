import{StatelessWidget as W,ErrorWidget as w}from"../core/widget_element.js";import{VNode as C}from"@flutterjs/vdom/vnode";import{StatefulElement as P,StatelessElement as E,InheritedWidget as R}from"@flutterjs/runtime";import{ColorScheme as c}from"./color_scheme.js";class u{constructor({brightness:e="light",primaryColor:t="#2196F3",primarySwatch:o=null,colorScheme:r=null,accentColor:i="#FF4081",scaffoldBackgroundColor:a="#FAFAFA",canvasColor:d="#FFF",cardColor:n="#FFF",dividerColor:h="rgba(0, 0, 0, 0.12)",highlightColor:f="rgba(0, 0, 0, 0.05)",splashColor:m="rgba(0, 0, 0, 0.2)",selectedRowColor:p="#F5F5F5",unselectedWidgetColor:y="rgba(0, 0, 0, 0.54)",disabledColor:F="rgba(0, 0, 0, 0.38)",textTheme:g=null,fontFamily:l='Roboto, -apple-system, BlinkMacSystemFont, "Segoe UI"',appBarTheme:k=null}={}){console.log("\u{1F3A8} ThemeData constructor called",{primaryColor:t,primarySwatch:o}),this.brightness=e,this.primaryColor=t,this.primarySwatch=o,this.accentColor=i,this.scaffoldBackgroundColor=a,this.canvasColor=d,this.cardColor=n,this.dividerColor=h,this.highlightColor=f,this.splashColor=m,this.selectedRowColor=p,this.unselectedWidgetColor=y,this.disabledColor=F,this.textTheme=g,this.fontFamily=l,this.appBarTheme=k,r?(this.colorScheme=r,t||(this.primaryColor=r.primary),a||(this.scaffoldBackgroundColor=r.background),n||(this.cardColor=r.surface)):(this.colorScheme=e==="dark"?c.dark():c.light(),t&&t!=="#2196F3"&&(this.colorScheme=c.fromSeed({seedColor:t,brightness:e})));const s=e==="dark"?"#FFFFFF":"#000000";this.textTheme=g||{displayLarge:{fontFamily:l,fontSize:57,fontWeight:"400",color:s},displayMedium:{fontFamily:l,fontSize:45,fontWeight:"400",color:s},displaySmall:{fontFamily:l,fontSize:36,fontWeight:"400",color:s},headlineLarge:{fontFamily:l,fontSize:32,fontWeight:"400",color:s},headlineMedium:{fontFamily:l,fontSize:28,fontWeight:"400",color:s},headlineSmall:{fontFamily:l,fontSize:24,fontWeight:"400",color:s},titleLarge:{fontFamily:l,fontSize:22,fontWeight:"400",color:s},titleMedium:{fontFamily:l,fontSize:16,fontWeight:"500",color:s},titleSmall:{fontFamily:l,fontSize:14,fontWeight:"500",color:s},bodyLarge:{fontFamily:l,fontSize:16,fontWeight:"400",color:s},bodyMedium:{fontFamily:l,fontSize:14,fontWeight:"400",color:s},bodySmall:{fontFamily:l,fontSize:12,fontWeight:"400",color:s},labelLarge:{fontFamily:l,fontSize:14,fontWeight:"500",color:s},labelMedium:{fontFamily:l,fontSize:12,fontWeight:"500",color:s},labelSmall:{fontFamily:l,fontSize:11,fontWeight:"500",color:s}}}static dark(){return new u({brightness:"dark",colorScheme:c.dark(),primaryColor:"#1F1F1F",scaffoldBackgroundColor:"#121212",canvasColor:"#1E1E1E",cardColor:"#2C2C2C",dividerColor:"rgba(255, 255, 255, 0.12)",unselectedWidgetColor:"rgba(255, 255, 255, 0.70)"})}static light(){return new u({brightness:"light",colorScheme:c.light(),primaryColor:"#2196F3",scaffoldBackgroundColor:"#FAFAFA",canvasColor:"#FFF",cardColor:"#FFF"})}}class b extends R{constructor({data:e,child:t,key:o}={}){super({child:t,key:o}),this.data=e}updateShouldNotify(e){return this.data!==e.data}static of(e){if(!e||!e.dependOnInheritedWidgetOfExactType)return console.warn("Theme.of() called with invalid context"),new u;const t=e.dependOnInheritedWidgetOfExactType(b);return t?t.data:new u}}class N{constructor({name:e="/",builder:t=null,settings:o={}}={}){this.name=e,this.builder=t,this.settings=o}}class _{constructor({routes:e={},initialRoute:t="/",onGenerateRoute:o=null,onUnknownRoute:r=null}={}){this.routes=e,this.initialRoute=t,this.onGenerateRoute=o,this.onUnknownRoute=r,this.routeStack=[],this.currentRoute=t}pushNamed(e,{arguments:t=null}={}){this.currentRoute=e,this.routeStack.push(e)}pop(){return this.routeStack.length>1?(this.routeStack.pop(),this.currentRoute=this.routeStack[this.routeStack.length-1],!0):!1}getCurrentPage(e){const t=this.currentRoute;if(this.routes[t])return this.routes[t](e);if(this.onGenerateRoute){const o={name:t},r=this.onGenerateRoute(o);if(r)return r.builder(e)}if(this.onUnknownRoute){const o={name:t};return this.onUnknownRoute(o).builder(e)}return null}}class T extends W{constructor({key:e=null,title:t="",theme:o=null,darkTheme:r=null,themeMode:i="system",home:a=null,routes:d={},initialRoute:n="/",onGenerateRoute:h=null,onUnknownRoute:f=null,navigatorObservers:m=[],localizationsDelegates:p=[],supportedLocales:y=[{language:"en"}],locale:F=null,builder:g=null,color:l=null}={}){super(e),this.title=t,console.log("\u{1F3D7}\uFE0F MaterialApp constructor - theme passed:",o),this.theme=o||u.light(),this.darkTheme=r||u.dark(),this.themeMode=i,this.color=l,this.home=a,this.routes=d,this.initialRoute=n,this.onGenerateRoute=h,this.onUnknownRoute=f,this.navigatorObservers=m,this.localizationsDelegates=p,this.supportedLocales=y,this.locale=F,this.builder=g,this._pageElement=null,this._cachedPageWidget=null,this.navigator=new _({routes:this.routes,initialRoute:this.initialRoute,onGenerateRoute:this.onGenerateRoute,onUnknownRoute:this.onUnknownRoute}),this.home&&(this.navigator.routes["/"]=k=>this.home),typeof document<"u"&&(document.title=this.title)}_getTheme(){return this.themeMode==="dark"?this.darkTheme:this.themeMode==="light"?this.theme:typeof window<"u"&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)").matches?this.darkTheme:this.theme:this.theme}_applyTheme(e){if(typeof document>"u")return;console.log("\u{1F58C}\uFE0F _applyTheme called. Primary:",e.primaryColor,"Card:",e.cardColor);const t=e.primaryColor||"#2196F3",o=e.cardColor||"#FFFFFF",r=e.scaffoldBackgroundColor||"#FAFAFA",i="#FFFFFF",a=e.brightness==="dark"?"#FFFFFF":"#000000",d=e.brightness==="dark"?"#FFFFFF":"#000000",n=document.documentElement;n.style.setProperty("--primary-color",t),n.style.setProperty("--accent-color",e.accentColor||"#FF4081"),n.style.setProperty("--scaffold-bg",r),n.style.setProperty("--card-color",o),n.style.setProperty("--divider-color",e.dividerColor),n.style.setProperty("--font-family",e.fontFamily),n.style.setProperty("--text-color",a),n.style.setProperty("--md-sys-color-primary",t),n.style.setProperty("--md-sys-color-on-primary",i),n.style.setProperty("--md-sys-color-surface",o),n.style.setProperty("--md-sys-color-on-surface",a),n.style.setProperty("--md-sys-color-background",r),n.style.setProperty("--md-sys-color-on-background",d),document.body.style.backgroundColor=r,document.body.style.fontFamily=e.fontFamily,document.body.style.color=a}_isWidget(e){return!e||typeof e!="object"?!1:typeof e.build=="function"||typeof e.createState=="function"}_buildWidgetToVNode(e,t){if(console.log("\u{1F528} _buildWidgetToVNode called for:",e?.constructor?.name),!e)return console.log("  \u2192 widget is null, returning null"),null;if(e&&e.tag!==void 0)return console.log("  \u2192 Already a VNode"),e;if(typeof e=="string"||typeof e=="number")return console.log("  \u2192 String/number, converting"),String(e);if(this._isWidget(e)){console.log("  \u2192 Is a Widget, checking if can reuse element...");try{let o;const r=t.runtime||t.element?.runtime;if(!r)throw new Error("Runtime not available in context");if(this._pageElement&&this._cachedPageWidget&&e.constructor===this._cachedPageWidget.constructor){console.log("\u267B\uFE0F REUSING existing element, calling rebuild()"),this._pageElement.updateWidget(e),this._cachedPageWidget=e;const i=this._pageElement.build();return console.log("    \u2192 Rebuild returned:",i?.tag||typeof i),this._isWidget(i)?(console.log("    \u2192 Result is still a widget, recursing..."),this._buildWidgetToVNode(i,{...t,runtime:r})):i}if(typeof e.createState=="function"){console.log("\u{1F195} Creating NEW StatefulElement (first mount)"),o=new P(e,null,r),console.log("    \u2192 StatefulElement created"),o.mounted||(console.log("    \u2192 Mounting element..."),o.mount(),console.log("    \u2192 Element mounted"),console.log("    \u2192 State._widget:",o.state?._widget?.constructor?.name),console.log("    \u2192 State.widget.title:",o.state?.widget?.title)),this._pageElement=o,this._cachedPageWidget=e;const i=o.build();return console.log("    \u2192 StatefulElement.build() returned:",i?.tag||typeof i),this._isWidget(i)?(console.log("    \u2192 Result is still a widget, recursing..."),this._buildWidgetToVNode(i,{...t,runtime:r})):i}else if(typeof e.build=="function"){console.log("    \u2192 StatelessWidget detected, creating StatelessElement"),o=new E(e,null,r),o.mounted||o.mount();const i=o.build();return console.log("    \u2192 StatelessElement.build() returned:",i?.tag||typeof i),this._isWidget(i)?(console.log("    \u2192 Result is still a widget, recursing..."),this._buildWidgetToVNode(i,{...t,runtime:r})):i}}catch(o){throw console.error("  \u274C Error building widget:",o),o}}return console.log("  \u2192 Unknown type, returning null"),null}build(e){console.log("\u{1F4D6} MaterialApp.build() START");const t=this._getTheme();this._applyTheme(t);let o=this.navigator.getCurrentPage(e);console.log("\u{1F4C4} Current page widget:",o?.constructor?.name),o||(console.warn("\u26A0\uFE0F No page widget found"),o=this._buildEmptyPage());let r;try{r=this._buildWidgetToVNode(o,e),console.log("\u2705 pageVNode after building:",r?.tag||typeof r)}catch(a){console.error("\u274C Failed to build page widget:",a),r=this._buildErrorPageVNode(a,e)}r||(console.error("\u274C pageVNode is null"),r=this._buildEmptyPageVNode());const i=new C({tag:"div",props:{style:{width:"100%",height:"100%",backgroundColor:t.scaffoldBackgroundColor,color:t.brightness==="dark"?"#FFF":"#000",fontFamily:t.fontFamily,margin:0,padding:0,boxSizing:"border-box",minHeight:"100vh"},"data-app":"MaterialApp","data-theme":t.brightness},children:[r]});return console.log("\u2705 MaterialApp.build() returning VNode"),i}_buildEmptyPage(){return new W({build:()=>this._buildEmptyPageVNode()})}_buildErrorPageVNode(e,t){const o=new w({message:`Application Error:
${e?.message||e?.toString()||"Unknown error"}`,error:e}),r=t?.runtime||t?.element?.runtime,i=new E(o,null,r);return i.mounted||i.mount(),i.build()}_buildEmptyPageVNode(){return new C({tag:"div",props:{style:{padding:"20px",textAlign:"center"}},children:["No page configured"]})}}export{T as MaterialApp,_ as Navigator,N as Route,b as Theme,u as ThemeData};
//# sourceMappingURL=material_app.js.map
