import s from"fs";import l from"path";class h{constructor(e={}){this.options={debugDir:".debug",enabled:!0,level:"info",writeToFile:!0,writeToConsole:!1,includeTimestamp:!0,includeStackTrace:!1,maxFileSize:10*1024*1024,...e},this.logLevels={error:0,warn:1,info:2,debug:3,trace:4},this.currentLevel=this.logLevels[this.options.level],this.logs=[],this.logSessions={},this.indentLevel=0,this.options.writeToFile&&this.ensureDebugDir()}ensureDebugDir(){s.existsSync(this.options.debugDir)||s.mkdirSync(this.options.debugDir,{recursive:!0})}getLogFilePath(e="general"){return l.join(this.options.debugDir,`${e}.log`)}shouldLog(e){return this.logLevels[e]<=this.currentLevel}formatEntry(e,t,i,r=null){const o=this.options.includeTimestamp?new Date().toISOString():"",g="  ".repeat(this.indentLevel),a=e.toUpperCase().padEnd(5),c=t.padEnd(20);let d=`${o} [${a}] [${c}] ${g}${i}`;return r&&(d+=`
`+g+JSON.stringify(r,null,2)),d}write(e,t,i,r){if(!this.shouldLog(e))return;const o=this.formatEntry(e,t,i,r);this.logs.push(o),this.options.writeToConsole&&e==="error"&&console.error(`${t}: ${i}`,r||""),this.options.writeToFile&&this.writeToFile(t,o)}writeToFile(e,t){try{const i=this.getLogFilePath(e);s.appendFileSync(i,t+`
`,"utf-8"),s.statSync(i).size>this.options.maxFileSize&&this.rotateLogFile(i)}catch(i){console.error(`Logger failed to write to ${e}: ${i.message}`)}}rotateLogFile(e){const t=new Date().toISOString().replace(/[:.]/g,"-"),i=e.replace(".log",`.${t}.log`);s.renameSync(e,i)}startSession(e,t="general"){this.logSessions[e]={component:t,startTime:Date.now(),startIndent:this.indentLevel},this.indent(),this.info(t,`\u25BA START SESSION: ${e}`)}endSession(e,t="general"){if(this.logSessions[e]){const i=Date.now()-this.logSessions[e].startTime;this.info(t,`\u25C4 END SESSION: ${e} (${i}ms)`),this.unindent(),delete this.logSessions[e]}}indent(){this.indentLevel++}unindent(){this.indentLevel=Math.max(0,this.indentLevel-1)}error(e,t,i){this.write("error",e,t,i)}warn(e,t,i){this.write("warn",e,t,i)}info(e,t,i){this.write("info",e,t,i)}debug(e,t,i){this.write("debug",e,t,i)}trace(e,t,i){this.write("trace",e,t,i)}methodEntry(e,t,i=null){this.indent(),this.trace(e,`\u2192 ${t}()`,i)}methodExit(e,t,i=null){this.trace(e,`\u2190 ${t}()`,i),this.unindent()}success(e,t,i){this.write("info",e,`\u2713 ${t}`,i)}failure(e,t,i){this.write("error",e,`\u2717 ${t}`,i)}count(e,t,i){this.write("info",e,`${t}: ${i}`)}createComponentLogger(e){return{error:(t,i)=>this.error(e,t,i),warn:(t,i)=>this.warn(e,t,i),info:(t,i)=>this.info(e,t,i),debug:(t,i)=>this.debug(e,t,i),trace:(t,i)=>this.trace(e,t,i),success:(t,i)=>this.success(e,t,i),failure:(t,i)=>this.failure(e,t,i),methodEntry:(t,i)=>this.methodEntry(e,t,i),methodExit:(t,i)=>this.methodExit(e,t,i),startSession:t=>this.startSession(t,e),endSession:t=>this.endSession(t,e),indent:()=>this.indent(),unindent:()=>this.unindent()}}getAllLogs(){return this.logs.join(`
`)}saveLogs(){try{const e=l.join(this.options.debugDir,"_all.log");return s.writeFileSync(e,this.getAllLogs(),"utf-8"),e}catch(e){return console.error("Failed to save logs:",e.message),null}}clearDebugDir(){try{s.existsSync(this.options.debugDir)&&(s.rmSync(this.options.debugDir,{recursive:!0,force:!0}),this.ensureDebugDir())}catch(e){console.error("Failed to clear debug directory:",e.message)}}readDebugFiles(){const e={};try{s.readdirSync(this.options.debugDir).forEach(i=>{if(i.endsWith(".log")){const r=l.join(this.options.debugDir,i);e[i]=s.readFileSync(r,"utf-8")}})}catch(t){console.error("Failed to read debug files:",t.message)}return e}getReport(){const e={totalEntries:this.logs.length,errors:0,warnings:0,info:0,debug:0,trace:0,sessions:Object.keys(this.logSessions).length,debugFiles:[]};this.logs.forEach(t=>{t.includes("[ERROR]")?e.errors++:t.includes("[WARN]")?e.warnings++:t.includes("[INFO]")?e.info++:t.includes("[DEBUG]")?e.debug++:t.includes("[TRACE]")&&e.trace++});try{e.debugFiles=s.readdirSync(this.options.debugDir).filter(t=>t.endsWith(".log"))}catch{}return e}}let n=null;function b(u={}){return n=new h(u),n}function w(){return n||(n=new h),n}export{h as Logger,w as getLogger,b as initLogger};
//# sourceMappingURL=flutterjs_logger.js.map
