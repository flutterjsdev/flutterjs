var it=(h,e)=>()=>(h&&(e=h(h=0)),e);import rt from"fs";import xe from"path";var se,_e=it(()=>{se=class{constructor(e={}){this.options={projectRoot:process.cwd(),frameworkType:"flutter-js",ignoreUnresolved:!1,cacheEnabled:!1,...e},this.frameworkPackages={"@package:flutter":"flutter-js-framework/core","@package:material":"flutter-js-framework/material","@package:cupertino":"flutter-js-framework/cupertino","@package:foundation":"flutter-js-framework/foundation","@package:widgets":"flutter-js-framework/widgets","@package:painting":"flutter-js-framework/painting","@package:rendering":"flutter-js-framework/rendering","@package:animation":"flutter-js-framework/animation"},this.customPackageMappings={},this.resolvedCache=new Map,this.unresolvedCache=new Map,this.localSearchPaths=["src","lib","packages","modules","."],this.results={resolved:[],unresolved:[],errors:[]}}resolve(e,t=[],s={}){let i=`${e}:${JSON.stringify(t)}`;if(this.resolvedCache.has(i))return this.resolvedCache.get(i);if(this.unresolvedCache.has(i))return this.unresolvedCache.get(i);let r={original:e,items:t,resolved:null,actualPath:null,type:null,source:null,isValid:!1,reason:null,fallbacks:[]};if(e.startsWith("@package:")){let n=this.resolveFrameworkPackage(e,t);if(n.isValid)return r.resolved=n.resolved,r.actualPath=n.actualPath,r.type="framework",r.source="framework",r.isValid=!0,r.reason="Resolved from framework mappings",this.resolvedCache.set(i,r),this.results.resolved.push(r),r;r.fallbacks.push({step:1,tried:"framework-package",found:!1,reason:n.reason})}if(!e.startsWith("@")){let n=this.resolveLocalImport(e,t);if(n.isValid)return r.resolved=n.resolved,r.actualPath=n.actualPath,r.type="local",r.source="local",r.isValid=!0,r.reason=`Found in local project at ${n.actualPath}`,this.resolvedCache.set(i,r),this.results.resolved.push(r),r;r.fallbacks.push({step:2,tried:"local-code",locations:n.searchedLocations,found:!1,reason:n.reason})}if(this.options.cacheEnabled){let n=this.resolveFromCache(e,t);if(n.isValid)return r.resolved=n.resolved,r.actualPath=n.actualPath,r.type="cache",r.source="cache",r.isValid=!0,r.reason=`Found in package cache at ${n.actualPath}`,this.resolvedCache.set(i,r),this.results.resolved.push(r),r;r.fallbacks.push({step:3,tried:"package-cache",found:!1,reason:n.reason})}return r.isValid=!1,r.source="error",r.reason=this.generateErrorMessage(e,r.fallbacks),this.options.ignoreUnresolved||this.results.errors.push(r),this.unresolvedCache.set(i,r),this.results.unresolved.push(r),r}resolveFrameworkPackage(e,t){return this.frameworkPackages[e]?{isValid:!0,resolved:this.frameworkPackages[e],actualPath:this.frameworkPackages[e],reason:"Found in framework package mappings"}:this.customPackageMappings[e]?{isValid:!0,resolved:this.customPackageMappings[e],actualPath:this.customPackageMappings[e],reason:"Found in custom package mappings"}:{isValid:!1,reason:`Framework package "${e}" not found in mappings`}}resolveLocalImport(e,t){let s=[];if(e.startsWith("./")||e.startsWith("../")){let i=xe.resolve(this.options.projectRoot,e);return s.push(i),this.fileExists(i)?{isValid:!0,resolved:e,actualPath:i,reason:"Relative import found"}:this.fileExists(`${i}.js`)?{isValid:!0,resolved:e,actualPath:`${i}.js`,reason:"Relative import found (with .js)"}:{isValid:!1,searchedLocations:s,reason:`Relative import not found: ${e}`}}for(let i of this.localSearchPaths){let r=xe.resolve(this.options.projectRoot,i,e);s.push(r);let n=xe.join(r,"index.js");if(this.fileExists(n))return{isValid:!0,resolved:e,actualPath:n,reason:`Found in ${i}/${e}/index.js`};if(this.fileExists(`${r}.js`))return{isValid:!0,resolved:e,actualPath:`${r}.js`,reason:`Found in ${i}/${e}.js`};if(this.fileExists(`${r}.fjs`))return{isValid:!0,resolved:e,actualPath:`${r}.fjs`,reason:`Found in ${i}/${e}.fjs`}}return{isValid:!1,searchedLocations:s,reason:`Local import not found in: ${this.localSearchPaths.join(", ")}`}}resolveFromCache(e,t){return{isValid:!1,reason:"Package cache resolution not yet implemented"}}fileExists(e){try{return rt.existsSync(e)}catch{return!1}}generateErrorMessage(e,t){let s=`\u274C Import not found: "${e}"

Resolution chain:
`;return t.forEach(i=>{s+=`  ${i.step}. Checked ${i.tried}: NOT FOUND
`,i.locations&&(s+=`     Locations searched:
`,i.locations.forEach(r=>{s+=`       - ${r}
`})),i.reason&&(s+=`     (${i.reason})
`)}),s+=`
Suggestions:
`,s+=`  \u2022 Verify the import path is correct
`,s+=`  \u2022 Check that the file exists in your project
`,s+=`  \u2022 Add a custom package mapping if needed: addPackageMapping()
`,s}resolveImports(e){return this.results={resolved:[],unresolved:[],errors:[]},e.forEach(t=>{this.resolve(t.source,t.items)}),{imports:this.results,summary:this.getSummary()}}addPackageMapping(e,t){e.startsWith("@package:")?(this.customPackageMappings[e]=t,console.log(`\u2713 Added mapping: ${e} \u2192 ${t}`)):console.warn("\u26A0 Custom mappings should start with @package:")}addPackageMappings(e){Object.entries(e).forEach(([t,s])=>{this.addPackageMapping(t,s)})}getPackageMappings(){return{framework:this.frameworkPackages,custom:this.customPackageMappings}}setLocalSearchPaths(e){this.localSearchPaths=e,console.log(`\u2713 Set local search paths: ${e.join(", ")}`)}getSummary(){let e=this.results.resolved.length+this.results.unresolved.length,t=this.results.resolved.length,s=this.results.unresolved.length;return{total:e,resolved:t,unresolved:s,errors:this.results.errors.length,resolutionRate:e>0?(t/e*100).toFixed(2)+"%":"N/A",bySource:{framework:this.results.resolved.filter(i=>i.source==="framework").length,local:this.results.resolved.filter(i=>i.source==="local").length,cache:this.results.resolved.filter(i=>i.source==="cache").length}}}generateReport(){let e=this.getSummary();return`
\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557
\u2551         IMPORT RESOLUTION REPORT                           \u2551
\u255A\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255D

\u{1F4CA} Summary
\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
  Total Imports:    ${e.total}
  \u2713 Resolved:       ${e.resolved} (${e.resolutionRate})
  \u2717 Unresolved:     ${e.unresolved}
  \u26A0 Errors:         ${e.errors}

\u{1F4CD} Resolution Sources
\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
  Framework:        ${e.bySource.framework}
  Local Code:       ${e.bySource.local}
  Package Cache:    ${e.bySource.cache}

${this.results.unresolved.length>0?`
\u26A0\uFE0F  UNRESOLVED IMPORTS
\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
${this.results.unresolved.map(s=>`  \u274C ${s.original}
     Reason: ${s.reason}`).join(`
`)}
`:""}

${this.results.errors.length>0?`
\u{1F534} ERRORS
\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500
${this.results.errors.map(s=>`  \u2022 ${s.reason}`).join(`
`)}
`:""}
`}clearCache(){this.resolvedCache.clear(),this.unresolvedCache.clear(),console.log("\u2713 Resolution cache cleared")}}});import Xe from"fs";var v=class{constructor(e,t,s,i){this.type=e,this.value=t,this.line=s,this.column=i}toString(){return`Token(${this.type}, "${this.value}", ${this.line}:${this.column})`}isType(e){return Array.isArray(e)?e.includes(this.type):this.type===e}},o={STRING:"STRING",NUMBER:"NUMBER",BOOLEAN:"BOOLEAN",NULL:"NULL",UNDEFINED:"UNDEFINED",KEYWORD:"KEYWORD",IDENTIFIER:"IDENTIFIER",OPERATOR:"OPERATOR",PUNCTUATION:"PUNCTUATION",COMMENT:"COMMENT",WHITESPACE:"WHITESPACE",NEWLINE:"NEWLINE",EOF:"EOF"},q=class{constructor(e,t={}){this.source=e,this.position=0,this.line=1,this.column=0,this.tokens=[],this.errors=[],this.options={includeWhitespace:!1,includeComments:!0,...t},this.keywords=new Set(["class","extends","constructor","new","const","function","return","if","else","for","while","this","static","async","await","import","export","from","as","default","true","false","null","undefined","typeof","instanceof","void","delete"])}tokenize(){for(;this.position<this.source.length;)this.scanToken();return this.tokens.push(new v(o.EOF,"",this.line,this.column)),this.tokens}scanToken(){let e=this.peek();return this.isWhitespace(e)?this.scanWhitespace():e==="/"&&(this.peekNext()==="/"||this.peekNext()==="*")?this.scanComment():e==='"'||e==="'"||e==="`"?this.scanString():this.isDigit(e)?this.scanNumber():this.isIdentifierStart(e)?this.scanIdentifier():this.scanOperatorOrPunctuation()}scanWhitespace(){let e=this.column,t="";for(;this.position<this.source.length&&this.isWhitespace(this.peek());){let s=this.advance();t+=s,s===`
`&&(this.options.includeWhitespace&&this.tokens.push(new v(o.NEWLINE,`
`,this.line-1,e)),this.line++,this.column=0,t="")}this.options.includeWhitespace&&t.length>0&&this.tokens.push(new v(o.WHITESPACE,t,this.line,e))}scanComment(){let e=this.line,t=this.column,s="";if(this.peekNext()==="/"){for(this.advance(),this.advance();this.position<this.source.length&&this.peek()!==`
`;)s+=this.advance();this.options.includeComments&&this.tokens.push(new v(o.COMMENT,s,e,t))}else if(this.peekNext()==="*"){for(this.advance(),this.advance();this.position<this.source.length;){if(this.peek()==="*"&&this.peekNext()==="/"){this.advance(),this.advance();break}let i=this.advance();s+=i,i===`
`&&(this.line++,this.column=0)}this.options.includeComments&&this.tokens.push(new v(o.COMMENT,s,e,t))}}scanString(){let e=this.line,t=this.column,s=this.advance(),i="";for(;this.position<this.source.length;){let r=this.peek();if(r===s){this.advance();break}if(r==="\\"){this.advance();let n=this.advance();i+=this.getEscapeSequence(n)}else r===`
`&&(this.line++,this.column=0),i+=this.advance()}this.tokens.push(new v(o.STRING,i,e,t))}scanNumber(){let e=this.line,t=this.column,s="";for(;this.position<this.source.length&&this.isDigit(this.peek());)s+=this.advance();if(this.peek()==="."&&this.isDigit(this.peekNext()))for(s+=this.advance();this.position<this.source.length&&this.isDigit(this.peek());)s+=this.advance();if((this.peek()==="e"||this.peek()==="E")&&this.isDigit(this.peekNext()))for(s+=this.advance(),(this.peek()==="+"||this.peek()==="-")&&(s+=this.advance());this.position<this.source.length&&this.isDigit(this.peek());)s+=this.advance();this.tokens.push(new v(o.NUMBER,s,e,t))}scanIdentifier(){let e=this.line,t=this.column,s="";for(;this.position<this.source.length&&this.isIdentifierPart(this.peek());)s+=this.advance();let i=o.IDENTIFIER;this.keywords.has(s)&&(s==="true"||s==="false"?i=o.BOOLEAN:s==="null"?i=o.NULL:s==="undefined"?i=o.UNDEFINED:i=o.KEYWORD),this.tokens.push(new v(i,s,e,t))}scanOperatorOrPunctuation(){let e=this.line,t=this.column,s=this.advance(),i=s+(this.peek()||"");if(["=>","==","!=","===","!==","<=",">=","++","--","&&","||","+=","-=","*=","/=","%=","??","?.","..","**"].includes(i)){this.advance(),this.tokens.push(new v(o.OPERATOR,i,e,t));return}let n=i+(this.peek()||"");if(["===","!==","..."].includes(n)){this.advance(),this.tokens.push(new v(o.OPERATOR,n,e,t));return}if(["+","-","*","/","%","=","<",">","!","&","|","^","~","?",":"].includes(s)){this.tokens.push(new v(o.OPERATOR,s,e,t));return}if(["{","}","(",")","[","]",";",",",".","@","#"].includes(s)){this.tokens.push(new v(o.PUNCTUATION,s,e,t));return}this.errors.push({message:`Unexpected character: '${s}'`,line:e,column:t})}peek(e=0){let t=this.position+e;return t>=this.source.length?null:this.source[t]}peekNext(){return this.peek(1)}advance(){let e=this.source[this.position];return this.position++,this.column++,e}isWhitespace(e){return e===" "||e==="	"||e==="\r"||e===`
`}isDigit(e){return e>="0"&&e<="9"}isIdentifierStart(e){return e?e>="a"&&e<="z"||e>="A"&&e<="Z"||e==="_"||e==="$":!1}isIdentifierPart(e){return e?this.isIdentifierStart(e)||this.isDigit(e):!1}getEscapeSequence(e){return{n:`
`,t:"	",r:"\r","\\":"\\",'"':'"',"'":"'","`":"`",0:"\0"}[e]||e}getTokens(){return this.tokens}getErrors(){return this.errors}printTokens(){console.log(`
=== TOKENS ===
`),this.tokens.forEach((e,t)=>{console.log(`[${t}] ${e.toString()}`)}),console.log(`
Total: ${this.tokens.length} tokens
`)}};import E from"fs";import re from"path";var V=class{constructor(e={}){this.options={debugDir:".debug",enabled:!0,level:"info",writeToFile:!0,writeToConsole:!1,includeTimestamp:!0,includeStackTrace:!1,maxFileSize:10*1024*1024,...e},this.logLevels={error:0,warn:1,info:2,debug:3,trace:4},this.currentLevel=this.logLevels[this.options.level],this.logs=[],this.logSessions={},this.indentLevel=0,this.options.writeToFile&&this.ensureDebugDir()}ensureDebugDir(){E.existsSync(this.options.debugDir)||E.mkdirSync(this.options.debugDir,{recursive:!0})}getLogFilePath(e="general"){return re.join(this.options.debugDir,`${e}.log`)}shouldLog(e){return this.logLevels[e]<=this.currentLevel}formatEntry(e,t,s,i=null){let r=this.options.includeTimestamp?new Date().toISOString():"",n="  ".repeat(this.indentLevel),l=e.toUpperCase().padEnd(5),a=t.padEnd(20),c=`${r} [${l}] [${a}] ${n}${s}`;return i&&(c+=`
`+n+JSON.stringify(i,null,2)),c}write(e,t,s,i){if(!this.shouldLog(e))return;let r=this.formatEntry(e,t,s,i);this.logs.push(r),this.options.writeToConsole&&e==="error"&&console.error(`${t}: ${s}`,i||""),this.options.writeToFile&&this.writeToFile(t,r)}writeToFile(e,t){try{let s=this.getLogFilePath(e);E.appendFileSync(s,t+`
`,"utf-8"),E.statSync(s).size>this.options.maxFileSize&&this.rotateLogFile(s)}catch(s){console.error(`Logger failed to write to ${e}: ${s.message}`)}}rotateLogFile(e){let t=new Date().toISOString().replace(/[:.]/g,"-"),s=e.replace(".log",`.${t}.log`);E.renameSync(e,s)}startSession(e,t="general"){this.logSessions[e]={component:t,startTime:Date.now(),startIndent:this.indentLevel},this.indent(),this.info(t,`\u25BA START SESSION: ${e}`)}endSession(e,t="general"){if(this.logSessions[e]){let s=Date.now()-this.logSessions[e].startTime;this.info(t,`\u25C4 END SESSION: ${e} (${s}ms)`),this.unindent(),delete this.logSessions[e]}}indent(){this.indentLevel++}unindent(){this.indentLevel=Math.max(0,this.indentLevel-1)}error(e,t,s){this.write("error",e,t,s)}warn(e,t,s){this.write("warn",e,t,s)}info(e,t,s){this.write("info",e,t,s)}debug(e,t,s){this.write("debug",e,t,s)}trace(e,t,s){this.write("trace",e,t,s)}methodEntry(e,t,s=null){this.indent(),this.trace(e,`\u2192 ${t}()`,s)}methodExit(e,t,s=null){this.trace(e,`\u2190 ${t}()`,s),this.unindent()}success(e,t,s){this.write("info",e,`\u2713 ${t}`,s)}failure(e,t,s){this.write("error",e,`\u2717 ${t}`,s)}count(e,t,s){this.write("info",e,`${t}: ${s}`)}createComponentLogger(e){return{error:(t,s)=>this.error(e,t,s),warn:(t,s)=>this.warn(e,t,s),info:(t,s)=>this.info(e,t,s),debug:(t,s)=>this.debug(e,t,s),trace:(t,s)=>this.trace(e,t,s),success:(t,s)=>this.success(e,t,s),failure:(t,s)=>this.failure(e,t,s),methodEntry:(t,s)=>this.methodEntry(e,t,s),methodExit:(t,s)=>this.methodExit(e,t,s),startSession:t=>this.startSession(t,e),endSession:t=>this.endSession(t,e),indent:()=>this.indent(),unindent:()=>this.unindent()}}getAllLogs(){return this.logs.join(`
`)}saveLogs(){try{let e=re.join(this.options.debugDir,"_all.log");return E.writeFileSync(e,this.getAllLogs(),"utf-8"),e}catch(e){return console.error("Failed to save logs:",e.message),null}}clearDebugDir(){try{E.existsSync(this.options.debugDir)&&(E.rmSync(this.options.debugDir,{recursive:!0,force:!0}),this.ensureDebugDir())}catch(e){console.error("Failed to clear debug directory:",e.message)}}readDebugFiles(){let e={};try{E.readdirSync(this.options.debugDir).forEach(s=>{if(s.endsWith(".log")){let i=re.join(this.options.debugDir,s);e[s]=E.readFileSync(i,"utf-8")}})}catch(t){console.error("Failed to read debug files:",t.message)}return e}getReport(){let e={totalEntries:this.logs.length,errors:0,warnings:0,info:0,debug:0,trace:0,sessions:Object.keys(this.logSessions).length,debugFiles:[]};this.logs.forEach(t=>{t.includes("[ERROR]")?e.errors++:t.includes("[WARN]")?e.warnings++:t.includes("[INFO]")?e.info++:t.includes("[DEBUG]")?e.debug++:t.includes("[TRACE]")&&e.trace++});try{e.debugFiles=E.readdirSync(this.options.debugDir).filter(t=>t.endsWith(".log"))}catch{}return e}},D=null;function Qe(h={}){return D=new V(h),D}function w(){return D||(D=new V),D}var p=class{constructor(e,t){this.type=e,this.location=t}},ne=class extends p{constructor(e=[],t=null){super("Program",t),this.body=e}},ae=class extends p{constructor(e=[],t=null,s=null){super("ImportDeclaration",s),this.specifiers=e,this.source=t}},oe=class extends p{constructor(e=null,t=null,s=null){super("ImportSpecifier",s),this.imported=e,this.local=t}},le=class extends p{constructor(e=null,t=null,s=null,i=null){super("ClassDeclaration",i),this.id=e,this.superClass=t,this.body=s}},ce=class extends p{constructor(e=[],t=[],s=null){super("ClassBody",s),this.fields=e,this.methods=t}},he=class extends p{constructor(e=null,t=null,s=null){super("FieldDeclaration",s),this.key=e,this.initialValue=t}},ue=class extends p{constructor(e=null,t=[],s=null,i=null){super("MethodDeclaration",i),this.key=e,this.params=t,this.body=s}},I=class extends p{constructor(e=null,t=!1,s=null,i=null){super("Parameter",i),this.name=e,this.optional=t,this.defaultValue=s}},de=class extends p{constructor(e=null,t=[],s=null,i=!1,r=null){super("FunctionDeclaration",r),this.id=e,this.params=t,this.body=s,this.isAsync=i}},pe=class extends p{constructor(e=[],t=null){super("BlockStatement",t),this.body=e}},fe=class extends p{constructor(e=null,t=null){super("ReturnStatement",t),this.argument=e}},B=class extends p{constructor(e=null,t=null){super("ExpressionStatement",t),this.expression=e}},m=class extends p{constructor(e="",t=null){super("Identifier",t),this.name=e}},f=class extends p{constructor(e=null,t="",s="string",i=null){super("Literal",i),this.value=e,this.raw=t,this.literalType=s}},ge=class extends p{constructor(e=null,t=[],s=null){super("CallExpression",s),this.callee=e,this.args=t}},H=class extends p{constructor(e=null,t=[],s=null){super("NewExpression",s),this.callee=e,this.args=t,this.isConst=!1}},me=class extends p{constructor(e=[],t=null){super("ObjectLiteral",t),this.properties=e}},ye=class extends p{constructor(e=null,t=null,s=null){super("Property",s),this.key=e,this.value=t,this.shorthand=!1}},z=class extends p{constructor(e=[],t=null,s=null){super("ArrowFunctionExpression",s),this.params=e,this.body=t}},G=class extends p{constructor(e=null,t=null,s=!1,i=null){super("MemberExpression",i),this.object=e,this.property=t,this.computed=s}},K=class{constructor(e=[],t={}){this.tokens=e,this.current=0,this.errors=[],this.options={strict:!1,...t},this.callStack=[],this.debugMode=!0}parse(){let e=[];for(;!this.isAtEnd();)try{let t=this.parseTopLevel();t&&e.push(t)}catch(t){this.errors.push(t),this.synchronize()}return new ne(e)}parseTopLevel(){if(this.isAtEnd())return null;if(this.isKeyword("import"))return this.advance(),this.parseImportDeclaration();if(this.isKeyword("class"))return this.advance(),this.parseClassDeclaration();if(this.isKeyword("function"))return this.advance(),this.parseFunctionDeclaration();let e=this.parseExpression();return this.consumeStatementEnd(),new B(e,this.getLocation())}isKeyword(e){if(this.isAtEnd())return!1;let t=this.peek();return t.type===o.KEYWORD&&t.value===e}isPunctuation(e){if(this.isAtEnd())return!1;let t=this.peek();return t.type===o.PUNCTUATION&&t.value===e}isOperator(e){if(this.isAtEnd())return!1;let t=this.peek();return t.type===o.OPERATOR&&t.value===e}parseImportDeclaration(){let e=this.getLocation(),t=[];if(this.isPunctuation("{")){for(this.advance();!this.isPunctuation("}")&&!this.isAtEnd();){let i=this.consume(o.IDENTIFIER,"Expected identifier").value,r=new m(i),n=r;if(this.isKeyword("as")){this.advance();let l=this.consume(o.IDENTIFIER,"Expected identifier").value;n=new m(l)}if(t.push(new oe(r,n)),!this.isPunctuation(","))break;this.advance()}this.consume(o.PUNCTUATION,"Expected }")}this.consume(o.KEYWORD,"Expected from");let s=new f(this.consume(o.STRING,"Expected string").value,"","string");return this.consumeStatementEnd(),new ae(t,s,e)}parseClassDeclaration(){let e=w().createComponentLogger("Parser.parseClassDeclaration");e.startSession("parseClassDeclaration"),e.trace(`  Current token: ${this.peek().value} (${this.peek().type})`);let t=this.getLocation(),s=this.consume(o.IDENTIFIER,"Expected class name"),i=new m(s.value);e.trace(`  Class name: ${i.name}`);let r=null;if(this.isKeyword("extends")){this.advance();let u=this.consume(o.IDENTIFIER,"Expected superclass name").value;r=new m(u),e.trace(`  Extends: ${r.name}`),this.isOperator("<")&&(this.advance(),this.consume(o.IDENTIFIER,"Expected type name"),this.consume(o.OPERATOR,"Expected >"))}e.trace("  Looking for opening brace..."),e.trace(`  Current token: ${this.peek().value} (${this.peek().type})`),this.consume(o.PUNCTUATION,"Expected {");let n=[],l=[];e.trace("  Parsing class body...");let a=0;for(;!this.isPunctuation("}")&&!this.isAtEnd();){if(e.trace(`    [item ${a}] Current token: ${this.peek().value} (${this.peek().type})`),this.isPunctuation(";")){e.trace("    Skipping semicolon"),this.advance();continue}if(this.isKeyword("constructor")){e.trace("    Found constructor"),l.push(this.parseMethodDeclaration()),a++;continue}if(this.check(o.IDENTIFIER)){let u=this.current,y=this.peek().value;if(e.trace(`    Found identifier: ${y}`),this.advance(),this.isOperator("=")){e.trace("      -> This is a FIELD (followed by =)"),this.current=u;try{n.push(this.parseFieldDeclaration()),e.trace("      Field parsed successfully"),a++;continue}catch(g){throw console.error(`      ERROR parsing field: ${g.message}`),g}}if(this.isPunctuation("(")){e.trace("      -> This is a METHOD (followed by '(')"),this.current=u;try{l.push(this.parseMethodDeclaration()),e.trace("      Method parsed successfully"),a++;continue}catch(g){throw console.error(`      ERROR parsing method: ${g.message}`),g}}e.trace("      -> Unknown pattern, skipping"),this.advance();continue}e.trace(`    Skipping unknown token: ${this.peek().value}`),this.advance()}e.trace(`  Class body parsing complete. Found ${n.length} fields, ${l.length} methods`),this.consume(o.PUNCTUATION,"Expected }");let c=new ce(n,l);return e.trace(`[parseClassDeclaration] SUCCESS
`),new le(i,r,c,t)}parseMethodDeclaration(){let e=w().createComponentLogger("Parser.parseMethodDeclaration");e.startSession("      [parseMethodDeclaration] STARTING"),e.trace(`        Current: ${this.peek().value}`);let t=this.getLocation(),s;this.isKeyword("constructor")?(s="constructor",this.advance()):s=this.consume(o.IDENTIFIER,"Expected method name").value,e.trace(`        Method name: ${s}`);let i=new m(s);this.consume(o.PUNCTUATION,"Expected (");let r=this.parseParameterList();e.trace(`        Parameters: ${r.length}`),this.consume(o.PUNCTUATION,"Expected )");let n=null;return this.isOperator("=>")?(e.trace("        Arrow function body"),this.advance(),n=this.parseExpression()):this.isPunctuation("{")&&(e.trace("        Block body"),this.advance(),n=this.parseBlock()),e.trace("      [parseMethodDeclaration] SUCCESS"),new ue(i,r,n,t)}parseFieldDeclaration(){console.log("      [parseFieldDeclaration] STARTING"),console.log(`        Current: ${this.peek().value}`);let e=this.getLocation(),t=this.consume(o.IDENTIFIER,"Expected field name").value,s=new m(t);console.log(`        Field name: ${t}`);let i=null;if(this.isOperator("=")){console.log("        Found = operator, parsing initializer..."),this.advance();try{i=this.parseExpression(),console.log(`        Initializer parsed: ${i.type}`)}catch(r){throw console.error(`        ERROR parsing initializer: ${r.message}`),r}}return this.consumeStatementEnd(),console.log("      [parseFieldDeclaration] SUCCESS"),new he(s,i,e)}parseFunctionDeclaration(){let e=this.getLocation(),t=this.consume(o.IDENTIFIER,"Expected function name"),s=t.value?new m(t.value):null;this.consume(o.PUNCTUATION,"Expected (");let i=this.parseParameterList();this.consume(o.PUNCTUATION,"Expected )"),this.consume(o.PUNCTUATION,"Expected {");let r=this.parseBlock();return new de(s,i,r,!1,e)}parseParameterList(){let e=[];for(;!this.isPunctuation(")")&&!this.isAtEnd();){let t=this.getLocation();if(this.isPunctuation("{")){for(this.advance();!this.isPunctuation("}")&&!this.isAtEnd();){let s=this.consume(o.IDENTIFIER,"Expected param name").value,i=null;if(this.isOperator("=")){this.advance();let r=this.peek();this.check(o.IDENTIFIER)?i=new m(this.advance().value):this.check(o.NUMBER)?i=new f(parseFloat(this.advance().value),"","number"):this.check(o.UNDEFINED)?(this.advance(),i=new f(void 0,"undefined","undefined")):this.check(o.NULL)?(this.advance(),i=new f(null,"null","null")):this.isKeyword("undefined")?(this.advance(),i=new f(void 0,"undefined","undefined")):this.isKeyword("null")&&(this.advance(),i=new f(null,"null","null"))}if(e.push(new I(new m(s),i!==null,i,t)),!this.isPunctuation(","))break;this.advance()}if(this.consume(o.PUNCTUATION,"Expected }"),this.isOperator("=")&&(this.advance(),this.isPunctuation("{"))){this.advance();let s=1;for(;s>0&&!this.isAtEnd();)this.isPunctuation("{")?s++:this.isPunctuation("}")&&s--,s>0&&this.advance();this.consume(o.PUNCTUATION,"Expected }")}}else if(this.check(o.IDENTIFIER)){let s=this.consume(o.IDENTIFIER,"Expected param name").value,i=null;if(this.isOperator("=")){this.advance();let r=this.peek();this.check(o.IDENTIFIER)?i=new m(this.advance().value):this.check(o.NUMBER)?i=new f(parseFloat(this.advance().value),"","number"):this.check(o.UNDEFINED)?(this.advance(),i=new f(void 0,"undefined","undefined")):this.check(o.NULL)?(this.advance(),i=new f(null,"null","null")):this.isKeyword("undefined")?(this.advance(),i=new f(void 0,"undefined","undefined")):this.isKeyword("null")&&(this.advance(),i=new f(null,"null","null"))}e.push(new I(new m(s),i!==null,i,t))}else break;if(!this.isPunctuation(","))break;this.advance()}return e}parseBlock(){console.log(`
[parseBlock] STARTING at token: ${this.peek().value}`);let e=this.getLocation(),t=[];for(;!this.isPunctuation("}")&&!this.isAtEnd();)if(console.log(`  [parseBlock] Current token: ${this.peek().value} (${this.peek().type})`),this.isKeyword("return")){console.log("    Found RETURN statement"),this.advance();let s=null;if(!this.isPunctuation(";")&&!this.isPunctuation("}")){console.log("    Parsing return argument...");try{s=this.parseExpression(),console.log("    Return argument parsed successfully")}catch(i){for(console.error(`    \u274C ERROR parsing return argument: ${i.message}`),console.error(`       Token was: ${this.peek().value}`);!this.isPunctuation(";")&&!this.isPunctuation("}")&&!this.isAtEnd();)this.advance()}}this.consumeStatementEnd(),t.push(new fe(s,e))}else{console.log("    Parsing expression statement...");try{let s=this.parseExpression();console.log(`    Expression parsed successfully: ${s.type}`),this.consumeStatementEnd(),t.push(new B(s,e))}catch(s){for(console.error(`    \u274C ERROR parsing expression: ${s.message}`),console.error(`       Token was: ${this.peek().value}`);!this.isPunctuation(";")&&!this.isPunctuation("}")&&!this.isAtEnd();)this.advance();this.isPunctuation(";")&&this.advance()}}return this.isPunctuation("}")&&this.advance(),console.log(`[parseBlock] SUCCESS - ${t.length} statements
`),new pe(t,e)}parseExpression(){console.log(`    [parseExpression] Current token: ${this.peek().value}`);try{let e=this.parseAssignment();return console.log(`    [parseExpression] \u2713 Success, type: ${e.type}`),e}catch(e){throw console.error(`    [parseExpression] \u2717 Failed: ${e.message}`),e}}parseAssignment(){let e=this.parseTernary();if(this.isOperator("=")){this.advance();let t=this.parseAssignment();return{type:"AssignmentExpression",left:e,right:t}}return e}parseTernary(){let e=this.parseLogicalOr();if(this.isOperator("?")){this.advance();let t=this.parseExpression();this.consume(o.OPERATOR,"Expected :");let s=this.parseExpression();return{type:"ConditionalExpression",test:e,consequent:t,alternate:s}}return e}parseLogicalOr(){let e=this.parseLogicalAnd();for(;this.isOperator("||");){this.advance();let t=this.parseLogicalAnd();e={type:"LogicalExpression",operator:"||",left:e,right:t}}return e}parseLogicalAnd(){let e=this.parseEquality();for(;this.isOperator("&&");){this.advance();let t=this.parseEquality();e={type:"LogicalExpression",operator:"&&",left:e,right:t}}return e}parseEquality(){let e=this.parseRelational();for(;this.isOperator("===")||this.isOperator("!==")||this.isOperator("==")||this.isOperator("!=");){let t=this.advance().value,s=this.parseRelational();e={type:"BinaryExpression",operator:t,left:e,right:s}}return e}parseRelational(){let e=this.parseAdditive();for(;this.isOperator("<")||this.isOperator(">")||this.isOperator("<=")||this.isOperator(">=");){let t=this.advance().value,s=this.parseAdditive();e={type:"BinaryExpression",operator:t,left:e,right:s}}return e}parseAdditive(){let e=this.parseMultiplicative();for(;this.isOperator("+")||this.isOperator("-");){let t=this.advance().value,s=this.parseMultiplicative();e={type:"BinaryExpression",operator:t,left:e,right:s}}return e}parseMultiplicative(){let e=this.parseUnary();for(;this.isOperator("*")||this.isOperator("/")||this.isOperator("%");){let t=this.advance().value,s=this.parseUnary();e={type:"BinaryExpression",operator:t,left:e,right:s}}return e}parseUnary(){if(console.log(`        [parseUnary] Current: ${this.peek().value}`),this.isOperator("!")||this.isOperator("-")||this.isOperator("+")||this.isOperator("~")){let e=this.advance().value,t=this.parseUnary();return{type:"UnaryExpression",operator:e,argument:t}}return console.log("        [parseUnary] Calling parsePostfix"),this.parsePostfix()}parsePostfix(){console.log("        [parsePostfix] Starting, calling parseCall");let e=this.parseCall();for(console.log(`        [parsePostfix] parseCall returned: ${e.type||e.name}`),console.log(`        [parsePostfix] Next token: ${this.peek().value}`);;)if(this.isOperator("++")||this.isOperator("--"))e={type:"UpdateExpression",operator:this.advance().value,argument:e,prefix:!1};else if(this.isPunctuation(".")){console.log("        [parsePostfix] Found . member access"),this.advance();let t=new m(this.consume(o.IDENTIFIER,"Expected property").value);e=new G(e,t,!1),console.log(`        [parsePostfix] Created MemberExpression: ${e.object.name}.${e.property.name}`)}else if(this.isPunctuation("[")){console.log("        [parsePostfix] Found [ computed access"),this.advance();let t=this.parseExpression();this.consume(o.PUNCTUATION,"Expected ]"),e=new G(e,t,!0)}else{console.log(`        [parsePostfix] No more postfix ops, returning ${e.type}`);break}return e}parseCall(){console.log("        [parseCall] Starting, calling parsePrimary");let e=this.parsePrimary();for(console.log(`        [parseCall] parsePrimary returned: ${e.type||e.name}`),console.log(`        [parseCall] Next token: ${this.peek().value} (${this.peek().type})`);this.isPunctuation("(");){console.log("        [parseCall] Found (, parsing function call"),this.advance();let t=this.parseArguments();console.log(`        [parseCall] Parsed ${t.length} arguments`),this.consume(o.PUNCTUATION,"Expected )"),e=new ge(e,t),console.log("        [parseCall] Created CallExpression")}return console.log(`        [parseCall] Returning: ${e.type}`),e}parsePrimary(){if(console.log(`      [parsePrimary] Current: ${this.peek().value} (${this.peek().type})`),this.isKeyword("this"))return this.advance(),console.log("      [parsePrimary] \u2713 this keyword"),new m("this");if(this.check(o.STRING)){let e=this.advance();return console.log(`      [parsePrimary] \u2713 string literal: ${e.value}`),new f(e.value,e.value,"string")}if(this.check(o.NUMBER)){let e=this.advance();return console.log(`      [parsePrimary] \u2713 number literal: ${e.value}`),new f(parseFloat(e.value),e.value,"number")}if(this.check(o.BOOLEAN)){let e=this.advance();return console.log(`      [parsePrimary] \u2713 boolean: ${e.value}`),new f(e.value==="true",e.value,"boolean")}if(this.check(o.NULL))return this.advance(),console.log("      [parsePrimary] \u2713 null"),new f(null,"null","null");if(this.check(o.UNDEFINED))return this.advance(),console.log("      [parsePrimary] \u2713 undefined"),new f(void 0,"undefined","undefined");if(this.isKeyword("null"))return this.advance(),console.log("      [parsePrimary] \u2713 null keyword"),new f(null,"null","null");if(this.isKeyword("undefined"))return this.advance(),console.log("      [parsePrimary] \u2713 undefined keyword"),new f(void 0,"undefined","undefined");if(this.isPunctuation("(")){console.log("      [parsePrimary] Found ( - checking for arrow function or grouped expr");let e=this.current;if(this.advance(),this.isPunctuation(")")){let s=this.current+1;if(s<this.tokens.length&&this.tokens[s].type===o.OPERATOR&&this.tokens[s].value==="=>"){console.log("      [parsePrimary] \u2713 arrow function with no params: () => ..."),this.consume(o.PUNCTUATION,"Expected )"),this.consume(o.OPERATOR,"Expected =>");let i=this.parseExpression();return new z([],i)}}let t=this.parseExpression();if(this.consume(o.PUNCTUATION,"Expected )"),this.isOperator("=>")){console.log("      [parsePrimary] \u2713 arrow function: (x) => ..."),this.advance();let s=this.parseExpression(),i=[];return t.type==="Identifier"&&(i=[new I(t,!1,null)]),new z(i,s)}return console.log("      [parsePrimary] \u2713 grouped expression"),t}if(this.isPunctuation("{"))return console.log("      [parsePrimary] \u2713 object literal"),this.advance(),this.parseObjectLiteral();if(this.isPunctuation("[")){console.log("      [parsePrimary] \u2713 array literal"),this.advance();let e=[];for(;!this.isPunctuation("]")&&!this.isAtEnd()&&(e.push(this.parseExpression()),!!this.isPunctuation(","));)this.advance();return this.consume(o.PUNCTUATION,"Expected ]"),{type:"ArrayLiteral",elements:e}}if(this.isKeyword("new")){console.log("      [parsePrimary] \u2713 new expression"),this.advance();let e=new m(this.consume(o.IDENTIFIER,"Expected class name").value);this.consume(o.PUNCTUATION,"Expected (");let t=this.parseArguments();return this.consume(o.PUNCTUATION,"Expected )"),new H(e,t)}if(this.isKeyword("const")){let e=this.current;if(this.advance(),this.isKeyword("new")){console.log("      [parsePrimary] \u2713 const new expression"),this.advance();let t=new m(this.consume(o.IDENTIFIER,"Expected class name").value);this.consume(o.PUNCTUATION,"Expected (");let s=this.parseArguments();this.consume(o.PUNCTUATION,"Expected )");let i=new H(t,s);return i.isConst=!0,i}this.current=e}if(this.check(o.IDENTIFIER)){let e=this.advance(),t=new m(e.value);if(console.log(`      [parsePrimary] \u2713 identifier: ${e.value}`),this.isOperator("=>")){console.log("      [parsePrimary] \u2713 arrow function: x => ..."),this.advance();let s=this.parseExpression();return new z([new I(t)],s)}return t}throw console.error(`      [parsePrimary] \u274C FAILED - Cannot parse token: ${this.peek().value} (${this.peek().type})`),this.error("Expected expression")}enterMethod(e){this.callStack||(this.callStack=[]),this.callStack.push({method:e,line:this.peek().line,column:this.peek().column,token:this.peek().value})}parseObjectLiteral(){this.enterMethod("parseObjectLiteral");let e=[];try{for(;!this.isPunctuation("}")&&!this.isAtEnd();){if(this.isPunctuation(",")){this.advance();continue}let t=null,s=!1;if(this.isPunctuation("["))this.advance(),t=this.parseExpression(),this.consume(o.PUNCTUATION,"Expected ]");else if(this.check(o.IDENTIFIER)){let n=this.advance();t=new m(n.value),(this.isPunctuation(",")||this.isPunctuation("}"))&&(s=!0)}else if(this.check(o.STRING)){let n=this.advance();t=new f(n.value,n.value,"string")}else{this.advance();continue}let i=t;if(!s&&this.isPunctuation(":")){this.advance();try{i=this.parseTernary()}catch(n){for(n.parserError&&this.reportParserError(n.parserError),i=t;!this.isPunctuation(",")&&!this.isPunctuation("}")&&!this.isAtEnd();)this.advance()}}let r=new ye(t,i);r.shorthand=s,e.push(r),this.isPunctuation(",")&&this.advance()}return this.isPunctuation("}")&&this.advance(),this.exitMethod("parseObjectLiteral"),new me(e)}catch(t){throw this.exitMethod("parseObjectLiteral"),t}}parseArguments(){let e=[];for(;!this.isPunctuation(")")&&!this.isAtEnd();){try{e.push(this.parseTernary())}catch{break}if(!this.isPunctuation(","))break;this.advance()}return e}check(e){return this.isAtEnd()?!1:this.peek().type===e}consume(e,t=""){if(this.check(e))return this.advance();throw this.error(t||`Expected ${e}`)}consumeStatementEnd(){this.isPunctuation(";")&&this.advance()}advance(){return this.isAtEnd()||this.current++,this.previous()}peek(){return this.tokens[this.current]}peekAhead(e=1){let t=this.current+e;return t>=this.tokens.length?this.tokens[this.tokens.length-1]:this.tokens[t]}previous(){return this.tokens[this.current-1]}isAtEnd(){return this.peek().type===o.EOF}getLocation(){let e=this.peek();return{line:e.line,column:e.column}}error(e){let t=this.peek(),s=new Error(`Parse error at line ${t.line}, column ${t.column}: ${e}`);return s.parserError={message:`Parse error at line ${t.line}, column ${t.column}: ${e}`,line:t.line,column:t.column,token:{type:t.type,value:t.value},callStack:this.callStack?[...this.callStack]:[]},s}getContext(){let e=Math.max(0,this.current-5),t=Math.min(this.tokens.length,this.current+6);return{before:this.tokens.slice(e,this.current).map(s=>`${s.value}(${s.type})`).join(" "),current:`\u2192 ${this.peek().value}(${this.peek().type}) \u2190`,after:this.tokens.slice(this.current+1,t).map(s=>`${s.value}(${s.type})`).join(" ")}}exitMethod(e){this.callStack||(this.callStack=[]),this.callStack.length>0&&this.callStack[this.callStack.length-1].method===e&&this.callStack.pop()}getTokenContext(){let e=Math.max(0,this.current-5),t=Math.min(this.tokens.length,this.current+6),s=this.tokens.slice(e,this.current).map(r=>`${r.value}`).join(" "),i=this.tokens.slice(this.current+1,t).map(r=>`${r.value}`).join(" ");return{before:s,current:`\u2192 ${this.peek().value} \u2190`,after:i}}synchronize(){for(this.advance();!this.isAtEnd();){if(this.isPunctuation(";")){this.advance();return}if(this.isKeyword("class")||this.isKeyword("function")||this.isKeyword("import"))return;this.advance()}}getErrors(){return this.errors}reportError(e){this.errors.push(e),this.debugMode&&(console.error(`
\u274C PARSER ERROR DETECTED:
`),console.error(`Message: ${e.message}
`),console.error("\u{1F4CD} Token Context:"),console.error(`  Before:  ${e.context.before}`),console.error(`  Current: ${e.context.current}`),console.error(`  After:   ${e.context.after}
`),console.error("\u{1F4DA} Call Stack (where error came from):"),e.callStack.length===0?console.error(`  (top level)
`):(e.callStack.forEach((t,s)=>{let i=s===e.callStack.length-1?"\u2192":" ";console.error(`  ${i} ${s+1}. ${t.method}()`),console.error(`     at token: "${t.token}" (line ${t.line}, col ${t.column})`)}),console.error("")))}};var J=class{constructor(e,t={}){this.ast=e,this.options={strict:!1,...t},this.logger=w().createComponentLogger("WidgetAnalyzer"),this.widgets=new Map,this.functions=new Map,this.imports=[],this.externalDependencies=new Set,this.entryPoint=null,this.rootWidget=null,this.widgetTree=null,this.errors=[]}analyze(){if(this.logger.startSession("WidgetAnalyzer"),!this.ast||!this.ast.body)throw new Error("Invalid AST provided");this.logger.trace("[WidgetAnalyzer] Starting analysis...");try{return this.logger.trace("[WidgetAnalyzer] Phase 1: Extracting classes and functions..."),this.extractClassesAndFunctions(),this.logger.trace(`[WidgetAnalyzer]   Found ${this.widgets.size} classes in total`),this.logger.trace("[WidgetAnalyzer] Phase 2: Detecting widgets..."),this.detectWidgets(),this.logger.trace(`[WidgetAnalyzer]   Detected widgets: ${Array.from(this.widgets.values()).filter(e=>e.type!=="class").length}`),this.logger.trace("[WidgetAnalyzer] Phase 3: Extracting imports..."),this.extractImports(),this.logger.trace(`[WidgetAnalyzer]   Found ${this.imports.length} imports`),this.logger.trace("[WidgetAnalyzer] Phase 4: Finding entry point..."),this.findEntryPoint(),this.logger.trace(`[WidgetAnalyzer]   Entry point: ${this.entryPoint||"NOT FOUND"}`),this.logger.trace("[WidgetAnalyzer] Phase 5: Building widget tree..."),this.buildWidgetTree(),this.logger.trace(`[WidgetAnalyzer]   Tree root: ${this.rootWidget||"NOT FOUND"}`),this.logger.trace(`[WidgetAnalyzer] Analysis complete
`),this.getResults()}catch(e){return this.errors.push({type:"analysis-error",message:e.message,stack:e.stack}),this.getResults()}}extractClassesAndFunctions(){if(this.ast.body)for(let e of this.ast.body)e.type==="ClassDeclaration"?this.extractClassDeclaration(e):e.type==="FunctionDeclaration"&&this.extractFunctionDeclaration(e)}extractClassDeclaration(e){var n,l,a,c;let t=(n=e.id)==null?void 0:n.name;if(!t)return;let s=((l=e.superClass)==null?void 0:l.name)||null,i=e.location,r={name:t,type:"class",location:i,superClass:s,constructor:null,properties:[],methods:[],fieldReferences:{},imports:[],children:[],linkedStateClass:null};if((a=e.body)!=null&&a.fields&&e.body.fields.forEach(u=>{var g;let d=(g=u.key)==null?void 0:g.name,y=u.initialValue?this.expressionToString(u.initialValue):null;r.properties.push({name:d,initialValue:y,type:this.inferFieldType(u.initialValue)}),r.fieldReferences[d]||(r.fieldReferences[d]=[])}),(c=e.body)!=null&&c.methods){let u=e.body.methods.find(d=>{var y;return((y=d.key)==null?void 0:y.name)==="constructor"});u&&(r.constructor={name:"constructor",params:u.params||[],location:u.location}),e.body.methods.forEach(d=>{var y,g;if(((y=d.key)==null?void 0:y.name)!=="constructor"){let C=(g=d.key)==null?void 0:g.name,k={name:C,params:d.params||[],location:d.location,hasBody:d.body!==null,usesFields:[]};if(d.body){let b=this.findFieldReferencesInBody(d.body);k.usesFields=b,b.forEach(R=>{r.fieldReferences[R]&&r.fieldReferences[R].push(C)})}r.methods.push(k)}})}this.widgets.set(t,r),this.logger.trace(`[WidgetAnalyzer]     Extracted class: ${t} extends ${s}`),r.properties.length>0&&this.logger.trace(`[WidgetAnalyzer]       Fields: ${r.properties.map(u=>`${u.name}=${u.initialValue}`).join(", ")}`)}findFieldReferencesInBody(e){let t=[],s=i=>{var r,n;if(i){i.type==="MemberExpression"&&((r=i.object)==null?void 0:r.name)==="this"&&(n=i.property)!=null&&n.name&&t.push(i.property.name);for(let l in i)l!=="location"&&typeof i[l]=="object"&&(Array.isArray(i[l])?i[l].forEach(s):s(i[l]))}};return s(e),[...new Set(t)]}inferFieldType(e){if(!e)return"any";if(e.type==="Literal"){let t=e.value;if(typeof t=="number")return"int"|"double";if(typeof t=="boolean")return"bool";if(typeof t=="string")return"String";if(t===null)return"null"}return e.type==="Identifier"?e.name:e.type==="ArrayExpression"?"List":e.type==="ObjectExpression"?"Map":"dynamic"}extractFunctionDeclaration(e){var r,n;let t=((r=e.id)==null?void 0:r.name)||"anonymous",s=e.location,i={name:t,type:"function",location:s,params:((n=e.params)==null?void 0:n.map(l=>{var a;return{name:((a=l.name)==null?void 0:a.name)||"param",optional:l.optional||!1}}))||[],isAsync:e.isAsync||!1,isEntryPoint:!1};this.functions.set(t,i)}detectWidgets(){this.widgets.forEach(e=>{if(!e.superClass){e.type="class";return}let t=e.superClass;t==="StatelessWidget"?(e.type="stateless",this.logger.trace(`[WidgetAnalyzer]     ${e.name} is StatelessWidget`)):t==="StatefulWidget"?(e.type="stateful",this.logger.trace(`[WidgetAnalyzer]     ${e.name} is StatefulWidget`)):t!=null&&t.startsWith("State")?(e.type="state",this.logger.trace(`[WidgetAnalyzer]     ${e.name} is State class`)):e.type="component"})}extractImports(){this.ast.body&&this.ast.body.forEach(e=>{var t,s;if(e.type==="ImportDeclaration"){let i=(t=e.source)==null?void 0:t.value,r=((s=e.specifiers)==null?void 0:s.map(n=>{var l;return(l=n.imported)==null?void 0:l.name}))||[];this.imports.push({source:i,items:r}),this.externalDependencies.add(i)}})}findEntryPoint(){var e;if(this.functions.has("main")){this.entryPoint="main";let t=this.functions.get("main");t.isEntryPoint=!0;let s=this.ast.body.find(i=>{var r;return i.type==="FunctionDeclaration"&&((r=i.id)==null?void 0:r.name)==="main"});(e=s==null?void 0:s.body)!=null&&e.body&&(this.rootWidget=this.findRunAppWidget(s.body.body))}}findRunAppWidget(e){var t,s,i,r,n,l;for(let a of e){if(a.type==="ExpressionStatement"&&((t=a.expression)==null?void 0:t.type)==="CallExpression"){let c=a.expression;if(((s=c.callee)==null?void 0:s.name)==="runApp"&&((i=c.args)==null?void 0:i.length)>0)return this.getWidgetNameFromExpression(c.args[0])}if(a.type==="ReturnStatement"&&((r=a.argument)==null?void 0:r.type)==="CallExpression"){let c=a.argument;if(((n=c.callee)==null?void 0:n.name)==="runApp"&&((l=c.args)==null?void 0:l.length)>0)return this.getWidgetNameFromExpression(c.args[0])}}return null}getWidgetNameFromExpression(e){var t,s;return e?e.type==="NewExpression"?(t=e.callee)==null?void 0:t.name:e.type==="CallExpression"?(s=e.callee)==null?void 0:s.name:e.type==="Identifier"?e.name:null:null}buildWidgetTree(){if(!this.rootWidget||!this.widgets.has(this.rootWidget))return;let e=this.widgets.get(this.rootWidget);this.widgetTree={widget:e,depth:0,children:[]}}expressionToString(e){if(!e)return null;if(e.type==="Literal")return e.value;if(e.type==="Identifier"){let t=e.name;return t==="true"||t==="false"?t==="true":t==="null"?null:t==="undefined"?void 0:t}}getResults(){let e=Array.from(this.widgets.values()).filter(t=>t.type==="stateless"||t.type==="stateful"||t.type==="state"||t.type==="component");return this.logger.trace(`[WidgetAnalyzer] getResults() returning ${e.length} widgets`),{widgets:e,functions:Array.from(this.functions.values()),imports:this.imports,externalDependencies:Array.from(this.externalDependencies),entryPoint:this.entryPoint,rootWidget:this.rootWidget,widgetTree:this.widgetTree,errors:this.errors}}getSummary(){let e=Array.from(this.widgets.values()),t=e.filter(r=>r.type==="stateless").length,s=e.filter(r=>r.type==="stateful").length,i=e.filter(r=>r.type==="state").length;return{totalWidgets:e.length,statelessWidgets:t,statefulWidgets:s,stateClasses:i,totalFunctions:this.functions.size,totalImports:this.imports.length,externalPackages:this.externalDependencies.size,entryPoint:this.entryPoint,rootWidget:this.rootWidget}}getErrors(){return this.errors}};var Y=class{constructor(e,t,s={}){this.ast=e,this.widgets=t,this.options={strict:!1,...s},this.stateClasses=new Map,this.stateFields=new Map,this.setStateCalls=[],this.lifecycleMethods=[],this.eventHandlers=[],this.dependencyGraph=null,this.validationResults=[],this.errors=[]}analyze(){if(!this.ast||!this.ast.body)throw new Error("Invalid AST provided");try{return this.linkStatefulToState(),this.extractStateFields(),this.findSetStateCalls(),this.extractLifecycleMethods(),this.extractEventHandlers(),this.buildDependencyGraph(),this.validateState(),this.getResults()}catch(e){return this.errors.push(e),this.getResults()}}linkStatefulToState(){this.widgets.forEach(e=>{if(e.type!=="stateful")return;if(!e.methods.find(a=>a.name==="createState")){this.errors.push({type:"missing-create-state",widget:e.name,message:`StatefulWidget "${e.name}" has no createState() method`});return}let s=this.ast.body.find(a=>a.type==="ClassDeclaration"&&a.id.name===e.name);if(!s)return;let i=s.body.methods.find(a=>a.key.name==="createState");if(!i)return;let r=this.extractReturnedClassName(i.body);if(!r){this.errors.push({type:"cannot-parse-create-state",widget:e.name,message:`Cannot determine which State class is returned by ${e.name}.createState()`});return}let n=this.ast.body.find(a=>a.type==="ClassDeclaration"&&a.id.name===r);if(!n){this.errors.push({type:"missing-state-class",widget:e.name,stateClass:r,message:`State class "${r}" not found`});return}if(!n.superClass||!n.superClass.name.startsWith("State")){this.errors.push({type:"invalid-state-class",stateClass:r,message:`Class "${r}" does not extend State`});return}let l=new Se(r,n.location,e.name);this.stateClasses.set(r,{astNode:n,metadata:l}),e.linkedStateClass=r})}extractReturnedClassName(e){if(!e)return null;if(e.type==="BlockStatement"&&e.body){for(let t of e.body)if(t.type==="ReturnStatement"&&t.argument){let s=this.getClassNameFromExpression(t.argument);if(s)return s}}return e.type==="NewExpression"?e.callee.name:null}getClassNameFromExpression(e){return e?e.type==="NewExpression"&&e.callee?e.callee.name:e.type==="Identifier"?e.name:e.type==="CallExpression"&&e.callee&&e.callee.type==="Identifier"?e.callee.name:null:null}extractStateFields(){this.stateClasses.forEach(({astNode:e,metadata:t})=>{!e.body||!e.body.fields||e.body.fields.forEach(s=>{let i=s.key.name,r=s.initialValue,n=this.inferFieldType(r),l=new ve(i,n,this.expressionToValue(r),r?r.location:s.location);this.stateFields.set(`${t.name}.${i}`,l),t.stateFields.push(l)})})}inferFieldType(e){if(!e)return"any";if(e.type==="Literal"){if(typeof e.value=="number")return"number";if(typeof e.value=="string")return"string";if(typeof e.value=="boolean")return"boolean";if(e.value===null)return"null"}if(e.type==="Identifier"){let t=e.name;if(t==="true"||t==="false")return"boolean";if(t==="null")return"null";if(t==="undefined")return"undefined"}return e.type==="ArrayLiteral"?"array":e.type==="ObjectLiteral"?"object":(e.type==="CallExpression","any")}expressionToValue(e){if(e){if(e.type==="Literal")return e.value;if(e.type==="Identifier"){let t=e.name;if(t==="true")return!0;if(t==="false")return!1;if(t==="null")return null;if(t==="undefined")return}}}findSetStateCalls(){this.stateClasses.forEach(({astNode:e,metadata:t})=>{!e.body||!e.body.methods||e.body.methods.forEach(s=>{let i=this.findSetStateInMethod(s,t.name);this.setStateCalls.push(...i)})})}findSetStateInMethod(e,t){let s=[],i=e.key.name;return e.body&&(e.body.type==="BlockStatement"?e.body.body:[e.body]).forEach(n=>{this.findSetStateInStatement(n,s,i,t)}),s}findSetStateInStatement(e,t,s,i){e&&(e.type==="ExpressionStatement"&&e.expression&&this.findSetStateInExpression(e.expression,t,s,i),e.type==="ReturnStatement"&&e.argument&&this.findSetStateInExpression(e.argument,t,s,i),e.type==="BlockStatement"&&e.body&&e.body.forEach(r=>{this.findSetStateInStatement(r,t,s,i)}))}findSetStateInExpression(e,t,s,i){if(e){if(e.type==="CallExpression"){if(this.isSetStateCall(e)){let n=this.extractSetStateUpdates(e,i),l=new we(e.location,s,n,i);t.push(l)}e.args.forEach(n=>{this.findSetStateInExpression(n,t,s,i)})}e.type==="ObjectLiteral"&&e.properties&&e.properties.forEach(r=>{this.findSetStateInExpression(r.value,t,s,i)})}}isSetStateCall(e){if(e.type!=="CallExpression"||!e.callee)return!1;if(e.callee.type==="MemberExpression"){let t=e.callee.object,s=e.callee.property;if(t.type==="Identifier"&&t.name==="this"&&s.type==="Identifier"&&s.name==="setState")return!0}return!1}extractSetStateUpdates(e,t){let s=[];if(!e.args||e.args.length===0)return s;let i=e.args[0];if(i.type==="ArrowFunctionExpression"){let r=i.body;if(r.type==="BlockStatement"&&r.body)r.body.forEach(n=>{let l=this.extractMutatedFields(n,t);s.push(...l)});else if(r.type==="UpdateExpression"||r.type==="AssignmentExpression"){let n=this.extractMutatedFields(r,t);s.push(...n)}}return[...new Set(s)]}extractMutatedFields(e,t){let s=[];if(!e)return s;if(e.type==="ExpressionStatement"&&e.expression){let i=e.expression;if(i.type==="AssignmentExpression"){let r=this.getFieldNameFromTarget(i.left);r&&s.push(r)}if(i.type==="UpdateExpression"){let r=this.getFieldNameFromTarget(i.argument);r&&s.push(r)}}if(e.type==="AssignmentExpression"){let i=this.getFieldNameFromTarget(e.left);i&&s.push(i)}if(e.type==="UpdateExpression"){let i=this.getFieldNameFromTarget(e.argument);i&&s.push(i)}return s}getFieldNameFromTarget(e){if(!e)return null;if(e.type==="MemberExpression"){let t=e.object,s=e.property;if(t.type==="Identifier"&&t.name==="this"&&s.type==="Identifier")return s.name}return e.type==="Identifier"?e.name:null}extractLifecycleMethods(){let e=["initState","dispose","didUpdateWidget","build"];this.stateClasses.forEach(({astNode:t,metadata:s})=>{!t.body||!t.body.methods||t.body.methods.forEach(i=>{let r=i.key.name;if(e.includes(r)){let n=new Ee(r,i.location,i.params||[],this.checkCallsSuper(i),this.checkHasSideEffects(i));this.lifecycleMethods.push(n),s.lifecycleMethods.push(n)}})})}checkCallsSuper(e){if(!e.body)return!1;let t=e.body.type==="BlockStatement"?e.body.body:[e.body];for(let s of t)if(s.type==="ExpressionStatement"&&s.expression){let i=s.expression;if(i.type==="CallExpression"&&i.callee.type==="MemberExpression"){let r=i.callee.object,n=i.callee.property;if(r.type==="Identifier"&&r.name==="super"&&n.type==="Identifier"&&n.name===e.key.name)return!0}}return!1}checkHasSideEffects(e){if(!e.body)return!1;let t=e.body.type==="BlockStatement"?e.body.body:[e.body];for(let s of t)if(s.type==="ExpressionStatement"&&s.expression){let i=s.expression;if(i.type==="AssignmentExpression"||i.type==="UpdateExpression"||i.type==="CallExpression")return!0}return!1}extractEventHandlers(){this.stateClasses.forEach(({astNode:e,metadata:t})=>{if(!e.body||!e.body.methods)return;let s=e.body.methods.find(r=>r.key.name==="build");if(!s)return;let i=this.findEventHandlersInMethod(s,t.name);this.eventHandlers.push(...i)})}findEventHandlersInMethod(e,t){let s=[];return e.body&&(e.body.type==="BlockStatement"?e.body.body:[e.body]).forEach(r=>{this.findEventHandlersInStatement(r,s,t)}),s}findEventHandlersInStatement(e,t,s){e&&(e.type==="ExpressionStatement"&&e.expression&&this.findEventHandlersInExpression(e.expression,t,s),e.type==="ReturnStatement"&&e.argument&&this.findEventHandlersInExpression(e.argument,t,s),e.type==="BlockStatement"&&e.body&&e.body.forEach(i=>{this.findEventHandlersInStatement(i,t,s)}))}findEventHandlersInExpression(e,t,s){e&&(e.type==="ObjectLiteral"&&e.properties&&e.properties.forEach(i=>{let r=this.getPropertyKey(i.key);if(/^on[A-Z]/.test(r)){let l=this.extractEventHandler(i.value,s);l&&t.push({event:r,handler:l,location:i.location,component:this.getComponentNameFromContext(e)})}this.findEventHandlersInExpression(i.value,t,s)}),e.type==="CallExpression"&&e.args&&e.args.forEach(i=>{this.findEventHandlersInExpression(i,t,s)}),e.type==="NewExpression"&&e.args&&e.args.forEach(i=>{this.findEventHandlersInExpression(i,t,s)}))}getPropertyKey(e){return e?e.type==="Identifier"?e.name:e.type==="Literal"?String(e.value):null:null}extractEventHandler(e,t){if(!e)return null;if(e.type==="ArrowFunctionExpression"){if(e.body.type==="CallExpression")return this.getClassNameFromExpression(e.body.callee);if(e.body.type==="Identifier")return e.body.name}return e.type==="Identifier"?e.name:e.type==="MemberExpression"&&e.property.type==="Identifier"?e.property.name:null}getComponentNameFromContext(e){return e.type==="CallExpression"&&e.callee?this.getClassNameFromExpression(e.callee):"Unknown"}buildDependencyGraph(){this.dependencyGraph=new Ce,this.stateFields.forEach((e,t)=>{let s=this.findMethodsUsingField(e.name);s.length>0&&this.dependencyGraph.stateToMethods.set(e.name,s)}),this.stateClasses.forEach(({metadata:e})=>{e.stateFields.forEach(t=>{let s=this.findMethodsReadingField(e.name,t.name);s.length>0&&this.dependencyGraph.methodToState.set(t.name,s)})}),this.eventHandlers.forEach(e=>{let t=this.findStateChangedByMethod(e.handler);t.length>0&&this.dependencyGraph.eventToState.set(e.event,t)})}findMethodsUsingField(e){let t=new Set;return this.setStateCalls.forEach(s=>{s.updates.includes(e)&&t.add(s.method)}),this.stateClasses.forEach(({astNode:s,metadata:i})=>{if(!s.body||!s.body.methods)return;let r=s.body.methods.find(n=>n.key.name==="build");r&&this.methodUsesField(r,e)&&t.add("build")}),Array.from(t)}methodUsesField(e,t){if(!e.body)return!1;let s=e.body.type==="BlockStatement"?e.body.body:[e.body];for(let i of s)if(this.statementUsesField(i,t))return!0;return!1}statementUsesField(e,t){return e?JSON.stringify(e).includes(t):!1}findMethodsReadingField(e,t){let s=[];return this.stateClasses.forEach(({metadata:i})=>{i.name===e&&i.stateFields.forEach(r=>{r.name===t&&s.push(...r.usedInMethods)})}),s}findStateChangedByMethod(e){let t=new Set;return this.setStateCalls.forEach(s=>{s.method===e&&s.updates.forEach(i=>t.add(i))}),Array.from(t)}validateState(){this.validateSetStatePatterns(),this.validateStateFieldUsage(),this.validateLifecyclePatterns(),this.validateEventHandlers()}validateSetStatePatterns(){this.setStateCalls.forEach(e=>{let t=[];this.stateClasses.get(e.stateClassName)||t.push({type:"invalid-context",message:`setState called outside of ${e.stateClassName}`}),e.updates.length===0&&t.push({type:"empty-update",message:"setState called with no state updates",severity:"warning"}),e.updates.forEach(i=>{this.stateFields.has(`${e.stateClassName}.${i}`)||t.push({type:"unknown-field",message:`setState updates unknown field "${i}"`,field:i})}),e.isValid=t.length===0,e.issues=t})}validateStateFieldUsage(){this.stateFields.forEach((e,t)=>{let s=t.split("."),i=s[0],r=s[1];this.fieldIsUsed(r,i)||this.validationResults.push({type:"unused-state-field",severity:"warning",field:r,location:e.location,message:`State field "${r}" is defined but never used`,suggestion:"Remove unused field or implement its usage"});let n=this.findMutationsOutsideSetState(r,i);n.length>0&&this.validationResults.push({type:"mutation-outside-setstate",severity:"error",field:r,locations:n,message:`State field "${r}" is mutated outside setState()`,suggestion:"Always use setState() to update state fields"})})}fieldIsUsed(e,t){let s=this.stateClasses.get(t);if(!s)return!1;let i=s.astNode.body.methods.find(r=>r.key.name==="build");return i&&this.methodUsesField(i,e)?!0:this.setStateCalls.some(r=>r.updates.includes(e))}findMutationsOutsideSetState(e,t){let s=[],i=new Set;return this.setStateCalls.forEach(r=>{r.updates.forEach(n=>{i.add(n)})}),i.has(e),s}validateLifecyclePatterns(){this.stateClasses.forEach(({metadata:e})=>{let t={};e.lifecycleMethods.forEach(s=>{t[s.name]=s}),t.dispose&&!t.dispose.callsSuper&&this.validationResults.push({type:"lifecycle-issue",severity:"error",method:"dispose",location:t.dispose.location,message:"dispose() should call super.dispose()",suggestion:"Add super.dispose() call at the end of dispose()"}),t.initState&&!t.initState.callsSuper&&this.validationResults.push({type:"lifecycle-issue",severity:"warning",method:"initState",location:t.initState.location,message:"initState() should call super.initState()",suggestion:"Add super.initState() call"})})}validateEventHandlers(){this.eventHandlers.forEach(e=>{!this.stateClasses.values().some(s=>s.metadata.stateFields.some(i=>i.name===e.handler)||s.astNode.body.methods.some(i=>i.key.name===e.handler))&&e.handler&&this.validationResults.push({type:"missing-handler",severity:"error",handler:e.handler,event:e.event,location:e.location,message:`Event handler "${e.handler}" not found`,suggestion:`Create a method called ${e.handler} in the State class`})})}getResults(){return{stateClasses:Array.from(this.stateClasses.entries()).map(([e,t])=>({name:e,metadata:t.metadata})),stateFields:Array.from(this.stateFields.values()),setStateCalls:this.setStateCalls,lifecycleMethods:this.lifecycleMethods,eventHandlers:this.eventHandlers,dependencyGraph:this.dependencyGraph,validationResults:this.validationResults,errors:this.errors}}},Se=class{constructor(e,t,s){this.name=e,this.location=t,this.linkedStatefulWidget=s,this.stateFields=[],this.lifecycleMethods=[],this.methods=[]}},ve=class{constructor(e,t,s,i){this.name=e,this.type=t,this.initialValue=s,this.location=i,this.isMutable=!0,this.mutations=[],this.usedInMethods=[],this.usedInBuild=!1}},Ee=class{constructor(e,t,s,i,r){this.name=e,this.location=t,this.params=s,this.callsSuper=i,this.hasSideEffects=r}},we=class{constructor(e,t,s,i){this.location=e,this.method=t,this.updates=s||[],this.stateClassName=i,this.isValid=!0,this.issues=[]}},Ce=class{constructor(){this.stateToMethods=new Map,this.methodToState=new Map,this.eventToState=new Map}};var Q=class{constructor(e,t,s="InheritedWidget"){this.name=e,this.location=t,this.superClass=s,this.properties=[],this.staticAccessors=[],this.methods=[],this.updateShouldNotifyImplemented=!1,this.hasChildProperty=!1,this.usageCount=0,this.usedIn=[],this.providedByWidgets=[]}addProperty(e,t,s=!1){this.properties.push({name:e,type:t,required:s,description:null}),e==="child"&&(this.hasChildProperty=!0)}addStaticAccessor(e,t,s,i=!0){this.staticAccessors.push({name:e,signature:t,usesInheritedWidgetLookup:i,location:s})}recordUsage(e){this.usedIn.includes(e)||(this.usedIn.push(e),this.usageCount++)}recordProvider(e){this.providedByWidgets.includes(e)||this.providedByWidgets.push(e)}validate(){let e=[];return this.hasChildProperty||e.push({type:"missing-child-property",severity:"warning",message:`InheritedWidget "${this.name}" should have a 'child' property`}),this.staticAccessors.length===0&&e.push({type:"missing-static-accessor",severity:"warning",message:`InheritedWidget "${this.name}" should have a static of() method`}),this.updateShouldNotifyImplemented||e.push({type:"missing-update-notification",severity:"error",message:`InheritedWidget "${this.name}" must implement updateShouldNotify()`}),e}summary(){return{name:this.name,superClass:this.superClass,properties:this.properties.length,staticAccessors:this.staticAccessors.length,usageCount:this.usageCount,usedIn:this.usedIn,providedBy:this.providedByWidgets,isValid:this.updateShouldNotifyImplemented}}},_=class{constructor(e,t){this.name=e,this.location=t,this.type="ChangeNotifier",this.properties=[],this.getters=[],this.methods=[],this.setters=[],this.isUsedWithProvider=!1,this.providedType=null,this.consumers=[],this.subscriptions=[]}addProperty(e,t,s=null){this.properties.push({name:e,type:t,initialValue:s,mutable:!0})}addGetter(e,t,s){this.getters.push({name:e,returnType:t,location:s,isComputed:!1})}addMethod(e,t,s=!1,i=[]){this.methods.push({name:e,location:t,callsNotifyListeners:s,mutatesFields:i,isAsync:!1,parameters:[]})}recordConsumer(e,t="watch"){this.consumers.includes(e)||this.consumers.push(e),this.subscriptions.push({consumer:e,accessPattern:t,timestamp:new Date})}validate(){let e=[];return!this.methods.some(s=>s.callsNotifyListeners)&&this.methods.length>0&&e.push({type:"missing-notify-listeners",severity:"warning",message:`ChangeNotifier "${this.name}" has methods but none call notifyListeners()`}),this.methods.forEach(s=>{s.mutatesFields.length>0&&!s.callsNotifyListeners&&e.push({type:"mutation-without-notification",severity:"warning",message:`Method "${s.name}" mutates state but doesn't call notifyListeners()`})}),this.properties.length>0&&this.getters.length===0&&e.push({type:"missing-getters",severity:"info",message:`ChangeNotifier "${this.name}" has properties but no getters. Consider adding getters for encapsulation.`}),e}summary(){return{name:this.name,properties:this.properties.length,getters:this.getters.length,methods:this.methods.length,consumers:this.consumers.length,consumedBy:this.consumers,isValid:this.methods.some(e=>e.callsNotifyListeners)}}},Z=class{constructor(e,t,s){this.providerType=e,this.location=t,this.valueType=s,this.createFunction=null,this.lazy=!0,this.dispose=null,this.child=null,this.consumers=[],this.accessPatterns=[],this.flowPath=null}setCreateFunction(e){this.createFunction=e}setDispose(e){this.dispose=e}addConsumer(e){this.consumers.includes(e)||this.consumers.push(e)}addAccessPattern(e){this.accessPatterns.includes(e)||this.accessPatterns.push(e)}validate(){let e=[];return this.createFunction||e.push({type:"missing-create",severity:"error",message:`Provider<${this.valueType}> must have a create function`}),this.consumers.length===0&&e.push({type:"unused-provider",severity:"info",message:`Provider<${this.valueType}> is defined but not consumed by any widget`}),this.accessPatterns.includes("watch")&&!this.accessPatterns.includes("read")&&e.push({type:"watch-without-read",severity:"info",message:"Provider uses context.watch() but not context.read(). Consider both patterns."}),e}summary(){return{type:this.providerType,valueType:this.valueType,consumers:this.consumers.length,consumedBy:this.consumers,accessPatterns:this.accessPatterns,hasCreateFunction:!!this.createFunction,hasDisposeFunction:!!this.dispose}}};var P=class{constructor(e,t,s,i="T",r=!0,n=""){this.pattern=e,this.type=t,this.location=s,this.returns=i,this.ssrSafe=r,this.reason=n,this.depth=0,this.frequency=1}explain(){return this.ssrSafe?`\u2713 SSR Safe: ${this.reason}`:`\u2717 SSR Unsafe: ${this.reason}`}getMigrationAdvice(){return this.ssrSafe?null:{"provider-watch":"Replace with context.read() for initial SSR render, use watch() in didChangeDependencies() on client","global-state-mutation":"Move mutations to client-only code, wrap in if (!kIsWeb) or similar server check","event-handler":"Event handlers don't exist during SSR, only attach after hydration on client"}[this.type]||null}summary(){return{pattern:this.pattern,type:this.type,returns:this.returns,ssrSafe:this.ssrSafe,reason:this.reason,advice:this.getMigrationAdvice()}}},$=class{constructor(e,t,s=0){this.dependency=e,this.reason=t,this.order=s,this.requiredProviders=[],this.requiredState=[]}requiresProvider(e){this.requiredProviders.includes(e)||this.requiredProviders.push(e)}requiresState(e){this.requiredState.includes(e)||this.requiredState.push(e)}summary(){return{dependency:this.dependency,reason:this.reason,order:this.order,requiredProviders:this.requiredProviders,requiredState:this.requiredState}}},j=class{constructor(e,t,s="unknown",i="widget"){this.target=e,this.reason=t,this.estimatedSize=s,this.type=i,this.recommendation=null,this.priority="medium"}setRecommendation(e){this.recommendation=e}calculatePriority(e){e>50?this.priority="high":e>20?this.priority="medium":this.priority="low"}summary(){return{target:this.target,type:this.type,reason:this.reason,estimatedSize:this.estimatedSize,priority:this.priority,recommendation:this.recommendation}}};var X=class{constructor(e,t=[],s={}){this.ast=e,this.widgets=t,this.logger=w().createComponentLogger("ContextAnalyzer"),this.options={strict:!1,...s},this.inheritedWidgets=new Map,this.changeNotifiers=new Map,this.providers=new Map,this.contextAccessPoints=[],this.inheritedWidgetGraph={},this.providerGraph={},this.errors=[]}analyze(){this.logger.startSession("ContextAnalysis"),this.logger.trace(`[ContextAnalyzer] Starting analysis...
`),this.logger.startSession("WidgetAnalyzer"),this.logger.trace(`[ContextAnalyzer] Starting analysis...
`);try{return this.detectInheritedWidgets(),this.logger.trace(`[ContextAnalyzer] Found ${this.inheritedWidgets.size} InheritedWidgets
`),this.detectChangeNotifiers(),this.logger.trace(`[ContextAnalyzer] Found ${this.changeNotifiers.size} ChangeNotifiers
`),this.detectProviders(),this.logger.trace(`[ContextAnalyzer] Found ${this.providers.size} Providers
`),this.findContextAccessPoints(),this.logger.trace(`[ContextAnalyzer] Found ${this.contextAccessPoints.length} context usage points
`),this.buildInheritedWidgetGraph(),this.buildProviderGraph(),this.logger.trace(`[ContextAnalyzer] Built dependency graphs
`),this.getResults()}catch(e){return this.errors.push(e),console.error("[ContextAnalyzer] Error:",e.message),this.getResults()}}detectInheritedWidgets(){!this.ast||!this.ast.body||this.ast.body.forEach(e=>{var r,n,l,a;if(e.type!=="ClassDeclaration")return;let t=(r=e.id)==null?void 0:r.name,s=(n=e.superClass)==null?void 0:n.name;if(!s||!s.includes("InheritedWidget"))return;this.logger.trace(`[ContextAnalyzer.detectInheritedWidgets] Found: ${t}`);let i=new Q(t,e.location,s);(l=e.body)!=null&&l.fields&&e.body.fields.forEach(c=>{var d;let u=(d=c.key)==null?void 0:d.name;i.properties.push({name:u,type:this.inferType(c.initialValue),required:!this.hasDefaultValue(c)})}),(a=e.body)!=null&&a.methods&&e.body.methods.forEach(c=>{var d;let u=(d=c.key)==null?void 0:d.name;u==="of"&&this.isStaticAccessor(c)&&i.staticAccessors.push({name:u,signature:`static ${u}(BuildContext context)`,usesInheritedWidgetLookup:this.checksInheritedWidgetLookup(c),location:c.location}),u==="updateShouldNotify"&&(i.updateShouldNotifyImplemented=!0)}),this.inheritedWidgets.set(t,i)})}isStaticAccessor(e){var t;return((t=e.key)==null?void 0:t.name)==="of"}checksInheritedWidgetLookup(e){if(!e.body)return!1;let t=JSON.stringify(e.body);return t.includes("dependOnInheritedWidgetOfExactType")||t.includes("inheritedWidgetOfExactType")}detectChangeNotifiers(){!this.ast||!this.ast.body||this.ast.body.forEach(e=>{var r,n,l,a;if(e.type!=="ClassDeclaration")return;let t=(r=e.id)==null?void 0:r.name,s=(n=e.superClass)==null?void 0:n.name;if(!s||s!=="ChangeNotifier")return;this.logger.trace(`[ContextAnalyzer.detectChangeNotifiers] Found: ${t}`);let i=new _(t,e.location);(l=e.body)!=null&&l.fields&&e.body.fields.forEach(c=>{var d;let u=(d=c.key)==null?void 0:d.name;i.properties.push({name:u,type:this.inferType(c.initialValue),initialValue:this.expressionToString(c.initialValue)})}),(a=e.body)!=null&&a.methods&&e.body.methods.forEach(c=>{var y,g;let u=(y=c.key)==null?void 0:y.name;u&&!((g=c.params)!=null&&g.length)&&c.body&&JSON.stringify(c).includes("return")&&i.getters.push({name:u,returnType:this.inferReturnType(c.body),location:c.location});let d=this.callsNotifyListeners(c.body);if(d||u==="increment"||u==="decrement"){let C=this.extractMutationsInMethod(c.body);i.methods.push({name:u,callsNotifyListeners:d,location:c.location,mutations:C})}}),this.changeNotifiers.set(t,i)})}callsNotifyListeners(e){return e?JSON.stringify(e).includes("notifyListeners"):!1}extractMutationsInMethod(e){let t=[];if(!e)return t;let s=JSON.stringify(e);return[/this\._(\w+)\s*[=+\-*]/g,/this\.(\w+)\s*[=+\-*]/g].forEach(r=>{let n;for(;(n=r.exec(s))!==null;)t.push(n[1])}),[...new Set(t)]}detectProviders(){!this.ast||!this.ast.body||this.ast.body.forEach(e=>{var t,s;if(e.type==="ClassDeclaration"){let i=(s=(t=e.body)==null?void 0:t.methods)==null?void 0:s.find(r=>{var n;return((n=r.key)==null?void 0:n.name)==="build"});i&&this.findProvidersInMethod(i,e)}e.type==="FunctionDeclaration"&&this.findProvidersInMethod(e,null)})}findProvidersInMethod(e,t){if(!e.body)return;(e.body.type==="BlockStatement"?e.body.body:[e.body]).forEach(i=>{this.findProvidersInStatement(i)})}findProvidersInStatement(e){e&&(e.type==="ExpressionStatement"&&e.expression&&this.findProvidersInExpression(e.expression),e.type==="ReturnStatement"&&e.argument&&this.findProvidersInExpression(e.argument),e.type==="BlockStatement"&&e.body&&e.body.forEach(t=>this.findProvidersInStatement(t)))}findProvidersInExpression(e){var t;if(e){if(e.type==="NewExpression"){let s=(t=e.callee)==null?void 0:t.name;if(s==="Provider"||s!=null&&s.startsWith("Provider")){let i=this.extractGenericType(e);if(i){this.logger.trace(`[ContextAnalyzer.detectProviders] Found Provider<${i}>`);let r=new Z(`Provider<${i}>`,e.location,i);e.args&&e.args.forEach(n=>{var l;n.type==="ObjectLiteral"&&((l=n.properties)==null||l.forEach(a=>{var c,u;((c=a.key)==null?void 0:c.name)==="create"&&(r.createFunction=this.expressionToString(a.value)),(u=a.key)==null||u.name}))}),this.identifyAccessPatterns(i,r),this.providers.set(`Provider<${i}>`,r)}}}e.type==="CallExpression"&&e.args&&e.args.forEach(s=>{this.findProvidersInExpression(s)}),e.type==="ObjectLiteral"&&e.properties&&e.properties.forEach(s=>{this.findProvidersInExpression(s.value)})}}extractGenericType(e){if(JSON.stringify(e.callee).includes("Provider")){let i=this.expressionToString(e.callee).match(/Provider<(\w+)>/);return i?i[1]:null}return null}identifyAccessPatterns(e,t){!this.ast||!this.ast.body||this.ast.body.forEach(s=>{var i,r;if(s.type==="ClassDeclaration"){let n=(r=(i=s.body)==null?void 0:i.methods)==null?void 0:r.find(l=>{var a;return((a=l.key)==null?void 0:a.name)==="build"});n&&this.scanForAccessPatterns(n,e,t)}})}scanForAccessPatterns(e,t,s){if(!e.body)return;let i=JSON.stringify(e.body);i.includes("context.watch")&&s.accessPatterns.push("watch"),i.includes("context.read")&&s.accessPatterns.push("read"),i.includes("context.select")&&s.accessPatterns.push("select"),i.includes("Consumer")&&s.accessPatterns.push("Consumer")}findContextAccessPoints(){!this.ast||!this.ast.body||this.ast.body.forEach(e=>{var i,r,n;if(e.type!=="ClassDeclaration")return;let t=(i=e.id)==null?void 0:i.name,s=(n=(r=e.body)==null?void 0:r.methods)==null?void 0:n.find(l=>{var a;return((a=l.key)==null?void 0:a.name)==="build"});if(s){let l=this.extractContextUsageInMethod(s,t);this.contextAccessPoints.push(...l)}})}extractContextUsageInMethod(e,t){let s=[];return e.body&&(e.body.type==="BlockStatement"?e.body.body:[e.body]).forEach(r=>{let n=this.findContextUsageInStatement(r,t);s.push(...n)}),s}findContextUsageInStatement(e,t){let s=[];if(!e)return s;if(e.type==="ExpressionStatement"&&e.expression){let i=this.findContextUsageInExpression(e.expression,t);s.push(...i)}if(e.type==="ReturnStatement"&&e.argument){let i=this.findContextUsageInExpression(e.argument,t);s.push(...i)}return e.type==="BlockStatement"&&e.body&&e.body.forEach(i=>{let r=this.findContextUsageInStatement(i,t);s.push(...r)}),s}findContextUsageInExpression(e,t){let s=[];if(!e)return s;let i=JSON.stringify(e);if(i.includes("Theme.of")&&i.includes("context")&&s.push(new P("Theme.of(context)","inherited-widget-lookup",e.location,"ThemeData",!0,"Pure value access, no subscription required")),i.includes("context.theme")&&s.push(new P("context.theme()","context-service",e.location,"ThemeData",!0,"Service access during build")),i.includes("context.watch")&&s.push(new P("context.watch<T>()","provider-watch",e.location,"T",!1,"Requires reactive subscription - not SSR safe")),i.includes("context.read")&&s.push(new P("context.read<T>()","provider-read",e.location,"T",!0,"Single read at render time - SSR safe")),(i.includes("context.mediaQuery")||i.includes("MediaQuery.of"))&&s.push(new P("context.mediaQuery()","context-service",e.location,"MediaQueryData",!0,"Read-only responsive info")),(i.includes("notifyListeners")||i.includes("increment"))&&s.push(new P("notifyListeners()","global-state-mutation",e.location,"void",!1,"Mutations do not trigger re-render in SSR")),e.type==="CallExpression"&&e.args&&e.args.forEach(r=>{let n=this.findContextUsageInExpression(r,t);s.push(...n)}),e.type==="ObjectLiteral"&&e.properties&&e.properties.forEach(r=>{let n=this.findContextUsageInExpression(r.value,t);s.push(...n)}),e.type==="MemberExpression"){let r=this.findContextUsageInExpression(e.object,t);s.push(...r)}return s}buildInheritedWidgetGraph(){this.inheritedWidgets.forEach(e=>{var t;this.inheritedWidgetGraph[e.name]={providedBy:this.findWhoProvides(e.name),consumedBy:this.findWhoConsumes(e.name),providedValue:((t=e.properties[0])==null?void 0:t.type)||"unknown",flowPath:this.traceContextFlow(e.name)}})}buildProviderGraph(){this.providers.forEach(e=>{let t=e.providerType;this.providerGraph[t]={providedBy:this.findWhoCreatesProvider(e.providerType),providedType:e.valueType,consumedBy:this.findWhoConsumesProvider(e.providerType),accessPatterns:e.accessPatterns,flowPath:this.traceProviderFlow(e.providerType)}})}findWhoProvides(e){return"MyApp"}findWhoConsumes(e){let t=[];return this.contextAccessPoints.forEach(s=>{s.pattern.includes(e)&&t.push(s.dependent)}),t}traceContextFlow(e){return`${this.findWhoProvides(e)} -> ${e} -> ${this.findWhoConsumes(e).join(", ")}`}findWhoCreatesProvider(e){return"MyApp"}findWhoConsumesProvider(e){let t=[];return this.contextAccessPoints.forEach(s=>{(s.pattern.includes("watch")||s.pattern.includes("read"))&&t.push(s.dependent)}),t}traceProviderFlow(e){return"MyApp -> Provider -> MaterialApp -> [consumers]"}inferType(e){if(!e)return"any";if(e.type==="Literal"){let t=e.value;if(typeof t=="string")return"string";if(typeof t=="number")return"number";if(typeof t=="boolean")return"boolean"}return"any"}inferReturnType(e){return"any"}hasDefaultValue(e){return e.initialValue!==null&&e.initialValue!==void 0}expressionToString(e){return e?e.type==="Identifier"?e.name:e.type==="Literal"?String(e.value):JSON.stringify(e).substring(0,50):"null"}getResults(){return{inheritedWidgets:Array.from(this.inheritedWidgets.values()),changeNotifiers:Array.from(this.changeNotifiers.values()),providers:Array.from(this.providers.values()),contextAccessPoints:this.contextAccessPoints,inheritedWidgetGraph:this.inheritedWidgetGraph,providerGraph:this.providerGraph,errors:this.errors}}};var ee=class{constructor(e,t=null,s={}){this.contextResults=e,this.stateResults=t,this.options={strict:!1,targetPlatform:"node",...s},this.logger=w().createComponentLogger("SSRAnalyzer"),this.ssrSafePatterns=[],this.ssrUnsafePatterns=[],this.hydrationRequirements=[],this.lazyLoadOpportunities=[],this.ssrMigrationPath=[],this.validationIssues=[],this.ssrCompatibilityScore=0,this.hydrationCount=0,this.errors=[]}analyze(){this.logger.startSession("SSRAnalysis"),this.logger.info("Starting SSR compatibility analysis");try{return this.detectSsrSafePatterns(),this.logger.count("SSR-safe patterns found",this.ssrSafePatterns.length),this.detectSsrUnsafePatterns(),this.logger.count("SSR-unsafe patterns found",this.ssrUnsafePatterns.length),this.identifyHydrationNeeds(),this.logger.count("Hydration dependencies",this.hydrationRequirements.length),this.detectLazyLoadOpportunities(),this.logger.count("Lazy load opportunities",this.lazyLoadOpportunities.length),this.generateMigrationPath(),this.logger.count("Migration steps",this.ssrMigrationPath.length),this.validateSsrRequirements(),this.calculateCompatibilityScore(),this.logger.count("SSR Compatibility Score",this.ssrCompatibilityScore),this.logger.success("SSR analysis complete"),this.logger.endSession("SSRAnalysis"),this.getResults()}catch(e){return this.logger.failure("SSR analysis failed",e.message),this.errors.push(e),this.logger.endSession("SSRAnalysis"),this.getResults()}}detectSsrSafePatterns(){let e=[];e.push({pattern:"InheritedWidget static accessors",example:"ThemeProvider.of(context)",safeFor:"SSR",why:"Pure value access, no subscription required",confidence:1,category:"context-access",frequency:0}),e.push({pattern:"context.read<T>() in build()",example:"context.read<CounterNotifier>()",safeFor:"SSR",why:"Single read at render time, no re-subscription needed",confidence:.95,category:"provider-access",frequency:0}),e.push({pattern:"Theme data access",example:"theme.primaryColor",safeFor:"SSR",why:"Read-only during rendering",confidence:1,category:"value-access",frequency:0}),e.push({pattern:"MediaQuery.of() for responsive layout",example:"MediaQuery.of(context).size.width",safeFor:"SSR",why:"Server can set default viewport; client hydrates with actual size",confidence:.85,category:"responsive-design",frequency:0}),e.push({pattern:"Async data in FutureBuilder (with cached data)",example:"FutureBuilder with pre-fetched data",safeFor:"SSR",why:"Server can execute async, pass pre-rendered HTML to client",confidence:.8,category:"async-operation",frequency:0}),this.contextResults&&this.contextResults.contextAccessPoints&&this.contextResults.contextAccessPoints.forEach(t=>{if(t.ssrSafe){let s=e.find(i=>i.example.includes(t.pattern.split("(")[0]));s&&s.frequency++,this.ssrSafePatterns.push({pattern:t.pattern,type:t.type,location:t.location,example:t.pattern,why:t.reason,confidence:.95})}}),this.ssrSafePatterns.push(...e)}detectSsrUnsafePatterns(){let e=[{pattern:"context.watch<T>() subscriptions",example:"context.watch<CounterNotifier>()",unsafeFor:"SSR",why:"Requires reactive subscription & listeners on client, not available during server render",confidence:1,category:"provider-subscription",severity:"error",frequency:0},{pattern:"State mutations in event handlers",example:"counter.increment() in onPressed",unsafeFor:"SSR",why:"Event handlers don't exist on server, mutations have no effect",confidence:1,category:"state-mutation",severity:"error",frequency:0},{pattern:"ChangeNotifier.notifyListeners() calls",example:"notifyListeners() in method",unsafeFor:"SSR",why:"Listeners don't exist during initial SSR render",confidence:.95,category:"notification",severity:"error",frequency:0},{pattern:"Browser APIs",example:"window.localStorage, document.getElementById()",unsafeFor:"SSR",why:"window and document objects don't exist on Node.js server",confidence:1,category:"browser-api",severity:"critical",frequency:0},{pattern:"Timers and intervals",example:"setTimeout, setInterval, setImmediate",unsafeFor:"SSR",why:"Can cause unexpected behavior and performance issues during server render",confidence:.9,category:"async-operation",severity:"warning",frequency:0},{pattern:"Random values without seeding",example:"Math.random()",unsafeFor:"SSR",why:"Different values on server vs client cause hydration mismatch",confidence:.99,category:"determinism",severity:"error",frequency:0},{pattern:"Navigator and route access",example:"Navigator.of(context).push()",unsafeFor:"SSR",why:"Navigation happens on client, not on server",confidence:1,category:"navigation",severity:"warning",frequency:0},{pattern:"GestureDetector and event handlers",example:"GestureDetector, onTap, onLongPress",unsafeFor:"SSR",why:"User interactions don't exist on server",confidence:1,category:"user-interaction",severity:"warning",frequency:0},{pattern:"setState in initState or build",example:"this.setState(() => {...}) in build()",unsafeFor:"SSR",why:"Triggers re-render during render cycle, can cause infinite loops",confidence:.95,category:"state-management",severity:"critical",frequency:0}];this.contextResults&&this.contextResults.contextAccessPoints&&this.contextResults.contextAccessPoints.forEach(t=>{var s;if(!t.ssrSafe){let i=e.find(r=>r.example.includes(t.pattern.split("(")[0]));i&&i.frequency++,this.ssrUnsafePatterns.push({pattern:t.pattern,type:t.type,location:t.location,example:t.pattern,why:t.reason,confidence:.95,severity:"error",suggestion:((s=t.getMigrationAdvice)==null?void 0:s.call(t))||"Refactor to SSR-safe pattern"})}}),this.ssrUnsafePatterns.push(...e)}identifyHydrationNeeds(){let e=[];this.contextResults&&this.contextResults.changeNotifiers&&this.contextResults.changeNotifiers.forEach(t=>{if(t.consumers&&t.consumers.length>0){let s=new $(t.name,`State needs to be re-created and listeners re-attached post-hydration for ${t.consumers.length} consumer(s)`,0);t.consumers.forEach(i=>{s.requiredState.push(`${i}.state`)}),e.push(s),this.hydrationCount++}}),this.contextResults&&this.contextResults.providers&&this.contextResults.providers.forEach(t=>{if(t.accessPatterns&&t.accessPatterns.includes("watch")){let s=new $(`Provider<${t.valueType}>`,"context.watch() subscriptions need to be re-established on client for reactive updates",1);s.requiresProvider(t.providerType),e.push(s),this.hydrationCount++}}),this.stateResults&&this.stateResults.eventHandlers&&this.stateResults.eventHandlers.forEach(t=>{if(!e.some(s=>s.dependency===t.handler)){let s=new $(t.handler,`Event handler "${t.handler}" must be attached to DOM after hydration`,2);e.push(s),this.hydrationCount++}}),e.sort((t,s)=>t.order-s.order),this.hydrationRequirements=e}detectLazyLoadOpportunities(){let e=[];this.contextResults&&this.contextResults.inheritedWidgets&&this.contextResults.inheritedWidgets.forEach(t=>{if(t.usageCount===0||t.usageCount&&t.usageCount<=1){let s=new j(t.name,`${t.name} is not needed until user navigates to it`,"15KB","widget");s.setRecommendation("Use LazyRoute or dynamic import: import(widgetPath)"),s.calculatePriority(15),e.push(s)}}),this.contextResults&&this.contextResults.changeNotifiers&&this.contextResults.changeNotifiers.forEach(t=>{if(t.methods&&t.methods.length>10){let s=new j(t.name,`${t.name} is complex and only needed if feature is used`,"8KB","notifier");s.setRecommendation("Lazy create in Provider: create: (context) => Provider.lazy(() => import(...))"),s.calculatePriority(8),e.push(s)}}),this.lazyLoadOpportunities=e}generateMigrationPath(){let e=[],t=this.ssrUnsafePatterns.filter(r=>{var n;return(n=r.pattern)==null?void 0:n.includes("watch")});t.length>0&&e.push({step:1,action:"Replace context.watch() with context.read() for SSR",locations:t.map(r=>r.location),description:`Found ${t.length} context.watch() calls that need refactoring`,example:`
// Before (not SSR safe):
final counter = context.watch<CounterNotifier>();

// After (SSR safe):
final counter = context.read<CounterNotifier>();
// Subscribe to changes in didChangeDependencies() instead (client-only)`,effort:"medium",priority:"high",files:t.length});let s=this.ssrUnsafePatterns.filter(r=>{var n;return(n=r.pattern)==null?void 0:n.includes("mutation")});s.length>0&&e.push({step:2,action:"Move notifyListeners() calls to client-only code",locations:s.map(r=>r.location),description:`Found ${s.length} state mutations that don't work in SSR`,example:`
// Before (not SSR safe):
counter.increment();

// After (SSR safe):
if (kIsWeb) {  // Only on client
  counter.increment();
}`,effort:"low",priority:"high",files:s.length}),this.hydrationRequirements.length>0&&e.push({step:3,action:"Create hydration layer to re-subscribe listeners post-render",description:`App requires hydration for ${this.hydrationRequirements.length} dependencies`,example:`
// In main.js or app.dart after runApp():
if (kIsWeb) {
  // Re-create listeners, reattach subscriptions
  hydrate(flutterApp);
}`,effort:"high",priority:"critical",dependencies:this.hydrationRequirements.length});let i=this.ssrUnsafePatterns.filter(r=>r.category==="browser-api");i.length>0&&e.push({step:4,action:"Wrap browser-specific APIs in kIsWeb checks",description:`Found ${i.length} browser API calls`,example:`
// Before:
final stored = window.localStorage.getItem('key');

// After:
final stored = kIsWeb ? window.localStorage.getItem('key') : null;`,effort:"low",priority:"medium",files:i.length}),this.lazyLoadOpportunities.length>0&&e.push({step:5,action:"Implement code splitting for lazy-loaded widgets",description:`${this.lazyLoadOpportunities.length} opportunities identified`,example:`
// Use dynamic routes
final route = await LazyRoute.create(
  () => import('pages/DetailPage.dart')
);`,effort:"medium",priority:"low",opportunities:this.lazyLoadOpportunities.length}),e.push({step:e.length+1,action:"Set up SSR testing pipeline",description:"Render app on server, verify HTML structure",example:`
// Test SSR output matches CSR:
const serverHtml = await renderAppOnServer();
const clientHtml = await renderAppOnClient();
assert(serverHtml === clientHtml, 'SSR/CSR mismatch');`,effort:"medium",priority:"critical"}),this.ssrMigrationPath=e}validateSsrRequirements(){this.ssrUnsafePatterns.forEach(t=>{t.category==="browser-api"&&this.validationIssues.push({type:"browser-api-usage",severity:"critical",pattern:t.pattern,location:t.location,message:`Browser API "${t.pattern}" is not available on server`,suggestion:"Wrap in kIsWeb check or use platform-agnostic alternative"})}),this.ssrUnsafePatterns.forEach(t=>{t.category==="determinism"&&this.validationIssues.push({type:"non-deterministic",severity:"error",pattern:t.pattern,location:t.location,message:`Non-deterministic operation "${t.pattern}" causes hydration mismatch`,suggestion:"Use seeded random or remove randomness from render path"})});let e=this.ssrUnsafePatterns.filter(t=>t.category==="user-interaction");e.length>0&&this.validationIssues.push({type:"event-handlers-in-build",severity:"warning",count:e.length,message:`${e.length} event handlers defined in build() - they'll be recreated on every render`,suggestion:"Move event handler definitions to initState or class level"}),this.hydrationRequirements.length>0&&this.ssrMigrationPath.length===0&&this.validationIssues.push({type:"incomplete-hydration",severity:"error",message:`App has ${this.hydrationRequirements.length} hydration needs but no hydration layer implemented`,suggestion:"Add hydration step to migration path"})}calculateCompatibilityScore(){let e=100,t=this.ssrUnsafePatterns.length;e-=Math.min(t*5,40);let s=this.validationIssues.filter(n=>n.severity==="critical");e-=s.length*15;let i=this.validationIssues.filter(n=>n.type==="browser-api-usage");e-=i.length*10;let r=this.ssrSafePatterns.length;r>0&&(e+=Math.min(r*2,15)),this.ssrMigrationPath.length>3&&(e+=10),this.ssrCompatibilityScore=Math.max(0,Math.min(100,e))}getOverallCompatibility(){return this.ssrCompatibilityScore>=85?"full":this.ssrCompatibilityScore>=60?"partial":this.ssrCompatibilityScore>=30?"limited":"none"}getEstimatedEffort(){let e=this.ssrMigrationPath.reduce((t,s)=>t+({low:1,medium:2,high:3}[s.effort]||0),0);return e<=3?"minimal":e<=6?"moderate":e<=9?"significant":"major-rewrite"}getResults(){let e=this.validationIssues.filter(t=>t.severity==="critical");return{overallCompatibility:this.getOverallCompatibility(),ssrCompatibilityScore:this.ssrCompatibilityScore,ssrReadinessScore:this.ssrCompatibilityScore,ssrSafePatterns:this.ssrSafePatterns,ssrUnsafePatterns:this.ssrUnsafePatterns,hydrationRequirements:this.hydrationRequirements,hydrationCount:this.hydrationCount,lazyLoadOpportunities:this.lazyLoadOpportunities,ssrMigrationPath:this.ssrMigrationPath,estimatedEffort:this.getEstimatedEffort(),validationIssues:this.validationIssues,criticalIssues:e,warningIssues:this.validationIssues.filter(t=>t.severity==="warning"),summary:{compatibility:this.getOverallCompatibility(),score:this.ssrCompatibilityScore,safePatterns:this.ssrSafePatterns.length,unsafePatterns:this.ssrUnsafePatterns.length,hydrationNeeded:this.hydrationCount,migrationSteps:this.ssrMigrationPath.length,criticalIssues:e.length,effort:this.getEstimatedEffort()},errors:this.errors}}};var te=class{constructor(e,t,s=null,i=null,r={}){this.widgetResults=e,this.stateResults=t,this.contextResults=s,this.ssrResults=i,this.options={format:"json",includeMetrics:!0,includeTree:!0,includeValidation:!0,includeSuggestions:!0,includeContext:!0,includeSsr:!0,prettyPrint:!0,...r},this.logger=w().createComponentLogger("ReportGenerator"),this.metadata={},this.report={}}generate(){this.logger.startSession("ReportGeneration"),this.logger.info("Generating report");try{this.calculateMetrics(),this.buildReport();let e;switch(this.options.format){case"json":e=this.toJSON();break;case"markdown":e=this.toMarkdown();break;case"console":e=this.toConsole();break;default:e=this.toJSON()}return this.logger.success("Report generation complete"),this.logger.endSession("ReportGeneration"),e}catch(e){throw this.logger.failure("Report generation failed",e.message),this.logger.endSession("ReportGeneration"),e}}calculateMetrics(){var R,A,F,N,M,O,W,U,L;let e=this.widgetResults.widgets||[],t=this.widgetResults.functions||[],s=this.widgetResults.imports||[],i=this.stateResults.stateClasses||[],r=this.stateResults.stateFields||[],n=this.stateResults.setStateCalls||[],l=this.stateResults.lifecycleMethods||[],a=this.stateResults.eventHandlers||[],c=((R=this.contextResults)==null?void 0:R.inheritedWidgets)||[],u=((A=this.contextResults)==null?void 0:A.changeNotifiers)||[],d=((F=this.contextResults)==null?void 0:F.providers)||[],y=((N=this.contextResults)==null?void 0:N.contextAccessPoints)||[],g=((M=this.ssrResults)==null?void 0:M.ssrCompatibilityScore)||0,C=((O=this.ssrResults)==null?void 0:O.ssrSafePatterns)||[],k=((W=this.ssrResults)==null?void 0:W.ssrUnsafePatterns)||[],b=((U=this.ssrResults)==null?void 0:U.hydrationRequirements)||[];this.metadata={totalWidgets:e.length,statelessWidgets:e.filter(x=>x.type==="stateless").length,statefulWidgets:e.filter(x=>x.type==="stateful").length,componentWidgets:e.filter(x=>x.type==="component").length,stateClasses:i.length,totalStateFields:r.length,setStateCallCount:n.length,lifecycleMethodCount:l.length,eventHandlerCount:a.length,inheritedWidgets:c.length,changeNotifiers:u.length,providers:d.length,contextAccessPoints:y.length,ssrCompatibilityScore:g,ssrCompatibility:((L=this.ssrResults)==null?void 0:L.overallCompatibility)||"unknown",ssrSafePatterns:C.length,ssrUnsafePatterns:k.length,hydrationRequired:b.length>0,hydrationCount:b.length,totalFunctions:t.length,entryPoint:this.widgetResults.entryPoint,rootWidget:this.widgetResults.rootWidget,totalImports:s.length,externalPackages:new Set(s.map(x=>x.source)).size,treeDepth:this.calculateTreeDepth(this.widgetResults.widgetTree),errorCount:this.countValidationIssues(this.stateResults.validationResults,"error"),warningCount:this.countValidationIssues(this.stateResults.validationResults,"warning"),infoCount:this.countValidationIssues(this.stateResults.validationResults,"info")},this.metadata.healthScore=this.calculateHealthScore(),this.metadata.complexityScore=this.calculateComplexityScore()}calculateTreeDepth(e,t=1){return!e||!e.children||e.children.length===0?t:1+Math.max(...e.children.map(s=>this.calculateTreeDepth(s,t+1)))}countValidationIssues(e,t){return e?e.filter(s=>s.severity===t).length:0}calculateHealthScore(){let e=100;return e-=this.metadata.errorCount*10,e-=this.metadata.warningCount*2,this.metadata.entryPoint&&(e+=5),this.metadata.statefulWidgets>this.metadata.statelessWidgets&&(e-=10),this.metadata.treeDepth>5&&(e-=5),this.metadata.ssrCompatibilityScore<50&&(e-=15),Math.max(0,Math.min(100,e))}calculateComplexityScore(){let e=0;return e+=Math.min(this.metadata.totalStateFields*10,40),e+=Math.min(this.metadata.setStateCallCount*5,30),e+=Math.min(this.metadata.eventHandlerCount*2,20),this.metadata.treeDepth>5&&(e+=10),e+=Math.min(this.metadata.contextAccessPoints*3,15),Math.min(100,e)}buildReport(){let e=this.widgetResults.widgets||[],t=this.stateResults.stateClasses||[],s=this.stateResults.validationResults||[];this.report={analysis:{file:this.widgetResults.file||"analysis",timestamp:new Date().toISOString(),status:s.some(i=>i.severity==="error")?"warning":"success",phase:"phase1+phase2+phase3"},summary:{widgets:{total:this.metadata.totalWidgets,stateless:this.metadata.statelessWidgets,stateful:this.metadata.statefulWidgets,components:this.metadata.componentWidgets},state:{stateClasses:this.metadata.stateClasses,stateFields:this.metadata.totalStateFields,setStateCalls:this.metadata.setStateCallCount,lifecycleMethods:this.metadata.lifecycleMethodCount,eventHandlers:this.metadata.eventHandlerCount},context:this.options.includeContext?{inheritedWidgets:this.metadata.inheritedWidgets,changeNotifiers:this.metadata.changeNotifiers,providers:this.metadata.providers,contextAccessPoints:this.metadata.contextAccessPoints}:null,ssr:this.options.includeSsr?{compatibility:this.metadata.ssrCompatibility,compatibilityScore:this.metadata.ssrCompatibilityScore,safePatterns:this.metadata.ssrSafePatterns,unsafePatterns:this.metadata.ssrUnsafePatterns,hydrationRequired:this.metadata.hydrationRequired,hydrationCount:this.metadata.hydrationCount}:null,functions:this.metadata.totalFunctions,imports:this.metadata.totalImports,externalPackages:this.metadata.externalPackages,entryPoint:this.metadata.entryPoint,rootWidget:this.metadata.rootWidget,treeDepth:this.metadata.treeDepth,healthScore:this.metadata.healthScore,complexityScore:this.metadata.complexityScore},widgets:this.formatWidgets(),stateClasses:this.formatStateClasses(),imports:this.formatImports(),functions:this.formatFunctions(),context:this.options.includeContext?this.formatContext():null,ssr:this.options.includeSsr?this.formatSsr():null,widgetTree:this.options.includeTree?this.formatWidgetTree():null,dependencyGraph:this.formatDependencyGraph(),validation:this.options.includeValidation?this.formatValidation():null,suggestions:this.options.includeSuggestions?this.generateSuggestions():null,metrics:this.options.includeMetrics?this.getDetailedMetrics():null}}formatContext(){var e,t,s,i;return this.contextResults?{inheritedWidgets:((e=this.contextResults.inheritedWidgets)==null?void 0:e.map(r=>{var n;return{name:r.name,properties:r.properties,staticAccessors:(n=r.staticAccessors)==null?void 0:n.map(l=>l.name),updateShouldNotifyImplemented:r.updateShouldNotifyImplemented,usedIn:r.usedIn,usageCount:r.usageCount}}))||[],changeNotifiers:((t=this.contextResults.changeNotifiers)==null?void 0:t.map(r=>{var n,l,a;return{name:r.name,properties:((n=r.properties)==null?void 0:n.length)||0,getters:((l=r.getters)==null?void 0:l.map(c=>c.name))||[],methods:((a=r.methods)==null?void 0:a.map(c=>({name:c.name,callsNotifyListeners:c.callsNotifyListeners,mutations:c.mutations})))||[],consumers:r.consumers||[]}}))||[],providers:((s=this.contextResults.providers)==null?void 0:s.map(r=>({type:r.providerType,valueType:r.valueType,consumers:r.consumers||[],accessPatterns:r.accessPatterns||[]})))||[],contextFlow:{inheritedWidgetGraph:this.contextResults.inheritedWidgetGraph||{},providerGraph:this.contextResults.providerGraph||{}},contextAccessPoints:((i=this.contextResults.contextAccessPoints)==null?void 0:i.map(r=>({pattern:r.pattern,type:r.type,location:r.location,ssrSafe:r.ssrSafe,reason:r.reason})))||[]}:{inheritedWidgets:[],changeNotifiers:[],providers:[],contextFlow:{}}}formatSsr(){var e,t,s,i,r,n,l;return this.ssrResults?{overallCompatibility:this.ssrResults.overallCompatibility,compatibilityScore:this.ssrResults.ssrCompatibilityScore,readinessScore:this.ssrResults.ssrReadinessScore||this.ssrResults.ssrCompatibilityScore,estimatedEffort:this.ssrResults.estimatedEffort,patterns:{safe:((e=this.ssrResults.ssrSafePatterns)==null?void 0:e.map(a=>({pattern:a.pattern,example:a.example,why:a.why,confidence:a.confidence})))||[],unsafe:((t=this.ssrResults.ssrUnsafePatterns)==null?void 0:t.map(a=>({pattern:a.pattern,example:a.example,why:a.why,severity:a.severity,suggestion:a.suggestion,location:a.location})))||[]},hydration:{required:this.ssrResults.hydrationCount>0,count:this.ssrResults.hydrationCount,requirements:((s=this.ssrResults.hydrationRequirements)==null?void 0:s.map(a=>({dependency:a.dependency,reason:a.reason,order:a.order,requiredProviders:a.requiredProviders,requiredState:a.requiredState})))||[]},lazyLoadingOpportunities:((i=this.ssrResults.lazyLoadOpportunities)==null?void 0:i.map(a=>({target:a.target,reason:a.reason,estimatedSize:a.estimatedSize,priority:a.priority,recommendation:a.recommendation})))||[],migrationPath:((r=this.ssrResults.ssrMigrationPath)==null?void 0:r.map(a=>({step:a.step,action:a.action,description:a.description,example:a.example,effort:a.effort,priority:a.priority,locations:a.locations})))||[],validationIssues:{critical:((n=this.ssrResults.criticalIssues)==null?void 0:n.map(a=>({type:a.type,message:a.message,suggestion:a.suggestion,location:a.location})))||[],warnings:((l=this.ssrResults.warningIssues)==null?void 0:l.map(a=>({type:a.type,message:a.message,suggestion:a.suggestion})))||[]}}:{compatibility:"unknown",score:0,patterns:{safe:[],unsafe:[]},hydration:[],migration:[]}}formatWidgets(){let e={};return(this.widgetResults.widgets||[]).forEach(t=>{e[t.name]={type:t.type,superClass:t.superClass||null,location:t.location,constructor:t.constructor?{params:t.constructor.params||[]}:null,methods:t.methods.map(s=>({name:s.name,params:s.params||[]})),properties:t.properties||[],linkedStateClass:t.linkedStateClass||null,imports:t.imports||[]}}),e}formatStateClasses(){let e={};return(this.stateResults.stateClasses||[]).forEach(t=>{let s=t.metadata||t;e[s.name]={name:s.name,linkedStatefulWidget:s.linkedStatefulWidget,location:s.location,stateFields:(s.stateFields||[]).map(i=>{var n;let r=typeof i.isUsed=="function"?i.isUsed():i.usedInMethods&&i.usedInMethods.length>0;return{name:i.name,type:i.type||"any",initialValue:i.initialValueString||((n=i.initialValue)==null?void 0:n.toString())||"undefined",isUsed:r,usedInMethods:i.usedInMethods||[],mutatedInMethods:i.mutatedInMethods||[],mutationCount:i.mutations&&i.mutations.length||0}}),lifecycleMethods:(s.lifecycleMethods||[]).map(i=>{let r=typeof i.isValid=="function"?i.isValid():!0;return{name:i.name,callsSuper:i.callsSuper||!1,hasSideEffects:i.hasSideEffects||!1,isValid:r,issues:i.validationIssues||[]}}),otherMethods:(s.otherMethods||[]).map(i=>({name:i.name,params:i.params||[]}))}}),e}formatImports(){let e={};return(this.widgetResults.imports||[]).forEach(t=>{e[t.source]=t.items||[]}),e}formatFunctions(){let e={};return(this.widgetResults.functions||[]).forEach(t=>{e[t.name]={type:t.type,location:t.location,params:(t.params||[]).map(s=>({name:s.name,optional:s.optional})),isEntryPoint:t.isEntryPoint||!1}}),e}formatWidgetTree(){return this.widgetResults.widgetTree?this.treeNodeToObject(this.widgetResults.widgetTree):null}treeNodeToObject(e){var t,s;return e?{name:((t=e.widget)==null?void 0:t.name)||"Unknown",type:((s=e.widget)==null?void 0:s.type)||"unknown",depth:e.depth||0,children:(e.children||[]).map(i=>this.treeNodeToObject(i))}:null}formatDependencyGraph(){let e=this.stateResults.dependencyGraph;return e?{stateToMethods:Object.fromEntries(e.stateToMethods||[]),methodToState:Object.fromEntries(e.methodToState||[]),eventToState:Object.fromEntries(e.eventToState||[])}:null}formatValidation(){let e=this.stateResults.validationResults||[];return{totalIssues:e.length,errors:e.filter(t=>t.severity==="error"),warnings:e.filter(t=>t.severity==="warning"),info:e.filter(t=>t.severity==="info")}}generateSuggestions(){var t,s,i;let e=[];return this.metadata.statefulWidgets>this.metadata.statelessWidgets&&e.push({type:"structure",severity:"info",message:"More stateful than stateless widgets",suggestion:"Consider using stateless widgets where possible for better performance"}),this.metadata.treeDepth>5&&e.push({type:"structure",severity:"warning",message:"Deep widget tree detected",suggestion:"Consider refactoring to reduce nesting depth (aim for < 5 levels)"}),this.options.includeSsr&&this.ssrResults&&(this.metadata.ssrCompatibilityScore<50&&e.push({type:"ssr-compatibility",severity:"warning",message:`Low SSR compatibility score (${this.metadata.ssrCompatibilityScore}/100)`,suggestion:`Follow the ${((t=this.ssrResults.ssrMigrationPath)==null?void 0:t.length)||0} migration steps to improve SSR support`,migrationSteps:((s=this.ssrResults.ssrMigrationPath)==null?void 0:s.length)||0}),this.metadata.ssrUnsafePatterns>5&&e.push({type:"ssr-patterns",severity:"warning",message:`Found ${this.metadata.ssrUnsafePatterns} SSR-unsafe patterns`,suggestion:"Refactor unsafe patterns to enable server-side rendering",unsafePatterns:this.metadata.ssrUnsafePatterns}),this.metadata.hydrationRequired&&e.push({type:"hydration",severity:"info",message:`App requires hydration for ${this.metadata.hydrationCount} dependencies`,suggestion:"Implement hydration layer to re-attach listeners after server render",hydrationDependencies:this.metadata.hydrationCount}),((i=this.ssrResults.lazyLoadOpportunities)==null?void 0:i.length)>0&&e.push({type:"optimization",severity:"info",message:`Found ${this.ssrResults.lazyLoadOpportunities.length} lazy-load opportunities`,suggestion:"Implement code splitting to reduce initial bundle size",opportunities:this.ssrResults.lazyLoadOpportunities.length})),this.options.includeContext&&this.contextResults&&(this.metadata.inheritedWidgets>3&&e.push({type:"context-hierarchy",severity:"info",message:`Multiple InheritedWidgets detected (${this.metadata.inheritedWidgets})`,suggestion:"Consider consolidating context providers to reduce nesting",inheritedWidgets:this.metadata.inheritedWidgets}),this.metadata.providers>0&&e.push({type:"state-management",severity:"info",message:`Using Provider pattern (${this.metadata.providers} providers)`,suggestion:"Ensure providers are properly organized and lazy-initialized where possible",providers:this.metadata.providers})),e}getDetailedMetrics(){return{widgetMetrics:{total:this.metadata.totalWidgets,byType:{stateless:this.metadata.statelessWidgets,stateful:this.metadata.statefulWidgets,component:this.metadata.componentWidgets,state:this.metadata.stateClasses}},stateMetrics:{stateClasses:this.metadata.stateClasses,totalFields:this.metadata.totalStateFields,setStateCalls:this.metadata.setStateCallCount,lifecycleMethods:this.metadata.lifecycleMethodCount,eventHandlers:this.metadata.eventHandlerCount},contextMetrics:this.options.includeContext?{inheritedWidgets:this.metadata.inheritedWidgets,changeNotifiers:this.metadata.changeNotifiers,providers:this.metadata.providers,contextAccessPoints:this.metadata.contextAccessPoints}:null,ssrMetrics:this.options.includeSsr?{compatibilityScore:this.metadata.ssrCompatibilityScore,compatibility:this.metadata.ssrCompatibility,safePatterns:this.metadata.ssrSafePatterns,unsafePatterns:this.metadata.ssrUnsafePatterns,hydrationRequired:this.metadata.hydrationRequired,hydrationCount:this.metadata.hydrationCount}:null,functionMetrics:{total:this.metadata.totalFunctions,entryPoint:this.metadata.entryPoint||"none"},dependencyMetrics:{totalImports:this.metadata.totalImports,externalPackages:this.metadata.externalPackages},structureMetrics:{widgetTreeDepth:this.metadata.treeDepth,rootWidget:this.metadata.rootWidget||"none"},healthMetrics:{healthScore:this.metadata.healthScore,complexityScore:this.metadata.complexityScore,errors:this.metadata.errorCount,warnings:this.metadata.warningCount}}}toJSON(){return this.options.prettyPrint?JSON.stringify(this.report,null,2):JSON.stringify(this.report)}toMarkdown(){let e=`# FlutterJS Code Analysis Report (Phase 1 + 2 + 3)

`;if(e+=`**Generated:** ${new Date().toISOString()}

`,e+=`## Summary

`,e+=`| Metric | Count |
`,e+=`|--------|-------|
`,e+=`| Total Widgets | ${this.metadata.totalWidgets} |
`,e+=`| Stateless | ${this.metadata.statelessWidgets} |
`,e+=`| Stateful | ${this.metadata.statefulWidgets} |
`,e+=`| State Classes | ${this.metadata.stateClasses} |
`,e+=`| State Fields | ${this.metadata.totalStateFields} |
`,e+=`| Health Score | ${this.metadata.healthScore}/100 |
`,e+=`| Complexity Score | ${this.metadata.complexityScore}/100 |
`,this.options.includeContext&&(e+=`| InheritedWidgets | ${this.metadata.inheritedWidgets} |
`,e+=`| ChangeNotifiers | ${this.metadata.changeNotifiers} |
`,e+=`| Providers | ${this.metadata.providers} |
`),this.options.includeSsr&&(e+=`| SSR Compatibility | ${this.metadata.ssrCompatibility} |
`,e+=`| SSR Score | ${this.metadata.ssrCompatibilityScore}/100 |
`,e+=`| Hydration Required | ${this.metadata.hydrationRequired?"Yes":"No"} |
`),e+=`
`,this.options.includeContext&&this.contextResults&&(e+=`## Context Analysis (Phase 3)

`,this.metadata.inheritedWidgets>0&&(e+=`### InheritedWidgets

`,(this.contextResults.inheritedWidgets||[]).forEach(t=>{e+=`- **${t.name}**
`,t.properties&&t.properties.length>0&&(e+=`  - Properties: ${t.properties.map(s=>s.name).join(", ")}
`),t.usedIn&&t.usedIn.length>0&&(e+=`  - Used in: ${t.usedIn.join(", ")}
`)}),e+=`
`),this.metadata.changeNotifiers>0&&(e+=`### ChangeNotifiers

`,(this.contextResults.changeNotifiers||[]).forEach(t=>{e+=`- **${t.name}**
`,t.consumers&&t.consumers.length>0&&(e+=`  - Consumed by: ${t.consumers.join(", ")}
`)}),e+=`
`)),this.options.includeSsr&&this.ssrResults&&(e+=`## SSR Compatibility Analysis (Phase 3)

`,e+=`**Overall Compatibility:** ${this.metadata.ssrCompatibility}
`,e+=`**Score:** ${this.metadata.ssrCompatibilityScore}/100
`,e+=`**Effort to fix:** ${this.ssrResults.estimatedEffort}

`,this.metadata.ssrUnsafePatterns>0&&(e+=`### Unsafe Patterns (${this.metadata.ssrUnsafePatterns})

`,(this.ssrResults.ssrUnsafePatterns||[]).slice(0,10).forEach(t=>{e+=`- **${t.pattern}**: ${t.why}
`}),this.metadata.ssrUnsafePatterns>10&&(e+=`- ... and ${this.metadata.ssrUnsafePatterns-10} more
`),e+=`
`),this.ssrResults.hydrationCount>0&&(e+=`### Hydration Requirements (${this.ssrResults.hydrationCount})

`,(this.ssrResults.hydrationRequirements||[]).forEach(t=>{e+=`- **${t.dependency}**: ${t.reason}
`}),e+=`
`),this.ssrResults.ssrMigrationPath&&this.ssrResults.ssrMigrationPath.length>0&&(e+=`### Migration Path (${this.ssrResults.ssrMigrationPath.length} steps)

`,(this.ssrResults.ssrMigrationPath||[]).forEach(t=>{e+=`**Step ${t.step}: ${t.action}**
`,t.description&&(e+=`${t.description}
`),t.effort&&(e+=`- Effort: ${t.effort}
`),e+=`
`}))),e+=`
`,this.options.includeSuggestions){let t=this.generateSuggestions();t.length>0&&(e+=`## Suggestions

`,t.forEach(s=>{e+=`- **${s.message}**: ${s.suggestion}
`}),e+=`
`)}return e}toConsole(){var t,s;let e=[];return e.push(`
`+"=".repeat(80)),e.push("FlutterJS CODE ANALYSIS REPORT (Phase 1 + 2 + 3)"),e.push("=".repeat(80)+`
`),e.push("SUMMARY"),e.push("-".repeat(80)),e.push(`  Widgets: ${this.metadata.totalWidgets} (${this.metadata.statelessWidgets} stateless, ${this.metadata.statefulWidgets} stateful)`),e.push(`  State Classes: ${this.metadata.stateClasses}`),e.push(`  State Fields: ${this.metadata.totalStateFields}`),e.push(`  Health Score: ${this.metadata.healthScore}/100`),e.push(`  Complexity: ${this.metadata.complexityScore}/100`),this.options.includeContext&&(e.push(`  InheritedWidgets: ${this.metadata.inheritedWidgets}`),e.push(`  ChangeNotifiers: ${this.metadata.changeNotifiers}`),e.push(`  Providers: ${this.metadata.providers}`)),this.options.includeSsr&&(e.push(`  SSR Compatibility: ${this.metadata.ssrCompatibility}`),e.push(`  SSR Score: ${this.metadata.ssrCompatibilityScore}/100`),e.push(`  Migration Steps: ${((s=(t=this.ssrResults)==null?void 0:t.ssrMigrationPath)==null?void 0:s.length)||0}`)),e.push(""),this.options.includeContext&&this.contextResults&&this.metadata.inheritedWidgets>0&&(e.push("CONTEXT ANALYSIS (Phase 3)"),e.push("-".repeat(80)),this.metadata.inheritedWidgets>0&&(e.push("  InheritedWidgets:"),(this.contextResults.inheritedWidgets||[]).forEach(i=>{e.push(`    - ${i.name}`),i.usedIn&&i.usedIn.length>0&&e.push(`      Used in: ${i.usedIn.join(", ")}`)})),this.metadata.changeNotifiers>0&&(e.push("  ChangeNotifiers:"),(this.contextResults.changeNotifiers||[]).forEach(i=>{e.push(`    - ${i.name}`),i.consumers&&i.consumers.length>0&&e.push(`      Consumers: ${i.consumers.join(", ")}`)})),e.push("")),this.options.includeSsr&&this.ssrResults&&(e.push("SSR COMPATIBILITY ANALYSIS (Phase 3)"),e.push("-".repeat(80)),e.push(`  Overall: ${this.metadata.ssrCompatibility} (${this.metadata.ssrCompatibilityScore}/100)`),e.push(`  Safe Patterns: ${this.metadata.ssrSafePatterns}`),e.push(`  Unsafe Patterns: ${this.metadata.ssrUnsafePatterns}`),this.ssrResults.hydrationCount>0&&e.push(`  Hydration Required: Yes (${this.ssrResults.hydrationCount} dependencies)`),this.ssrResults.ssrMigrationPath&&this.ssrResults.ssrMigrationPath.length>0&&(e.push(`  Migration Steps: ${this.ssrResults.ssrMigrationPath.length}`),e.push(`  Estimated Effort: ${this.ssrResults.estimatedEffort}`)),e.push("")),this.stateResults&&this.stateResults.validationResults&&this.stateResults.validationResults.length>0&&(e.push("VALIDATION ISSUES"),e.push("-".repeat(80)),(this.stateResults.validationResults||[]).forEach(i=>{let r=i.severity==="error"?"\u274C":i.severity==="warning"?"\u26A0\uFE0F ":"\u2139\uFE0F ";e.push(`  ${r} [${i.severity.toUpperCase()}] ${i.message}`),i.suggestion&&e.push(`     \u2192 ${i.suggestion}`)}),e.push("")),e.push("=".repeat(80)+`
`),e.join(`
`)}saveToFile(e,t){let s=this.generate();return t.writeFileSync(e,s,"utf-8"),e}};_e();var Ze={frameworkType:"flutter-js",ignoreUnresolved:!1,cacheEnabled:!1,customPackageMappings:{"@package:ui":"./packages/ui","@package:models":"./packages/models","@package:utils":"./packages/utils","@package:services":"./packages/services","@package:theme":"./packages/theme","@package:constants":"./packages/constants"},localSearchPaths:["src","lib","packages","modules","components","screens","widgets","."],packageAliases:{flutter:"@package:flutter",material:"@package:material",cupertino:"@package:cupertino"},strict:{enforceNamingConventions:!1,requireVersions:!1,detectCircularImports:!0}};var T=class{constructor(e={}){this.options={sourceFile:null,sourceCode:null,outputFormat:"json",outputFile:null,verbose:!0,strict:!1,projectRoot:process.cwd(),includeMetrics:!0,includeTree:!0,includeValidation:!0,includeSuggestions:!0,includeContext:!0,includeSsr:!0,includeImports:!0,ignoreUnresolvedImports:!0,prettyPrint:!0,debugLevel:"info",...e},this.logger=Qe({level:this.options.debugLevel,writeToFile:!0,writeToConsole:!1,debugDir:".debug"});let t=this.logger.createComponentLogger("Analyzer");this.log=t,this.importResolver=new se({projectRoot:this.options.projectRoot,ignoreUnresolved:this.options.ignoreUnresolvedImports,...Ze}),this.results={source:null,tokens:null,ast:null,widgets:null,importResolution:null,state:null,context:null,ssr:null,report:null},this.errors=[],this.timings={}}async analyze(){var t,s;let e=this.log;e.startSession("FullAnalyzerPipeline");try{if(e.info(`
`+"=".repeat(80)),e.info("\u{1F680} FlutterJS ANALYZER - FULL PIPELINE"),e.info("=".repeat(80)),e.startSession("LoadSource"),e.info("STEP 1: Loading source code..."),await this.loadSource(),e.success("Source loaded"),e.endSession("LoadSource"),e.startSession("Lexing"),e.info("STEP 2: Tokenizing (Lexing)..."),this.lex(),e.trace("Tokens generated",this.results.tokens.length),e.success("Lexing complete"),e.endSession("Lexing"),e.startSession("Parsing"),e.info("STEP 3: Building AST (Parsing)..."),this.parse(),e.trace("Top-level items",this.results.ast.body.length),e.success("Parsing complete"),e.endSession("Parsing"),e.startSession("WidgetAnalysis"),e.info("STEP 4: Widget Analysis (Phase 1)..."),this.analyzeWidgets(),e.trace("Widgets detected",this.results.widgets.widgets.length),e.success("Widget analysis complete"),e.endSession("WidgetAnalysis"),this.options.includeImports){e.startSession("ImportResolution"),e.info("STEP 5: Resolving Imports..."),this.analyzeImports();let i=(t=this.results.importResolution)==null?void 0:t.summary;e.trace("Imports resolved",(i==null?void 0:i.resolved)||0),e.trace("Imports unresolved",(i==null?void 0:i.unresolved)||0),e.success("Import resolution complete"),e.endSession("ImportResolution")}return e.startSession("StateAnalysis"),e.info("STEP 6: State Analysis (Phase 2)..."),this.analyzeState(),e.trace("State classes analyzed",this.results.state.stateClasses.length),e.success("State analysis complete"),e.endSession("StateAnalysis"),this.options.includeContext&&(e.startSession("ContextAnalysis"),e.info("STEP 7: Context Analysis (Phase 3)..."),this.analyzeContext(),e.trace("Inherited widgets detected",((s=this.results.context.inheritedWidgets)==null?void 0:s.length)||0),e.success("Context analysis complete"),e.endSession("ContextAnalysis")),this.options.includeSsr&&(e.startSession("SSRAnalysis"),e.info("STEP 8: SSR Compatibility Analysis (Phase 3)..."),this.analyzeSsr(),e.trace("SSR Compatibility Score",this.results.ssr.ssrCompatibilityScore),e.success("SSR analysis complete"),e.endSession("SSRAnalysis")),e.startSession("ReportGeneration"),e.info("STEP 9: Generating Report..."),this.generateReport(),e.success("Report generated"),e.endSession("ReportGeneration"),e.startSession("Output"),e.info("STEP 10: Output..."),this.output(),e.success("Output complete"),e.endSession("Output"),e.info("=".repeat(80)),e.success("\u2705 ANALYSIS COMPLETE"),e.info("=".repeat(80)+`
`),this.logger.saveLogs(),this.getResults()}catch(i){throw e.error("ANALYSIS FAILED"),e.failure("Analysis pipeline",i.message),e.endSession("FullAnalyzerPipeline"),i}}analyzeImports(){let e=Date.now(),t=this.log;try{if(!this.results.widgets){t.warn("No widgets found, skipping import analysis");return}let s=this.results.widgets.imports||[];if(s.length===0){t.info("No imports found in source"),this.results.importResolution={imports:{resolved:[],unresolved:[],errors:[]},summary:{total:0,resolved:0,unresolved:0,errors:0,resolutionRate:"N/A",bySource:{framework:0,local:0,cache:0}}};return}t.info(`Found ${s.length} imports to resolve`);let i=this.importResolver.resolveImports(s.map(r=>({source:r.source,items:r.items})));if(this.results.importResolution=i,t.debug(`Resolved: ${i.imports.resolved.length}`),t.debug(`Unresolved: ${i.imports.unresolved.length}`),t.debug(`Errors: ${i.imports.errors.length}`),!this.options.ignoreUnresolvedImports&&i.imports.errors.length>0)throw new Error(`${i.imports.errors.length} imports could not be resolved`)}catch(s){throw t.error(`Import resolution failed: ${s.message}`),new Error(`Import resolution failed: ${s.message}`)}this.timings.analyzeImports=Date.now()-e}async loadSource(){let e=Date.now(),t=this.log;if(this.options.sourceCode)this.results.source=this.options.sourceCode,t.debug("Using provided source code");else if(this.options.sourceFile)try{this.results.source=Xe.readFileSync(this.options.sourceFile,"utf-8"),t.debug(`Loaded from file: ${this.options.sourceFile}`),t.trace("Source file size",this.results.source.length)}catch(s){throw t.error(`Cannot read file "${this.options.sourceFile}"`),new Error(`Cannot read file "${this.options.sourceFile}": ${s.message}`)}else throw t.error("No source code or source file provided"),new Error("No source code or source file provided");this.timings.loadSource=Date.now()-e}lex(){let e=Date.now(),t=this.log;try{let s=new q(this.results.source);this.results.tokens=s.tokenize(),s.getErrors().length>0&&(t.warn(`Lexer produced ${s.getErrors().length} warnings`),s.getErrors().forEach(i=>{t.debug(`Lexer: ${i.message}`)}))}catch(s){throw t.error(`Lexing failed: ${s.message}`),new Error(`Lexing failed: ${s.message}`)}this.timings.lex=Date.now()-e}parse(){let e=Date.now(),t=this.log;try{let s=new K(this.results.tokens);if(this.results.ast=s.parse(),s.getErrors().length>0&&(t.warn(`Parser produced ${s.getErrors().length} errors`),s.getErrors().forEach(i=>{t.debug(`Parser: ${i.message}`)}),this.options.strict))throw new Error(`${s.getErrors().length} parser errors found`)}catch(s){throw t.error(`Parsing failed: ${s.message}`),new Error(`Parsing failed: ${s.message}`)}this.timings.parse=Date.now()-e}analyzeWidgets(){let e=Date.now(),t=this.log;try{let s=new J(this.results.ast);this.results.widgets=s.analyze(),this.results.widgets.errors.length>0&&(t.warn(`Widget analysis produced ${this.results.widgets.errors.length} errors`),this.results.widgets.errors.forEach(i=>{t.debug(`Widget: ${i.message}`)}))}catch(s){throw t.error(`Widget analysis failed: ${s.message}`),new Error(`Widget analysis failed: ${s.message}`)}this.timings.analyzeWidgets=Date.now()-e}analyzeState(){let e=Date.now(),t=this.log;try{let s=new Y(this.results.ast,this.results.widgets.widgets,{strict:this.options.strict});this.results.state=s.analyze(),this.results.state.errors.length>0&&(t.warn(`State analysis produced ${this.results.state.errors.length} errors`),this.results.state.errors.forEach(i=>{t.debug(`State: ${i.message}`)}))}catch(s){throw t.error(`State analysis failed: ${s.message}`),new Error(`State analysis failed: ${s.message}`)}this.timings.analyzeState=Date.now()-e}analyzeContext(){let e=Date.now(),t=this.log;try{let s=new X(this.results.ast,this.results.widgets.widgets,{strict:this.options.strict});this.results.context=s.analyze(),this.results.context.errors&&this.results.context.errors.length>0&&(t.warn(`Context analysis produced ${this.results.context.errors.length} errors`),this.results.context.errors.forEach(i=>{t.debug(`Context: ${i.message}`)}))}catch(s){throw t.error(`Context analysis failed: ${s.message}`),new Error(`Context analysis failed: ${s.message}`)}this.timings.analyzeContext=Date.now()-e}analyzeSsr(){let e=Date.now(),t=this.log;try{let s=new ee(this.results.context,this.results.state,{strict:this.options.strict});this.results.ssr=s.analyze(),this.results.ssr.errors&&this.results.ssr.errors.length>0&&(t.warn(`SSR analysis produced ${this.results.ssr.errors.length} errors`),this.results.ssr.errors.forEach(i=>{t.debug(`SSR: ${i.message}`)}))}catch(s){throw t.error(`SSR analysis failed: ${s.message}`),new Error(`SSR analysis failed: ${s.message}`)}this.timings.analyzeSsr=Date.now()-e}generateReport(){let e=Date.now(),t=this.log;try{let s=new te(this.results.widgets,this.results.state,this.results.context,this.results.ssr,{format:this.options.outputFormat,includeMetrics:this.options.includeMetrics,includeTree:this.options.includeTree,includeValidation:this.options.includeValidation,includeSuggestions:this.options.includeSuggestions,includeContext:this.options.includeContext,includeSsr:this.options.includeSsr,prettyPrint:this.options.prettyPrint});this.results.report=s.generate()}catch(s){throw t.error(`Report generation failed: ${s.message}`),new Error(`Report generation failed: ${s.message}`)}this.timings.generateReport=Date.now()-e}output(){let e=this.log;if(this.options.outputFile)try{Xe.writeFileSync(this.options.outputFile,this.results.report,"utf-8"),e.success(`Report saved to: ${this.options.outputFile}`)}catch(t){throw e.error(`Cannot write to file "${this.options.outputFile}"`),new Error(`Cannot write to file "${this.options.outputFile}": ${t.message}`)}else this.options.outputFormat!=="console"&&console.log(this.results.report)}getResults(){var a,c,u,d,y,g,C,k,b,R,A,F,N,M,O,W,U,L,x,Pe,be,Re,ke,Ie,$e,Te,Ae,Fe,Ne,Me,Oe,We,Ue,Le,De,ze,je,qe,Ve,Be,He,Ge,Ke,Je,Ye;let e=((a=this.results.widgets)==null?void 0:a.widgets)||[],t=e.filter(S=>S.type==="stateless"),s=e.filter(S=>S.type==="stateful"),i=e.filter(S=>S.type==="state"),r=t.map(S=>S.name),n=s.map(S=>S.name),l={};return i.forEach(S=>{let ie=S.name.replace(/^_/,"").replace(/State$/,""),tt=S.fields||[];l[S.name]=tt.map(st=>st.name)}),s.forEach(S=>{let ie=`_${S.name}State`;l[ie]&&(l[S.name]=l[ie])}),{source:{length:((c=this.results.source)==null?void 0:c.length)||0,file:this.options.sourceFile},tokens:{count:((u=this.results.tokens)==null?void 0:u.length)||0},ast:{items:((y=(d=this.results.ast)==null?void 0:d.body)==null?void 0:y.length)||0},widgets:{stateless:r,stateful:n,count:e.length,all:e,stateClasses:l,total:{stateless:t.length,stateful:s.length,state:i.length}},imports:this.options.includeImports?{total:((C=(g=this.results.importResolution)==null?void 0:g.summary)==null?void 0:C.total)||0,resolved:((b=(k=this.results.importResolution)==null?void 0:k.summary)==null?void 0:b.resolved)||0,unresolved:((A=(R=this.results.importResolution)==null?void 0:R.summary)==null?void 0:A.unresolved)||0,errors:((N=(F=this.results.importResolution)==null?void 0:F.summary)==null?void 0:N.errors)||0,resolutionRate:((O=(M=this.results.importResolution)==null?void 0:M.summary)==null?void 0:O.resolutionRate)||"N/A"}:null,state:{stateClasses:((U=(W=this.results.state)==null?void 0:W.stateClasses)==null?void 0:U.length)||0,stateFields:((x=(L=this.results.state)==null?void 0:L.stateFields)==null?void 0:x.length)||0,setStateCalls:((be=(Pe=this.results.state)==null?void 0:Pe.setStateCalls)==null?void 0:be.length)||0,lifecycleMethods:((ke=(Re=this.results.state)==null?void 0:Re.lifecycleMethods)==null?void 0:ke.length)||0,eventHandlers:(($e=(Ie=this.results.state)==null?void 0:Ie.eventHandlers)==null?void 0:$e.length)||0,validationIssues:((Ae=(Te=this.results.state)==null?void 0:Te.validationResults)==null?void 0:Ae.length)||0},context:this.options.includeContext?{inheritedWidgets:((Ne=(Fe=this.results.context)==null?void 0:Fe.inheritedWidgets)==null?void 0:Ne.length)||0,changeNotifiers:((Oe=(Me=this.results.context)==null?void 0:Me.changeNotifiers)==null?void 0:Oe.length)||0,providers:((Ue=(We=this.results.context)==null?void 0:We.providers)==null?void 0:Ue.length)||0,contextAccessPoints:((De=(Le=this.results.context)==null?void 0:Le.contextAccessPoints)==null?void 0:De.length)||0}:null,ssr:this.options.includeSsr?{compatibility:((ze=this.results.ssr)==null?void 0:ze.overallCompatibility)||"unknown",compatibilityScore:((je=this.results.ssr)==null?void 0:je.ssrCompatibilityScore)||0,safePatterns:((Ve=(qe=this.results.ssr)==null?void 0:qe.ssrSafePatterns)==null?void 0:Ve.length)||0,unsafePatterns:((He=(Be=this.results.ssr)==null?void 0:Be.ssrUnsafePatterns)==null?void 0:He.length)||0,hydrationNeeded:((Ge=this.results.ssr)==null?void 0:Ge.hydrationCount)||0,migrationSteps:((Je=(Ke=this.results.ssr)==null?void 0:Ke.ssrMigrationPath)==null?void 0:Je.length)||0,estimatedEffort:((Ye=this.results.ssr)==null?void 0:Ye.estimatedEffort)||"unknown"}:null,timings:this.timings,report:this.results.report,logger:this.logger.getReport(),debugFiles:this.logger.readDebugFiles()}}};async function qt(h,e={}){return new T({sourceCode:h,...e}).analyze()}async function Vt(h,e={}){return new T({sourceFile:h,...e}).analyze()}async function Bt(h,e,t={}){return new T({sourceFile:h,outputFile:e,...t}).analyze()}async function nt(){let h=process.argv.slice(2);h.length===0&&(et(),process.exit(0));let e=h[0],t=null,s="json",i=!0,r=!0,n=!0,l=!0,a="info";for(let c=1;c<h.length;c++){let u=h[c];u==="-o"||u==="--output"?t=h[++c]:u==="-f"||u==="--format"?s=h[++c]:u==="-q"||u==="--quiet"?i=!1:u==="--debug"?a=h[++c]||"debug":u==="--no-imports"?r=!1:u==="--no-context"?n=!1:u==="--no-ssr"?l=!1:u==="--phase1"?(r=!1,n=!1,l=!1):(u==="-h"||u==="--help")&&(et(),process.exit(0))}["json","markdown","console"].includes(s)||(console.error(`Invalid format: ${s}`),process.exit(1));try{let u=await new T({sourceFile:e,outputFile:t,outputFormat:s,verbose:i,includeImports:r,includeContext:n,includeSsr:l,debugLevel:a}).analyze();a!=="info"&&(console.log(`
\u{1F4CA} Debug logs saved to: .debug/`),console.log(`   View with: node debug_viewer.js
`)),process.exit(0)}catch(c){console.error(`
\u274C Error: ${c.message}
`),process.exit(1)}}function et(){console.log(`
FlutterJS Analyzer (Phase 1 + Import Resolution + Phase 2 + 3)

Usage:
  node analyzer.js <source-file> [options]

Options:
  -o, --output <file>      Output file (default: print to console)
  -f, --format <format>    Output format: json, markdown, console (default: json)
  -q, --quiet              Suppress verbose output
  --debug <level>          Enable debug logging: trace, debug, info (default: info)
  --no-imports             Skip import resolution
  --no-context             Skip Phase 3 context analysis
  --no-ssr                 Skip Phase 3 SSR analysis
  --phase1                 Only Phase 1 (widgets + imports)
  -h, --help               Show this help message

Examples:
  node analyzer.js test.fjs
  node analyzer.js test.fjs -o report.json
  node analyzer.js test.fjs --debug trace
  node analyzer.js test.fjs -f markdown
  node analyzer.js test.fjs --phase1
`)}import.meta.url===`file://${process.argv[1]}`&&nt();export{T as Analyzer,Bt as analyzeAndSave,qt as analyzeCode,Vt as analyzeFile,nt as runCLI};
//# sourceMappingURL=analyzer.js.map
