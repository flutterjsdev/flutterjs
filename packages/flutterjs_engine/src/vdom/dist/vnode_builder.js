import{VNode as u}from"./vnode.js";import"./style_converter.js";import{StatelessElement as o,StatefulElement as l}from"@flutterjs/runtime/element";import{InheritedElement as d}from"@flutterjs/runtime/inherited_element";class s{constructor(e={}){this.debugMode=e.debugMode||!1,this.runtime=e.runtime,this.debugMode&&!this.runtime&&console.warn("[VNodeBuilder] \u26A0\uFE0F No runtime provided - Element creation will fail")}build(e,n={}){if(!e)return null;if(e&&typeof e=="object"&&e.tag||typeof e=="string")return e;if(typeof e=="number")return String(e);if(!n.runtime&&this.runtime&&(n.runtime=this.runtime),typeof e.build=="function"&&!e.createState){if(this.debugMode&&console.log("[VNodeBuilder] \u{1F4E6} Building StatelessWidget:",e.constructor.name),!this.runtime)throw new Error("[VNodeBuilder] Runtime required to build StatelessWidget");const r=new o(e,n.parentElement||null,this.runtime),t=r.build();return t?(this.debugMode&&console.log("[VNodeBuilder] build() returned:",{type:typeof t,hasTag:t?.tag!==void 0,constructor:t?.constructor?.name}),t&&typeof t=="object"&&t.tag?(this.debugMode&&console.log("[VNodeBuilder] \u2713 Got VNode, returning"),t):t&&typeof t=="object"&&typeof t.build=="function"?(this.debugMode&&console.log("[VNodeBuilder] \u{1F504} Got Widget, recursively building:",t.constructor.name),this.build(t,{...n,parentElement:r,runtime:this.runtime})):typeof t=="string"||typeof t=="number"?t:(this.debugMode&&console.warn("[VNodeBuilder] Unknown return type from build():",t),null)):null}if(typeof e.createState=="function"){if(this.debugMode&&console.log("[VNodeBuilder] \u{1F4E6} Building StatefulWidget:",e.constructor.name),!this.runtime)throw new Error("[VNodeBuilder] Runtime required to build StatefulWidget");const r=new l(e,n.parentElement||null,this.runtime);r.mounted||r.mount();const t=r.build();return t?t&&typeof t=="object"&&t.tag?t:t&&typeof t=="object"&&typeof t.build=="function"?this.build(t,{...n,parentElement:r,runtime:this.runtime}):typeof t=="string"||typeof t=="number"?t:null:null}if(e.updateShouldNotify&&typeof e.updateShouldNotify=="function"){if(this.debugMode&&console.log("[VNodeBuilder] \u{1F4E6} Building InheritedWidget:",e.constructor.name),!this.runtime)throw new Error("[VNodeBuilder] Runtime required to build InheritedWidget");const r=new d(e,n.parentElement||null,this.runtime);r.mounted||r.mount();const t=r.build();if(e.child){const i=this.build(e.child,{...n,parentElement:r,runtime:this.runtime});return t&&i&&(t.children||(t.children=[]),t.children.push(i)),t||i}return t?this.build(t,n):null}return this.debugMode&&console.warn("[VNodeBuilder] Unknown widget type:",e.constructor?.name||typeof e),this.buildGeneric(e,n)}buildChildren(e,n){return e?(Array.isArray(e)||(e=[e]),e.map((r,t)=>this.build(r,{...n,childIndex:t,runtime:this.runtime})).filter(r=>r!=null)):[]}getWidgetType(e){return e?e.constructor&&e.constructor.name?e.constructor.name:e.runtimeType?e.runtimeType:e.widget&&e.widget.constructor?e.widget.constructor.name:"Unknown":"Unknown"}extractCommonProps(e){const n={};return e.key&&(n.key=e.key),e._debugLabel&&(n["data-debug-label"]=e._debugLabel),n}buildGeneric(e,n){let r=[];if(e.child){const i=this.build(e.child,n);i&&(r=[i])}else e.children&&(r=this.buildChildren(e.children,n));const t=this.getWidgetType(e);return new u({tag:"div",props:{className:`fjs-${t.toLowerCase()}`,"data-widget-type":t,...this.extractCommonProps(e)},children:r,metadata:{widgetType:t,note:"Generic widget - no specific builder implemented"}})}}export{s as VNodeBuilder};
//# sourceMappingURL=vnode_builder.js.map
