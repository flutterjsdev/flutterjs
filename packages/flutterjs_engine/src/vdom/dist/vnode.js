class r{constructor({tag:t="div",props:e={},style:s={},children:i=[],key:a=null,ref:n=null,events:p={},statefulWidgetId:c=null,stateProperty:f=null,isStateBinding:l=!1,updateFn:u=null,metadata:y={}}={}){this.tag=t,this.props=e||{},this.props=e||{},this.style=s||{},this.events=p||{},this.props&&this.props.style&&typeof this.props.style=="object"&&(this.style={...this.style,...this.props.style},delete this.props.style),this.props&&typeof this.props=="object"&&Object.keys(this.props).forEach(o=>{if(o.length>2&&o.startsWith("on")&&o[2]===o[2].toUpperCase()){const h=this.props[o];typeof h=="function"&&(this.events[o]=h,delete this.props[o])}}),this.children=Array.isArray(i)?i:[],this.key=a,this.ref=n,this.ref=n,this.statefulWidgetId=c,this.stateProperty=f,this.isStateBinding=l,this.updateFn=u,this.metadata=y||{},this._element=null,this._parent=null,this._index=null}toHTML(t={}){if(typeof this=="string")return r.escapeHTML(this);if(!this||!this.tag)return"";const e=this._serializeAttributes(),s=`<${this.tag}${e?" "+e:""}>`;if(r.VOID_TAGS.includes(this.tag))return s;const i=this.children.map(n=>n instanceof r?n.toHTML(t):typeof n=="string"?r.escapeHTML(n):"").join(""),a=`</${this.tag}>`;return`${s}${i}${a}`}toDOM(t={}){if(console.log(`
=== toDOM called for tag: ${this.tag}`),console.log("    style object:",this.style),console.log("    style keys:",Object.keys(this.style)),typeof this=="string")return document.createTextNode(this);if(!this||!this.tag)return document.createTextNode("");const e=document.createElement(this.tag);return this._applyProps(e),this._applyStyles(e),this._applyEvents(e),this.children.forEach((s,i)=>{let a;s instanceof r?(a=s.toDOM(t),s._parent=this,s._index=i):typeof s=="string"?a=document.createTextNode(s):a=document.createTextNode(String(s||"")),a&&e.appendChild(a)}),this._element=e,e._vnode=this,typeof this.ref=="function"&&this.ref(e),e}hydrate(t){if(!t||!this.tag)return null;this._element=t,t._vnode=this,this._applyEvents(t);const e=Array.from(t.childNodes);let s=0;return e.forEach((i,a)=>{const n=this.children[s];n&&(n instanceof r?(n.hydrate(i),n._parent=this,n._index=s,s++):i.nodeType===Node.TEXT_NODE&&String(n)===i.textContent&&s++)}),typeof this.ref=="function"&&this.ref(t),t}_serializeAttributes(){const t=[];if(this.props&&Object.entries(this.props).forEach(([e,s])=>{if(!(s==null||s===!1))if(s===!0)t.push(e);else{const i=e==="className"?"class":e,a=r.escapeAttribute(String(s));t.push(`${i}="${a}"`)}}),this.style&&typeof this.style=="object"){const e=Object.entries(this.style).filter(([s,i])=>i!=null).map(([s,i])=>`${s.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${i}`).join("; ");e&&t.push(`style="${r.escapeAttribute(e)}"`)}return this.metadata.widgetType&&t.push(`data-widget-type="${r.escapeAttribute(this.metadata.widgetType)}"`),this.key!==null&&this.key!==void 0&&t.push(`data-key="${r.escapeAttribute(String(this.key))}"`),t.join(" ")}_applyProps(t){this.props&&Object.entries(this.props).forEach(([e,s])=>{if(s!=null)try{e==="className"?t.className=s:e==="value"&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA")?t.value=s:e==="checked"&&t.tagName==="INPUT"?t.checked=!!s:e.startsWith("data-")||e.startsWith("aria-")?t.setAttribute(e,String(s)):typeof s=="boolean"?s&&t.setAttribute(e,""):e in t?t[e]=s:t.setAttribute(e,String(s))}catch(i){console.warn(`Failed to set property ${e}:`,i)}})}_applyStyles(t){!this.style||typeof this.style!="object"||Object.entries(this.style).forEach(([e,s])=>{if(s!=null)try{t.style[e]=s,console.log(`Set style ${e} = ${s} -> element.style.${e} = ${t.style[e]}`)}catch(i){console.warn(`Failed to set style ${e}:`,i)}})}_applyEvents(t){this.events&&Object.entries(this.events).forEach(([e,s])=>{if(typeof s!="function")return;const i=e.replace(/^on/,"").toLowerCase();t._eventListeners||(t._eventListeners={}),t._eventListeners[i]&&t.removeEventListener(i,t._eventListeners[i]),t.addEventListener(i,s),t._eventListeners[i]=s})}clone(){return new r({tag:this.tag,props:{...this.props},style:{...this.style},children:this.children.map(t=>t instanceof r?t.clone():t),key:this.key,ref:this.ref,events:{...this.events},statefulWidgetId:this.statefulWidgetId,stateProperty:this.stateProperty,isStateBinding:this.isStateBinding,updateFn:this.updateFn,metadata:{...this.metadata}})}toString(){const t=this.children.length>0?` [${this.children.length} children]`:"",e=this.key!==null?` key="${this.key}"`:"";return`<${this.tag}${e}${t}>`}static escapeHTML(t){const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return String(t).replace(/[&<>"']/g,s=>e[s])}static escapeAttribute(t){return r.escapeHTML(t)}static isVoidTag(t){return r.VOID_TAGS.includes(t)}static text(t){return String(t||"")}static fragment(t){return Array.isArray(t)?t:[t]}}r.VOID_TAGS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];export{r as VNode};
//# sourceMappingURL=vnode.js.map
