class r{constructor({tag:t="div",props:s={},style:e={},children:i=[],key:n=null,ref:a=null,events:o={},statefulWidgetId:h=null,stateProperty:c=null,isStateBinding:f=!1,updateFn:p=null,metadata:l={}}={}){this.tag=t,this.props=s||{},this.style=e||{},this.children=Array.isArray(i)?i:[],this.key=n,this.ref=a,this.events=o||{},this.statefulWidgetId=h,this.stateProperty=c,this.isStateBinding=f,this.updateFn=p,this.metadata=l||{},this._element=null,this._parent=null,this._index=null}toHTML(t={}){if(typeof this=="string")return r.escapeHTML(this);if(!this||!this.tag)return"";const s=this._serializeAttributes(),e=`<${this.tag}${s?" "+s:""}>`;if(r.VOID_TAGS.includes(this.tag))return e;const i=this.children.map(a=>a instanceof r?a.toHTML(t):typeof a=="string"?r.escapeHTML(a):"").join(""),n=`</${this.tag}>`;return`${e}${i}${n}`}toDOM(t={}){if(console.log(`
=== toDOM called for tag: ${this.tag}`),console.log("    style object:",this.style),console.log("    style keys:",Object.keys(this.style)),typeof this=="string")return document.createTextNode(this);if(!this||!this.tag)return document.createTextNode("");const s=document.createElement(this.tag);return this._applyProps(s),this._applyStyles(s),this._applyEvents(s),this.children.forEach((e,i)=>{let n;e instanceof r?(n=e.toDOM(t),e._parent=this,e._index=i):typeof e=="string"?n=document.createTextNode(e):n=document.createTextNode(String(e||"")),n&&s.appendChild(n)}),this._element=s,s._vnode=this,typeof this.ref=="function"&&this.ref(s),s}hydrate(t){if(!t||!this.tag)return null;this._element=t,t._vnode=this,this._applyEvents(t);const s=Array.from(t.childNodes);let e=0;return s.forEach((i,n)=>{const a=this.children[e];a&&(a instanceof r?(a.hydrate(i),a._parent=this,a._index=e,e++):i.nodeType===Node.TEXT_NODE&&String(a)===i.textContent&&e++)}),typeof this.ref=="function"&&this.ref(t),t}_serializeAttributes(){const t=[];if(this.props&&Object.entries(this.props).forEach(([s,e])=>{if(!(e==null||e===!1))if(e===!0)t.push(s);else{const i=s==="className"?"class":s,n=r.escapeAttribute(String(e));t.push(`${i}="${n}"`)}}),this.style&&typeof this.style=="object"){const s=Object.entries(this.style).filter(([e,i])=>i!=null).map(([e,i])=>`${e.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${i}`).join("; ");s&&t.push(`style="${r.escapeAttribute(s)}"`)}return this.metadata.widgetType&&t.push(`data-widget-type="${r.escapeAttribute(this.metadata.widgetType)}"`),this.key!==null&&this.key!==void 0&&t.push(`data-key="${r.escapeAttribute(String(this.key))}"`),t.join(" ")}_applyProps(t){this.props&&Object.entries(this.props).forEach(([s,e])=>{if(e!=null)try{s==="className"?t.className=e:s==="value"&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA")?t.value=e:s==="checked"&&t.tagName==="INPUT"?t.checked=!!e:s.startsWith("data-")||s.startsWith("aria-")?t.setAttribute(s,String(e)):typeof e=="boolean"?e&&t.setAttribute(s,""):s in t?t[s]=e:t.setAttribute(s,String(e))}catch(i){console.warn(`Failed to set property ${s}:`,i)}})}_applyStyles(t){!this.style||typeof this.style!="object"||Object.entries(this.style).forEach(([s,e])=>{if(e!=null)try{t.style[s]=e,console.log(`Set style ${s} = ${e} -> element.style.${s} = ${t.style[s]}`)}catch(i){console.warn(`Failed to set style ${s}:`,i)}})}_applyEvents(t){this.events&&Object.entries(this.events).forEach(([s,e])=>{if(typeof e!="function")return;const i=s.replace(/^on/,"").toLowerCase();t._eventListeners||(t._eventListeners={}),t._eventListeners[i]&&t.removeEventListener(i,t._eventListeners[i]),t.addEventListener(i,e),t._eventListeners[i]=e})}clone(){return new r({tag:this.tag,props:{...this.props},style:{...this.style},children:this.children.map(t=>t instanceof r?t.clone():t),key:this.key,ref:this.ref,events:{...this.events},statefulWidgetId:this.statefulWidgetId,stateProperty:this.stateProperty,isStateBinding:this.isStateBinding,updateFn:this.updateFn,metadata:{...this.metadata}})}toString(){const t=this.children.length>0?` [${this.children.length} children]`:"",s=this.key!==null?` key="${this.key}"`:"";return`<${this.tag}${s}${t}>`}static escapeHTML(t){const s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return String(t).replace(/[&<>"']/g,e=>s[e])}static escapeAttribute(t){return r.escapeHTML(t)}static isVoidTag(t){return r.VOID_TAGS.includes(t)}static text(t){return String(t||"")}static fragment(t){return Array.isArray(t)?t:[t]}}r.VOID_TAGS=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"],typeof module<"u"&&module.exports&&(module.exports=r),typeof window<"u"&&(window.VNode=r);export{r as VNode};
//# sourceMappingURL=vnode.js.map
