class c{constructor(r={}){this.debugMode=r.debugMode||!1,this.rootElement=r.rootElement||null,this.tracker=r.tracker||null}render(r,o,t={}){if(!o)throw new Error("Target element is required");this.debugMode&&(console.log("[VNodeRenderer] \u{1F3A8} Rendering to",o.id||o.className||o.tagName),console.log("[VNodeRenderer] \u{1F4E6} VNode to render:",{type:typeof r,isArray:Array.isArray(r),hasTag:r?.tag,constructor:r?.constructor?.name})),t.clear!==!1&&this.clearElement(o);try{const e=this.createDOMNode(r);return e&&(Array.isArray(e)?e.forEach(s=>o.appendChild(s)):o.appendChild(e)),this.debugMode&&console.log("[VNodeRenderer] \u2705 Rendered successfully"),Array.isArray(e)?e[0]:e}catch(e){throw this.handleRenderError(e,r),e}}handleRenderError(r,o){console.error(""),console.error("\u274C ".repeat(50)),console.error("VNODE RENDERER ERROR - WIDGET NOT CONVERTED TO VNODE"),console.error("\u274C ".repeat(50)),console.error(""),console.error("\u{1F50D} FAILED VNODE DETAILS:"),console.error("   Constructor:",o?.constructor?.name||"unknown"),console.error("   Type:",typeof o),console.error("   Has .tag:",o?.tag!==void 0),console.error("   Has .build:",typeof o?.build=="function"),console.error("   Has .createState:",typeof o?.createState=="function"),console.error("   Has .updateShouldNotify:",typeof o?.updateShouldNotify=="function"),console.error("");const t=this.identifyWidgetType(o);if(console.error("\u{1F4CB} WIDGET TYPE:",t),console.error(""),o&&typeof o=="object"){console.error("\u{1F4DD} WIDGET PROPERTIES:");const e=this.getWidgetProperties(o);Object.entries(e).forEach(([s,n])=>{console.error(`   ${s}: ${n}`)}),console.error("")}console.error("\u{1F4A5} PROBLEM:"),typeof o?.build=="function"&&!o?.tag&&(console.error("   This is a WIDGET (not a VNode)"),console.error("   Widget has a build() method but was never built to VNode"),console.error("   This means VNodeBuilder failed to properly convert this widget"),console.error(""),console.error("\u{1F3AF} THE ISSUE:"),console.error(`   Widget "${o.constructor.name}" reached the renderer`),console.error("   without being converted to a VNode first."),console.error(""),console.error("\u2705 SOLUTIONS:"),console.error("   1. Check VNodeBuilder logs above for detailed error"),console.error("   2. Verify Element.build() returns a VNode"),console.error("   3. Check StatelessElement/StatefulElement implementation"),console.error("   4. Ensure all nested widgets are also converted to VNodes")),console.error(""),console.error("\u{1F4DA} ERROR MESSAGE:",r.message),console.error(""),console.error("\u274C ".repeat(50)),console.error("")}identifyWidgetType(r){return!r||typeof r!="object"?"NOT_A_WIDGET":r.tag!==void 0?"VNODE (has .tag)":typeof r.createState=="function"?"StatefulWidget":typeof r.build=="function"&&!r.createState?"StatelessWidget":typeof r.updateShouldNotify=="function"?"InheritedWidget":r.appBar||r.body||r.floatingActionButton?"Scaffold (or similar)":r.title&&r.theme&&r.home?"MaterialApp":r.child||r.children?"Container/Layout Widget":"Unknown Widget Type"}getWidgetProperties(r){const o={};return Object.keys(r).filter(e=>!e.startsWith("_")&&!e.startsWith("__")&&typeof r[e]!="function").slice(0,10).forEach(e=>{const s=r[e];typeof s=="object"?o[e]=`[${s.constructor.name}]`:typeof s=="string"&&s.length>30?o[e]=`"${s.substring(0,30)}..."`:o[e]=JSON.stringify(s)}),o}createDOMNode(r){if(r==null)return document.createTextNode("");if(Array.isArray(r))return r.map(t=>this.createDOMNode(t)).filter(t=>t!==null);if(typeof r=="string"||typeof r=="number")return document.createTextNode(String(r));if(typeof r=="boolean")return document.createTextNode("");if(!r||!r.tag)throw console.error(""),console.error("\u{1F6D1} CRITICAL: VNode missing .tag property"),console.error("   Constructor:",r?.constructor?.name),console.error("   Type:",typeof r),console.error("   Is Widget:",typeof r?.build=="function"),console.error(""),this.tracker&&typeof this.tracker.trackRenderFailure=="function"&&this.tracker.trackRenderFailure(r,new Error("Missing tag property")),new Error(`[VNodeRenderer] Invalid VNode: Widget "${r?.constructor?.name}" was not built to VNode. This is a build chain error. Check VNodeBuilder logs above for the actual build failure.`);const o=document.createElement(r.tag);if(o._vnode=r,r._element=o,this.applyProps(o,r.props||{}),this.applyStyles(o,r.style||{}),this.applyEvents(o,r.events||{}),r.children&&r.children.length>0&&this.renderChildren(o,r.children),typeof r.ref=="function")try{r.ref(o)}catch(t){console.error("Error in ref callback:",t)}return o}renderChildren(r,o){o.forEach((t,e)=>{try{const s=this.createDOMNode(t);s&&(Array.isArray(s)?s.forEach(n=>r.appendChild(n)):r.appendChild(s),t&&typeof t=="object"&&t.tag&&(t._parent=r._vnode,t._index=e))}catch(s){throw console.error(`Error rendering child at index ${e}:`,s),s}})}applyProps(r,o){Object.entries(o).forEach(([t,e])=>{if(e!=null)try{if(t==="className"||t==="class"){r.className=e;return}if(t==="value"&&(r.tagName==="INPUT"||r.tagName==="TEXTAREA"||r.tagName==="SELECT")){r.value=e;return}if(t==="checked"&&r.tagName==="INPUT"){r.checked=!!e;return}if(t==="selected"&&r.tagName==="OPTION"){r.selected=!!e;return}if(t==="disabled"){r.disabled=!!e;return}if(t.startsWith("data-")||t.startsWith("aria-")){r.setAttribute(t,String(e));return}if(typeof e=="boolean"){e?r.setAttribute(t,""):r.removeAttribute(t);return}t in r?r[t]=e:r.setAttribute(t,String(e))}catch(s){console.warn(`Failed to set prop ${t}:`,s);try{r.setAttribute(t,String(e))}catch(n){console.error(`Failed to set attribute ${t}:`,n)}}})}applyStyles(r,o){Object.entries(o).forEach(([t,e])=>{if(e!=null)try{t.startsWith("--")?r.style.setProperty(t,e):r.style[t]=e}catch(s){console.warn(`Failed to set style ${t}:`,s)}})}applyEvents(r,o){Object.entries(o).forEach(([t,e])=>{if(typeof e!="function"){console.warn(`Event handler for ${t} is not a function`);return}try{const s=t.replace(/^on/,"").toLowerCase();r._eventListeners||(r._eventListeners={}),r._eventListeners[s]&&r.removeEventListener(s,r._eventListeners[s]),r.addEventListener(s,e),r._eventListeners[s]=e}catch(s){console.error(`Failed to attach event ${t}:`,s)}})}clearElement(r){this.cleanupEventListeners(r),r.innerHTML=""}cleanupEventListeners(r){r&&(r._eventListeners&&(Object.entries(r._eventListeners).forEach(([o,t])=>{r.removeEventListener(o,t)}),r._eventListeners=null),r._vnode&&(r._vnode._element=null,r._vnode=null),Array.from(r.children).forEach(o=>{this.cleanupEventListeners(o)}))}updateProps(r,o={},t={}){Object.keys(o).forEach(e=>{e in t||(e==="className"||e==="class"?r.className="":e.startsWith("data-")||e.startsWith("aria-")||typeof o[e]=="boolean"?r.removeAttribute(e):e in r?r[e]="":r.removeAttribute(e))}),this.applyProps(r,t)}updateStyles(r,o={},t={}){Object.keys(o).forEach(e=>{e in t||(r.style[e]="")}),this.applyStyles(r,t)}updateEvents(r,o={},t={}){Object.keys(o).forEach(e=>{if(!(e in t)){const s=e.replace(/^on/,"").toLowerCase();r._eventListeners&&r._eventListeners[s]&&(r.removeEventListener(s,r._eventListeners[s]),delete r._eventListeners[s])}}),this.applyEvents(r,t)}replaceElement(r,o){const t=this.createDOMNode(o);return r.parentNode&&t&&(this.cleanupEventListeners(r),r.parentNode.replaceChild(t,r)),t}removeElement(r){!r||!r.parentNode||(this.cleanupEventListeners(r),r.parentNode.removeChild(r))}insertAt(r,o,t){const e=this.createDOMNode(o);if(!e)return null;const s=Array.from(r.childNodes);return t>=s.length?r.appendChild(e):r.insertBefore(e,s[t]),e}findElementByPath(r,o){if(!o)return r;const t=o.split(".").map(Number);let e=r;for(const s of t){const n=Array.from(e.childNodes);if(s>=n.length)return null;e=n[s]}return e}getElementPath(r){const o=[];let t=r;for(;t.parentNode&&t.parentNode!==document.body;){const e=t.parentNode,s=Array.from(e.childNodes).indexOf(t);o.unshift(s),t=e}return o.join(".")}batchRender(r,o){const t=document.createDocumentFragment();r.forEach(e=>{const s=this.createDOMNode(e);s&&(Array.isArray(s)?s.forEach(n=>t.appendChild(n)):t.appendChild(s))}),this.clearElement(o),o.appendChild(t)}needsUpdate(r,o){if(!r._vnode)return!0;const t=r._vnode;if(t.tag!==o.tag||t.key!==o.key)return!0;const e=t.props||{},s=o.props||{};if(Object.keys(e).length!==Object.keys(s).length)return!0;const n=t.style||{},i=o.style||{};return Object.keys(n).length!==Object.keys(i).length}}export{c as VNodeRenderer};
//# sourceMappingURL=vnode_renderer.js.map
