{
  "version": 3,
  "sources": ["../src/vnode_builder.js"],
  "sourcesContent": ["/**\n * VNodeBuilder - FIXED VERSION\n * Properly converts Widget \u2192 Element \u2192 VNode\n * \n * KEY FIX: Keep building recursively until we get a VNode, not a widget\n */\nimport { VNode } from './vnode.js';\nimport { StyleConverter } from './style_converter.js';\nimport { StatelessElement, StatefulElement } from '@flutterjs/runtime/element';\nimport { InheritedElement } from '@flutterjs/runtime/inherited_element';\n\nclass VNodeBuilder {\n  constructor(options = {}) {\n    this.debugMode = options.debugMode || false;\n    this.runtime = options.runtime;\n\n    if (this.debugMode && !this.runtime) {\n      console.warn('[VNodeBuilder] \u26A0\uFE0F No runtime provided - Element creation will fail');\n    }\n  }\n\n  /**\n   * Build VNode tree from widget\n   * @param {Widget} widget - Flutter widget instance\n   * @param {BuildContext} context - Build context with runtime\n   * @returns {VNode|string|null} VNode tree or text content\n   */\n  build(widget, context = {}) {\n    // Handle null/undefined\n    if (!widget) {\n      return null;\n    }\n\n    // If already a VNode, return as-is\n    if (widget && typeof widget === 'object' && widget.tag) {\n      return widget;\n    }\n\n    // Handle text strings directly\n    if (typeof widget === 'string') {\n      return widget;\n    }\n\n    // Handle numbers\n    if (typeof widget === 'number') {\n      return String(widget);\n    }\n\n    // \u2705 Ensure runtime is in context\n    if (!context.runtime && this.runtime) {\n      context.runtime = this.runtime;\n    }\n\n    // \u2705 STATELESS WIDGET\n    if (typeof widget.build === 'function' && !widget.createState) {\n      if (this.debugMode) {\n        console.log('[VNodeBuilder] \uD83D\uDCE6 Building StatelessWidget:', widget.constructor.name);\n      }\n\n      if (!this.runtime) {\n        throw new Error('[VNodeBuilder] Runtime required to build StatelessWidget');\n      }\n\n      // Create element\n      const element = new StatelessElement(widget, context.parentElement || null, this.runtime);\n\n      // Call widget.build() \n      const builtWidget = element.build();\n\n      if (!builtWidget) {\n        return null;\n      }\n\n      if (this.debugMode) {\n        console.log('[VNodeBuilder] build() returned:', {\n          type: typeof builtWidget,\n          hasTag: builtWidget?.tag !== undefined,\n          constructor: builtWidget?.constructor?.name\n        });\n      }\n\n      // \u2705 FIX: Check if it's a VNode (has tag property)\n      if (builtWidget && typeof builtWidget === 'object' && builtWidget.tag) {\n        if (this.debugMode) {\n          console.log('[VNodeBuilder] \u2713 Got VNode, returning');\n        }\n        return builtWidget;\n      }\n\n      // \u2705 FIX: If it's a widget, recursively build it\n      if (builtWidget && typeof builtWidget === 'object' && typeof builtWidget.build === 'function') {\n        if (this.debugMode) {\n          console.log('[VNodeBuilder] \uD83D\uDD04 Got Widget, recursively building:', builtWidget.constructor.name);\n        }\n        return this.build(builtWidget, {\n          ...context,\n          parentElement: element,\n          runtime: this.runtime\n        });\n      }\n\n      // \u2705 If it's a string/number, return it\n      if (typeof builtWidget === 'string' || typeof builtWidget === 'number') {\n        return builtWidget;\n      }\n\n      if (this.debugMode) {\n        console.warn('[VNodeBuilder] Unknown return type from build():', builtWidget);\n      }\n      return null;\n    }\n\n    // \u2705 STATEFUL WIDGET\n    if (typeof widget.createState === 'function') {\n      if (this.debugMode) {\n        console.log('[VNodeBuilder] \uD83D\uDCE6 Building StatefulWidget:', widget.constructor.name);\n      }\n\n      if (!this.runtime) {\n        throw new Error('[VNodeBuilder] Runtime required to build StatefulWidget');\n      }\n\n      const element = new StatefulElement(\n        widget,\n        context.parentElement || null,\n        this.runtime\n      );\n\n      // Mount to initialize state\n      if (!element.mounted) {\n        element.mount();\n      }\n\n      // Build element\n      const builtWidget = element.build();\n\n      if (!builtWidget) {\n        return null;\n      }\n\n      // \u2705 Check if it's a VNode\n      if (builtWidget && typeof builtWidget === 'object' && builtWidget.tag) {\n        return builtWidget;\n      }\n\n      // \u2705 If it's a widget, recursively build\n      if (builtWidget && typeof builtWidget === 'object' && typeof builtWidget.build === 'function') {\n        return this.build(builtWidget, {\n          ...context,\n          parentElement: element,\n          runtime: this.runtime\n        });\n      }\n\n      if (typeof builtWidget === 'string' || typeof builtWidget === 'number') {\n        return builtWidget;\n      }\n\n      return null;\n    }\n\n    // \u2705 INHERITED WIDGET\n    if (widget.updateShouldNotify && typeof widget.updateShouldNotify === 'function') {\n      if (this.debugMode) {\n        console.log('[VNodeBuilder] \uD83D\uDCE6 Building InheritedWidget:', widget.constructor.name);\n      }\n\n      if (!this.runtime) {\n        throw new Error('[VNodeBuilder] Runtime required to build InheritedWidget');\n      }\n\n      const element = new InheritedElement(\n        widget,\n        context.parentElement || null,\n        this.runtime\n      );\n\n      if (!element.mounted) {\n        element.mount();\n      }\n\n      const builtWidget = element.build();\n\n      if (widget.child) {\n        const childVNode = this.build(widget.child, {\n          ...context,\n          parentElement: element,\n          runtime: this.runtime\n        });\n\n        if (builtWidget && childVNode) {\n          if (!builtWidget.children) {\n            builtWidget.children = [];\n          }\n          builtWidget.children.push(childVNode);\n        }\n\n        return builtWidget || childVNode;\n      }\n\n      return builtWidget ? this.build(builtWidget, context) : null;\n    }\n\n    // \u2705 FALLBACK: Unknown widget type\n    if (this.debugMode) {\n      console.warn('[VNodeBuilder] Unknown widget type:', widget.constructor?.name || typeof widget);\n    }\n\n    return this.buildGeneric(widget, context);\n  }\n\n  /**\n   * Build children array\n   * \u2705 Properly passes context with runtime\n   */\n  buildChildren(children, context) {\n    if (!children) return [];\n    if (!Array.isArray(children)) children = [children];\n\n    return children\n      .map((child, index) => {\n        return this.build(child, {\n          ...context,\n          childIndex: index,\n          runtime: this.runtime\n        });\n      })\n      .filter(vnode => vnode !== null && vnode !== undefined);\n  }\n\n  /**\n   * Get widget type name\n   * @private\n   */\n  getWidgetType(widget) {\n    if (!widget) return 'Unknown';\n\n    if (widget.constructor && widget.constructor.name) {\n      return widget.constructor.name;\n    }\n\n    if (widget.runtimeType) {\n      return widget.runtimeType;\n    }\n\n    if (widget.widget && widget.widget.constructor) {\n      return widget.widget.constructor.name;\n    }\n\n    return 'Unknown';\n  }\n\n  /**\n   * Extract common props from widget\n   * @private\n   */\n  extractCommonProps(widget) {\n    const props = {};\n\n    if (widget.key) {\n      props.key = widget.key;\n    }\n\n    if (widget._debugLabel) {\n      props['data-debug-label'] = widget._debugLabel;\n    }\n\n    return props;\n  }\n\n  /**\n   * Generic widget builder\n   */\n  buildGeneric(widget, context) {\n    let children = [];\n\n    if (widget.child) {\n      const child = this.build(widget.child, context);\n      if (child) children = [child];\n    } else if (widget.children) {\n      children = this.buildChildren(widget.children, context);\n    }\n\n    const widgetType = this.getWidgetType(widget);\n\n    return new VNode({\n      tag: 'div',\n      props: {\n        className: `fjs-${widgetType.toLowerCase()}`,\n        'data-widget-type': widgetType,\n        ...this.extractCommonProps(widget)\n      },\n      children,\n      metadata: {\n        widgetType,\n        note: 'Generic widget - no specific builder implemented'\n      }\n    });\n  }\n}\n\nexport { VNodeBuilder };"],
  "mappings": "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",
  "names": ["VNode", "StatelessElement", "StatefulElement", "InheritedElement", "VNodeBuilder", "options", "widget", "context", "element", "builtWidget", "childVNode", "children", "child", "index", "vnode", "props", "widgetType"]
}
