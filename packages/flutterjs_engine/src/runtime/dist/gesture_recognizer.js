class o{constructor(t,e={}){if(!t||typeof t!="function")throw new Error("Gesture recognizer requires a callback function");this.callback=t,this.options=e,this.state="ready",this.disposed=!1}handleEvent(t,e){throw new Error("handleEvent() must be implemented by subclass")}reset(){this.state="ready"}recognize(t){if(!this.disposed){this.state="recognized";try{this.callback(t)}catch(e){console.error("[GestureRecognizer] Callback error:",e)}}}fail(){this.state="failed"}dispose(){this.disposed=!0,this.callback=null,this.options=null,this.state="ready"}get isDisposed(){return this.disposed}}class l extends o{constructor(t,e={}){super(t,e),this.maxDuration=e.maxDuration||300,this.maxMovement=e.maxMovement||10,this.minTaps=e.minTaps||1,this.maxTaps=e.maxTaps||1,this.startTime=null,this.startX=null,this.startY=null,this.tapCount=0,this.lastTapTime=0,this.tapTimeout=null}handleEvent(t,e){if(!this.disposed)switch(t){case"pointerdown":case"mousedown":case"touchstart":this.handleDown(e);break;case"pointermove":case"mousemove":case"touchmove":this.handleMove(e);break;case"pointerup":case"mouseup":case"touchend":this.handleUp(e);break;case"pointercancel":case"touchcancel":this.handleCancel();break}}handleDown(t){this.state="possible",this.startTime=Date.now(),this.startX=this.getX(t),this.startY=this.getY(t)}handleMove(t){if(this.state!=="possible")return;const e=this.getX(t),s=this.getY(t),i=Math.abs(e-this.startX),n=Math.abs(s-this.startY);Math.sqrt(i*i+n*n)>this.maxMovement&&this.fail()}handleUp(t){if(this.state!=="possible")return;const e=Date.now()-this.startTime,s=this.getX(t),i=this.getY(t),n=Math.abs(s-this.startX),a=Math.abs(i-this.startY),r=Math.sqrt(n*n+a*a);e<=this.maxDuration&&r<=this.maxMovement?this.handleTap(t):this.fail(),this.reset()}handleTap(t){const e=Date.now();e-this.lastTapTime<300?this.tapCount++:this.tapCount=1,this.lastTapTime=e,this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null),this.tapCount>=this.maxTaps?(this.recognize({type:"tap",tapCount:this.tapCount,position:{x:this.startX,y:this.startY},nativeEvent:t}),this.tapCount=0):this.tapCount>=this.minTaps&&(this.tapTimeout=setTimeout(()=>{this.recognize({type:"tap",tapCount:this.tapCount,position:{x:this.startX,y:this.startY},nativeEvent:t}),this.tapCount=0},300))}handleCancel(){this.fail()}getX(t){return t.clientX!==void 0&&t.clientX!==0?t.clientX:t.touches&&t.touches.length>0?t.touches[0].clientX:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].clientX:0}getY(t){return t.clientY!==void 0&&t.clientY!==0?t.clientY:t.touches&&t.touches.length>0?t.touches[0].clientY:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].clientY:0}dispose(){this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=null),super.dispose()}}class u extends o{constructor(t,e={}){super(t,e),this.duration=e.duration||500,this.maxMovement=e.maxMovement||10,this.timer=null,this.startX=null,this.startY=null,this.recognized=!1}handleEvent(t,e){if(!this.disposed)switch(t){case"pointerdown":case"mousedown":case"touchstart":this.handleDown(e);break;case"pointermove":case"mousemove":case"touchmove":this.handleMove(e);break;case"pointerup":case"mouseup":case"touchend":case"pointercancel":case"touchcancel":this.handleEnd(e);break}}handleDown(t){this.state="possible",this.startX=this.getX(t),this.startY=this.getY(t),this.recognized=!1,this.timer=setTimeout(()=>{this.state==="possible"&&(this.recognized=!0,this.recognize({type:"longpress",position:{x:this.startX,y:this.startY},nativeEvent:t})),this.timer=null},this.duration)}handleMove(t){if(this.state!=="possible"||this.recognized)return;const e=this.getX(t),s=this.getY(t),i=Math.abs(e-this.startX),n=Math.abs(s-this.startY);Math.sqrt(i*i+n*n)>this.maxMovement&&this.cancel()}handleEnd(t){this.cancel(),this.reset()}cancel(){this.timer&&(clearTimeout(this.timer),this.timer=null),this.fail()}getX(t){return t.clientX||t.touches?.[0]?.clientX||0}getY(t){return t.clientY||t.touches?.[0]?.clientY||0}dispose(){this.cancel(),super.dispose()}}class d extends o{constructor(t,e={}){super(t,e),this.minDistance=e.minDistance||50,this.maxDuration=e.maxDuration||300,this.direction=e.direction||null,this.startTime=null,this.startX=null,this.startY=null}handleEvent(t,e){if(!this.disposed)switch(t){case"pointerdown":case"mousedown":case"touchstart":this.handleDown(e);break;case"pointerup":case"mouseup":case"touchend":this.handleUp(e);break;case"pointercancel":case"touchcancel":this.handleCancel();break}}handleDown(t){this.state="possible",this.startTime=Date.now(),this.startX=this.getX(t),this.startY=this.getY(t)}handleUp(t){if(this.state!=="possible")return;const e=Date.now()-this.startTime,s=this.getX(t),i=this.getY(t),n=s-this.startX,a=i-this.startY,r=Math.sqrt(n*n+a*a);if(e<=this.maxDuration&&r>=this.minDistance){const c=this.getDirection(n,a);if(this.direction==="horizontal"&&(c==="up"||c==="down")){this.fail(),this.reset();return}if(this.direction==="vertical"&&(c==="left"||c==="right")){this.fail(),this.reset();return}this.recognize({type:"swipe",direction:c,distance:r,velocity:r/e,delta:{dx:n,dy:a},start:{x:this.startX,y:this.startY},end:{x:s,y:i},nativeEvent:t})}else this.fail();this.reset()}handleCancel(){this.fail(),this.reset()}getDirection(t,e){const s=Math.atan2(e,t)*180/Math.PI;return s>=-45&&s<45?"right":s>=45&&s<135?"down":s>=-135&&s<-45?"up":"left"}getX(t){return t.clientX!==void 0&&t.clientX!==0?t.clientX:t.touches&&t.touches.length>0?t.touches[0].clientX:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].clientX:0}getY(t){return t.clientY!==void 0&&t.clientY!==0?t.clientY:t.touches&&t.touches.length>0?t.touches[0].clientY:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0].clientY:0}}class g extends o{constructor(t,e={}){super(t,e),this.minDistance=e.minDistance||10,this.direction=e.direction||null,this.startX=null,this.startY=null,this.lastX=null,this.lastY=null,this.isPanning=!1,this.onStart=e.onStart||null,this.onUpdate=e.onUpdate||null,this.onEnd=e.onEnd||null}handleEvent(t,e){if(!this.disposed)switch(t){case"pointerdown":case"mousedown":case"touchstart":this.handleDown(e);break;case"pointermove":case"mousemove":case"touchmove":this.handleMove(e);break;case"pointerup":case"mouseup":case"touchend":this.handleUp(e);break;case"pointercancel":case"touchcancel":this.handleCancel();break}}handleDown(t){this.state="possible",this.startX=this.getX(t),this.startY=this.getY(t),this.lastX=this.startX,this.lastY=this.startY,this.isPanning=!1}handleMove(t){if(this.state==="failed")return;const e=this.getX(t),s=this.getY(t),i=e-this.startX,n=s-this.startY,a=Math.sqrt(i*i+n*n);if(!this.isPanning&&a>=this.minDistance){if(this.direction==="horizontal"&&Math.abs(n)>Math.abs(i)){this.fail();return}if(this.direction==="vertical"&&Math.abs(i)>Math.abs(n)){this.fail();return}if(this.isPanning=!0,this.state="recognized",this.onStart)try{this.onStart({type:"panstart",position:{x:e,y:s},nativeEvent:t})}catch(r){console.error("[PanRecognizer] onStart error:",r)}}if(this.isPanning){const r=e-this.lastX,c=s-this.lastY;if(this.lastX=e,this.lastY=s,this.onUpdate)try{this.onUpdate({type:"panupdate",position:{x:e,y:s},delta:{dx:r,dy:c},totalDelta:{dx:i,dy:n},nativeEvent:t})}catch(f){console.error("[PanRecognizer] onUpdate error:",f)}}}handleUp(t){if(this.isPanning){const e=this.getX(t),s=this.getY(t),i=e-this.startX,n=s-this.startY;if(this.onEnd)try{this.onEnd({type:"panend",position:{x:e,y:s},totalDelta:{dx:i,dy:n},nativeEvent:t})}catch(a){console.error("[PanRecognizer] onEnd error:",a)}this.recognize({type:"pan",start:{x:this.startX,y:this.startY},end:{x:e,y:s},delta:{dx:i,dy:n},nativeEvent:t})}this.reset(),this.isPanning=!1}handleCancel(){if(this.isPanning&&this.onEnd)try{this.onEnd({type:"pancancel",position:{x:this.lastX,y:this.lastY}})}catch(t){console.error("[PanRecognizer] onEnd (cancel) error:",t)}this.fail(),this.reset(),this.isPanning=!1}getX(t){return t.clientX||t.touches?.[0]?.clientX||0}getY(t){return t.clientY||t.touches?.[0]?.clientY||0}}class p extends o{constructor(t,e={}){super(t,e),this.minScale=e.minScale||.5,this.maxScale=e.maxScale||2,this.initialDistance=null,this.currentDistance=null,this.isScaling=!1,this.onStart=e.onStart||null,this.onUpdate=e.onUpdate||null,this.onEnd=e.onEnd||null}handleEvent(t,e){if(!this.disposed){if(!e.touches||e.touches.length<2){this.isScaling&&this.handleEnd(e);return}switch(t){case"touchstart":this.handleStart(e);break;case"touchmove":this.handleMove(e);break;case"touchend":case"touchcancel":this.handleEnd(e);break}}}handleStart(t){if(t.touches.length===2&&(this.state="possible",this.initialDistance=this.getDistance(t.touches[0],t.touches[1]),this.currentDistance=this.initialDistance,this.isScaling=!0,this.onStart))try{this.onStart({type:"scalestart",scale:1,nativeEvent:t})}catch(e){console.error("[ScaleRecognizer] onStart error:",e)}}handleMove(t){if(!this.isScaling||t.touches.length!==2)return;this.state="recognized";const e=this.getDistance(t.touches[0],t.touches[1]);this.currentDistance=e;const s=e/this.initialDistance,i=Math.max(this.minScale,Math.min(this.maxScale,s));if(this.onUpdate)try{this.onUpdate({type:"scaleupdate",scale:i,rawScale:s,nativeEvent:t})}catch(n){console.error("[ScaleRecognizer] onUpdate error:",n)}}handleEnd(t){if(!this.isScaling)return;const e=this.currentDistance/this.initialDistance,s=Math.max(this.minScale,Math.min(this.maxScale,e));if(this.onEnd)try{this.onEnd({type:"scaleend",scale:s,rawScale:e,nativeEvent:t})}catch(i){console.error("[ScaleRecognizer] onEnd error:",i)}this.recognize({type:"scale",scale:s,rawScale:e,nativeEvent:t}),this.reset(),this.isScaling=!1,this.initialDistance=null,this.currentDistance=null}getDistance(t,e){const s=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(s*s+i*i)}}class m{constructor(){this.recognizers=new Map}register(t,e){this.recognizers.has(t)||this.recognizers.set(t,[]),this.recognizers.get(t).push(e)}unregister(t){const e=this.recognizers.get(t);e&&(e.forEach(s=>s.dispose()),this.recognizers.delete(t))}handleEvent(t,e,s){const i=this.recognizers.get(t);i&&i.forEach(n=>{!n.isDisposed&&n.state!=="failed"&&n.handleEvent(e,s)})}getRecognizers(t){return this.recognizers.get(t)||[]}clear(){this.recognizers.forEach(t=>{t.forEach(e=>e.dispose())}),this.recognizers.clear()}getStats(){let t=0;return this.recognizers.forEach(e=>{t+=e.length}),{elements:this.recognizers.size,totalRecognizers:t}}}class X{constructor(){this.arena=new m}registerTap(t,e,s={}){const i=new l(e,s);return this.arena.register(t,i),i}registerDoubleTap(t,e,s={}){const i=new l(e,{...s,minTaps:2,maxTaps:2});return this.arena.register(t,i),i}registerLongPress(t,e,s={}){const i=new u(e,s);return this.arena.register(t,i),i}registerSwipe(t,e,s={}){const i=new d(e,s);return this.arena.register(t,i),i}registerPan(t,e,s={}){const i=new g(e,s);return this.arena.register(t,i),i}registerScale(t,e,s={}){const i=new p(e,s);return this.arena.register(t,i),i}handleEvent(t,e,s){this.arena.handleEvent(t,e,s)}unregisterAll(t){this.arena.unregister(t)}getStats(){return this.arena.getStats()}dispose(){this.arena.clear()}}export{m as GestureArena,X as GestureManager,o as GestureRecognizer,u as LongPressRecognizer,g as PanRecognizer,p as ScaleRecognizer,d as SwipeRecognizer,l as TapRecognizer};
//# sourceMappingURL=gesture_recognizer.js.map
