class h{constructor(e={}){this.services=new Map,this.factories=new Map,this.lazyProviders=new Map,this.singletons=new Map,this.scopedServices=new Map,this.metadata=new Map,this.dependencies=new Map,this.config={enableLogging:e.enableLogging!==!1,enableValidation:e.enableValidation!==!1,cacheInstances:e.cacheInstances!==!1,debugMode:e.debugMode||!1,allowOverride:e.allowOverride!==!1,throwOnMissing:e.throwOnMissing||!1},this.stats={servicesRegistered:0,servicesRetrieved:0,cacheHits:0,cacheMisses:0,factoryCalls:0,lazyProviderCalls:0,errors:0},this.listeners=new Map}register(e,s,t={}){if(!e||typeof e!="string")throw new Error("Service name must be a non-empty string");if(s==null)throw new Error(`Cannot register null/undefined service: ${e}`);if(this.has(e)&&!this.config.allowOverride)throw new Error(`Service '${e}' is already registered`);return this.services.set(e,s),this.singletons.set(e,s),this.metadata.set(e,{name:e,type:"singleton",registered:Date.now(),service:s.constructor.name,lazy:!1}),this.factories.delete(e),this.lazyProviders.delete(e),this.stats.servicesRegistered++,this.emit("service-registered",{name:e,service:s,type:"singleton"}),this.config.debugMode&&this.log(`Registered singleton: ${e}`),this}registerFactory(e,s,t={}){if(!e||typeof e!="string")throw new Error("Service name must be a non-empty string");if(typeof s!="function")throw new Error(`Factory for '${e}' must be a function`);if(this.has(e)&&!this.config.allowOverride)throw new Error(`Service '${e}' is already registered`);return this.factories.set(e,s),this.metadata.set(e,{name:e,type:"factory",registered:Date.now(),factory:s.name||"anonymous",lazy:!1}),this.services.delete(e),this.singletons.delete(e),this.lazyProviders.delete(e),this.stats.servicesRegistered++,this.emit("service-registered",{name:e,factory:s,type:"factory"}),this.config.debugMode&&this.log(`Registered factory: ${e}`),this}registerLazy(e,s,t={}){if(!e||typeof e!="string")throw new Error("Service name must be a non-empty string");if(typeof s!="function")throw new Error(`Provider for '${e}' must be a function`);if(this.has(e)&&!this.config.allowOverride)throw new Error(`Service '${e}' is already registered`);return this.lazyProviders.set(e,s),this.metadata.set(e,{name:e,type:"lazy",registered:Date.now(),provider:s.name||"anonymous",lazy:!0}),this.services.delete(e),this.singletons.delete(e),this.factories.delete(e),this.stats.servicesRegistered++,this.emit("service-registered",{name:e,provider:s,type:"lazy"}),this.config.debugMode&&this.log(`Registered lazy: ${e}`),this}registerScoped(e,s,t){if(!e||typeof e!="string")throw new Error("Scope must be a non-empty string");if(!s||typeof s!="string")throw new Error("Service name must be a non-empty string");if(t==null)throw new Error(`Cannot register null/undefined service: ${s}`);return this.scopedServices.has(e)||this.scopedServices.set(e,new Map),this.scopedServices.get(e).set(s,t),this.config.debugMode&&this.log(`Registered scoped: ${e}/${s}`),this}get(e,s={}){const{scope:t=null,throwOnMissing:r=this.config.throwOnMissing}=s;if(!e||typeof e!="string")throw new Error("Service name must be a non-empty string");this.stats.servicesRetrieved++;try{if(t&&this.scopedServices.has(t)){const i=this.scopedServices.get(t);if(i.has(e))return this.stats.cacheHits++,this.config.debugMode&&this.log(`Got scoped service: ${t}/${e}`),i.get(e)}if(this.singletons.has(e))return this.stats.cacheHits++,this.config.debugMode&&this.log(`Got singleton: ${e} (cached)`),this.singletons.get(e);if(this.services.has(e))return this.stats.cacheHits++,this.config.debugMode&&this.log(`Got service: ${e} (cached)`),this.services.get(e);if(this.factories.has(e)){this.stats.cacheMisses++,this.stats.factoryCalls++;const o=this.factories.get(e)();return this.config.debugMode&&this.log(`Got service: ${e} (factory)`),this.emit("service-created",{name:e,type:"factory",instance:o}),o}if(this.lazyProviders.has(e)){this.stats.cacheMisses++,this.stats.lazyProviderCalls++;const o=this.lazyProviders.get(e)();return this.config.cacheInstances&&this.singletons.set(e,o),this.config.debugMode&&this.log(`Got service: ${e} (lazy)`),this.emit("service-created",{name:e,type:"lazy",instance:o}),o}if(this.stats.cacheMisses++,r)throw new Error(`Service not registered: ${e}`);return this.config.debugMode&&this.log(`Service not found: ${e}`),this.emit("service-not-found",{name:e}),null}catch(i){if(this.stats.errors++,console.error(`[ServiceRegistry] Error getting service '${e}':`,i),this.config.throwOnMissing)throw i;return null}}getScoped(e,s){return this.get(s,{scope:e})}has(e){return!e||typeof e!="string"?!1:this.services.has(e)||this.factories.has(e)||this.lazyProviders.has(e)||this.singletons.has(e)}hasScoped(e,s){return!e||!this.scopedServices.has(e)?!1:this.scopedServices.get(e).has(s)}unregister(e){return!e||typeof e!="string"?this:(this.services.delete(e),this.factories.delete(e),this.lazyProviders.delete(e),this.singletons.delete(e),this.metadata.delete(e),this.dependencies.delete(e),this.emit("service-unregistered",{name:e}),this.config.debugMode&&this.log(`Unregistered: ${e}`),this)}unregisterScoped(e,s=null){return!e||!this.scopedServices.has(e)?this:(s?this.scopedServices.get(e).delete(s):this.scopedServices.delete(e),this)}setDependencies(e,s=[]){if(!e||typeof e!="string")throw new Error("Service name required");return this.dependencies.set(e,Array.isArray(s)?s:[]),this}getDependencies(e){return this.dependencies.get(e)||[]}getNames(){const e=new Set;return this.services.forEach((s,t)=>e.add(t)),this.factories.forEach((s,t)=>e.add(t)),this.lazyProviders.forEach((s,t)=>e.add(t)),Array.from(e)}getMetadata(e){return this.metadata.get(e)||null}getAllMetadata(){const e={};return this.metadata.forEach((s,t)=>{e[t]=s}),e}clearScope(e){return this.scopedServices.delete(e),this.config.debugMode&&this.log(`Cleared scope: ${e}`),this}clearAllScopes(){return this.scopedServices.clear(),this.config.debugMode&&this.log("Cleared all scopes"),this}on(e,s){return!e||typeof s!="function"?this:(this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(s),this)}off(e,s){if(!e||!this.listeners.has(e))return this;const t=this.listeners.get(e),r=t.indexOf(s);return r!==-1&&t.splice(r,1),this}emit(e,s){if(!this.listeners.has(e))return;this.listeners.get(e).forEach(r=>{try{r(s)}catch(i){console.error(`[ServiceRegistry] Event listener error for '${e}':`,i)}})}getStats(){return{...this.stats,totalRegistered:this.getNames().length,singletons:this.singletons.size,factories:this.factories.size,lazyProviders:this.lazyProviders.size,scopes:this.scopedServices.size,hitRate:this.stats.servicesRetrieved>0?(this.stats.cacheHits/this.stats.servicesRetrieved*100).toFixed(2):"0.00"}}getDetailedReport(){return{stats:this.getStats(),services:this.getNames(),metadata:this.getAllMetadata(),scopes:Array.from(this.scopedServices.keys()),config:this.config,timestamp:Date.now()}}resetStats(){return this.stats={servicesRegistered:0,servicesRetrieved:0,cacheHits:0,cacheMisses:0,factoryCalls:0,lazyProviderCalls:0,errors:0},this}clear(){return this.services.clear(),this.factories.clear(),this.lazyProviders.clear(),this.singletons.clear(),this.metadata.clear(),this.dependencies.clear(),this.clearAllScopes(),this.listeners.clear(),this.config.debugMode&&this.log("Registry cleared"),this}dispose(){this.clear(),this.listeners.clear(),this.config.debugMode&&this.log("Registry disposed")}log(e){this.config.enableLogging&&console.log(`[ServiceRegistry] ${e}`)}}export{h as ServiceRegistry};
//# sourceMappingURL=service_registry.js.map
