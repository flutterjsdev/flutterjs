class o{constructor(e,t,s,r){this.nativeEvent=e,this.type=t,this.target=s,this.currentTarget=r,this._propagationStopped=!1,this._immediatePropagationStopped=!1,this._defaultPrevented=!1,this.timeStamp=e.timeStamp||Date.now(),this.bubbles=e.bubbles||!1,this.cancelable=e.cancelable||!1,this.clientX=e.clientX||0,this.clientY=e.clientY||0,this.pageX=e.pageX||0,this.pageY=e.pageY||0,this.screenX=e.screenX||0,this.screenY=e.screenY||0,this.button=e.button!==void 0?e.button:-1,this.buttons=e.buttons||0,this.altKey=e.altKey||!1,this.ctrlKey=e.ctrlKey||!1,this.metaKey=e.metaKey||!1,this.shiftKey=e.shiftKey||!1,this.key=e.key||"",this.code=e.code||"",this.keyCode=e.keyCode||0,this.which=e.which||0,this.value=e.target?.value||"",this.checked=e.target?.checked||!1,this.touches=e.touches||[],this.changedTouches=e.changedTouches||[],this.targetTouches=e.targetTouches||[]}preventDefault(){this._defaultPrevented=!0,this.nativeEvent.preventDefault&&this.nativeEvent.preventDefault()}get defaultPrevented(){return this._defaultPrevented}stopPropagation(){this._propagationStopped=!0,this.nativeEvent.stopPropagation&&this.nativeEvent.stopPropagation()}stopImmediatePropagation(){this._immediatePropagationStopped=!0,this._propagationStopped=!0,this.nativeEvent.stopImmediatePropagation&&this.nativeEvent.stopImmediatePropagation()}get isPropagationStopped(){return this._propagationStopped}get isImmediatePropagationStopped(){return this._immediatePropagationStopped}toString(){return`SyntheticEvent(${this.type} @ ${this.target?.tagName||"unknown"})`}}class g{constructor(e,t={}){if(!e)throw new Error("Runtime is required for EventSystem");this.runtime=e,this.config={enableDebug:t.enableDebug||!1,enableCapture:t.enableCapture!==!1,enableBubble:t.enableBubble!==!1,maxEventListeners:t.maxEventListeners||1e4,eventPoolSize:t.eventPoolSize||100,...t},this.rootElement=null,this.handlerRegistry=new Map,this.delegatedEvents=new Set(["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","touchstart","touchend","touchmove","touchcancel","pointerdown","pointerup","pointermove","pointerenter","pointerleave","keydown","keyup","keypress","focus","blur","input","change","submit","reset","scroll","resize","dragstart","drag","dragover","drop","contextmenu"]),this.nativeListeners=new Map,this.stats={handlersRegistered:0,handlersUnregistered:0,eventsDispatched:0,eventsCancelled:0,propagationStopped:0,averageListenerCount:0},this.eventPool=[],this.initialized=!1,this.config.enableDebug&&console.log("[EventSystem] Created")}initialize(e){if(!e||!(e instanceof HTMLElement))throw new Error("Root element must be a valid HTMLElement");if(this.initialized){console.warn("[EventSystem] Already initialized, skipping");return}this.rootElement=e,this.delegatedEvents.forEach(t=>{const s=this.createDelegatedListener(t);e.addEventListener(t,s,!0),this.nativeListeners.set(t,s),this.config.enableDebug&&console.log(`[EventSystem] Delegated listener attached for '${t}'`)}),this.initialized=!0,this.config.enableDebug&&console.log(`[EventSystem] Initialized with ${this.delegatedEvents.size} delegated events`)}createDelegatedListener(e){return t=>{this.stats.eventsDispatched++;let s=t.target;for(;s&&s!==this.rootElement;){const r=s.dataset?.elementId;if(r&&(this.dispatchToHandlers(r,e,t),t._stopPropagation))break;s=s.parentElement}}}dispatchToHandlers(e,t,s){const r=this.handlerRegistry.get(e);if(!r||!r[t])return;const i=r[t],n=s.target,a=new o(s,t,n,n);for(const h of i){if(a.isImmediatePropagationStopped)break;try{h(a)}catch(d){console.error(`[EventSystem] Handler error for ${t} on element ${e}:`,d)}}a.isPropagationStopped&&(s._stopPropagation=!0,s.stopPropagation()),a.defaultPrevented&&s.preventDefault()}registerHandler(e,t,s){if(!e||typeof e!="string")throw new Error("Element ID must be a non-empty string");if(!t||typeof t!="string")throw new Error("Event type must be a non-empty string");if(typeof s!="function")throw new Error("Handler must be a function");this.handlerRegistry.has(e)||this.handlerRegistry.set(e,{});const r=this.handlerRegistry.get(e);r[t]||(r[t]=[]);const i=r[t];i.length>=this.config.maxEventListeners&&console.warn(`[EventSystem] Max event listeners (${this.config.maxEventListeners}) reached for element ${e} event ${t}`),i.push(s),this.stats.handlersRegistered++,this.config.enableDebug&&console.log(`[EventSystem] Registered handler for ${e}.${t} (total: ${i.length})`)}unregisterHandler(e,t,s){if(!e)return;const r=this.handlerRegistry.get(e);if(!r)return;if(!t){this.handlerRegistry.delete(e),this.stats.handlersUnregistered+=Object.keys(r).length,this.config.enableDebug&&console.log(`[EventSystem] Unregistered all handlers for ${e}`);return}const i=r[t];if(!i)return;if(!s){const a=i.length;delete r[t],this.stats.handlersUnregistered+=a,this.config.enableDebug&&console.log(`[EventSystem] Unregistered ${a} handlers for ${e}.${t}`);return}const n=i.indexOf(s);n!==-1&&(i.splice(n,1),this.stats.handlersUnregistered++,this.config.enableDebug&&console.log(`[EventSystem] Unregistered handler for ${e}.${t} (remaining: ${i.length})`))}hasHandlers(e,t){const s=this.handlerRegistry.get(e);return s?t?(s[t]?.length||0)>0:Object.keys(s).length>0:!1}getHandlerCount(e,t){const s=this.handlerRegistry.get(e);return s?t?s[t]?.length||0:Object.values(s).reduce((r,i)=>r+i.length,0):0}getEventTypes(e){const t=this.handlerRegistry.get(e);return t?Object.keys(t):[]}batchRegister(e,t){if(!t||typeof t!="object")throw new Error("Handlers must be an object");Object.entries(t).forEach(([s,r])=>{typeof r=="function"&&this.registerHandler(e,s,r)})}batchUnregister(e){this.unregisterHandler(e)}dispatchCustomEvent(e,t,s={}){if(!e)throw new Error("Element is required");const r=new o(s.nativeEvent||new Event(t),t,e,e);Object.assign(r,s);const i=e.dataset?.elementId;i&&this.dispatchToHandlers(i,t,r.nativeEvent)}getStats(){const e=Array.from(this.handlerRegistry.values()).reduce((t,s)=>t+Object.values(s).reduce((r,i)=>r+i.length,0),0);return{...this.stats,initialized:this.initialized,delegatedEventsCount:this.delegatedEvents.size,elementsWithHandlers:this.handlerRegistry.size,totalHandlers:e,nativeListenersAttached:this.nativeListeners.size,averageHandlersPerElement:this.handlerRegistry.size>0?Math.round(e/this.handlerRegistry.size):0}}getDetailedInfo(e){if(e){const s=this.handlerRegistry.get(e);return{elementId:e,handlers:s?{...s}:{},hasHandlers:!!s}}const t={};return this.handlerRegistry.forEach((s,r)=>{t[r]={...s}}),{totalElements:this.handlerRegistry.size,elements:t}}clearElement(e){if(!e)return;const t=this.getHandlerCount(e);this.unregisterHandler(e),this.config.enableDebug&&t>0&&console.log(`[EventSystem] Cleared ${t} handlers for element ${e}`)}clearAll(){const e=this.handlerRegistry.size,t=Array.from(this.handlerRegistry.values()).reduce((s,r)=>s+Object.values(r).reduce((i,n)=>i+n.length,0),0);this.handlerRegistry.clear(),this.eventPool=[],this.config.enableDebug&&console.log(`[EventSystem] Cleared ${t} handlers from ${e} elements`)}dispose(){this.rootElement&&this.nativeListeners.forEach((e,t)=>{this.rootElement.removeEventListener(t,e,!0)}),this.clearAll(),this.nativeListeners.clear(),this.rootElement=null,this.initialized=!1,this.config.enableDebug&&console.log("[EventSystem] Disposed")}}export{g as EventSystem,o as SyntheticEvent};
//# sourceMappingURL=event_system.js.map
